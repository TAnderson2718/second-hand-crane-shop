<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫åÊâãÂêäËΩ¶Â∞èÁ®ãÂ∫è (Áî®Êà∑Á´Ø+ÁÆ°ÁêÜÁ´Ø)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- ÈÄöÁî®Ê†∑Âºè --- */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #E5E7EB;
        }

        /* --- ÊâãÊú∫ËßÜÂõæÊ†∑Âºè --- */
        .mobile-container {
             display: flex;
             justify-content: center;
             align-items: center;
             padding: 2rem;
             min-height: 100vh;
        }
        .mobile-frame {
            width: 100%;
            max-width: 420px;
            height: 850px;
            background-color: #F4F4F4;
            border: 12px solid #1F2937;
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        .status-bar {
            height: 30px;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            color: #1F2937;
            flex-shrink: 0;
            border-bottom: 1px solid #E5E7EB;
        }
        .status-bar .time { font-weight: 600; }
        .status-bar .icons span { margin-left: 5px; }
        .screen {
            flex-grow: 1;
            overflow-y: auto;
            position: relative;
        }
        .screen::-webkit-scrollbar { display: none; }
        .page {
            display: none;
            flex-direction: column;
            background-color: #F4F4F4;
            animation: fadeIn 0.3s ease-in-out;
            min-height: 100%;
        }
        .page.active { display: flex; }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        .tab-bar, #detail-action-bar {
            height: 60px;
            background-color: #FFFFFF;
            border-top: 1px solid #E5E7EB;
            flex-shrink: 0;
            z-index: 10;
        }
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #6B7280;
            cursor: pointer;
            transition: color 0.2s;
            flex: 1;
        }
        .tab-item.active { color: #3B82F6; }
        .tab-item svg { width: 24px; height: 24px; margin-bottom: 2px; }
        .nav-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            height: 44px;
            background-color: #fff;
            border-bottom: 1px solid #E5E7EB;
            flex-shrink: 0;
            z-index: 10;
        }
        .nav-bar .back-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        .nav-bar .title { font-size: 18px; font-weight: 600; }
        .image-preview-item { position: relative; }
        .delete-preview-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background-color: #EF4444;
            color: white;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            line-height: 1;
            cursor: pointer;
            border: 1px solid white;
        }
        .form-select, .form-input, .form-textarea {
            background-color: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            font-size: 14px;
            width: 100%;
        }
        .carousel-container {
            scroll-snap-type: x mandatory;
            overflow-x: auto;
        }
        .carousel-slide { scroll-snap-align: start; }
        .modal { animation: fadeInModal 0.3s ease-out; }
         @keyframes fadeInModal {
            from { opacity: 0; transform: translateY(30px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .post-action-btn { @apply text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full; }

        /* --- ÁÆ°ÁêÜÁ´ØÊ†∑Âºè --- */
        .admin-view {
            width: 100%;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 250px;
            background-color: #1F2937;
            color: #D1D5DB;
            flex-shrink: 0;
        }
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .sidebar-item:hover, .sidebar-item.active {
            background-color: #374151;
            color: white;
        }
        .sidebar-item svg {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
        }
        .main-content {
            flex-grow: 1;
            padding: 2rem;
            background-color: #F3F4F6;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-block;
        }
        .status-pending, .status-reviewing, .status-banned { background-color: #FEF3C7; color: #92400E; }
        .status-processed, .status-selling, .status-active { background-color: #D1FAE5; color: #065F46; }
        .status-off { background-color: #E5E7EB; color: #4B5563; }
        
        .action-btn {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
            margin: 0 0.2rem;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    
    <!-- ÂÖ®Â±ÄËßÜÂõæÂàáÊç¢ÊåâÈíÆ -->
    <div class="fixed top-4 right-4 z-50">
        <button id="view-toggle-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-indigo-700 transition">
            ÂàáÊç¢Âà∞ÁÆ°ÁêÜÂëòËßÜÂõæ
        </button>
    </div>

    <!-- Áî®Êà∑ÊâãÊú∫ËßÜÂõæ -->
    <div id="user-view">
        <div class="mobile-container">
            <div class="mobile-frame">
                 <!-- Áä∂ÊÄÅÊ†è -->
                <div class="status-bar">
                    <span id="time" class="time">17:15</span>
                    <div class="icons"><span>üì∂</span><span>5G</span><span>üîã</span></div>
                </div>

                <!-- ÂØºËà™Ê†è -->
                <div id="nav-bar" class="nav-bar hidden">
                    <div id="back-button" class="back-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    </div>
                    <span id="nav-title" class="title"></span>
                </div>
                
                <!-- Â±èÂπïÂÜÖÂÆπÂå∫ -->
                <div id="screen" class="screen">
                    <!-- ÂêÑ‰∏™È°µÈù¢ÂÆπÂô® -->
                    <div id="page-index" class="page active"></div>
                    <div id="page-detail" class="page"></div>
                    <div id="page-post" class="page"></div>
                    <div id="page-profile" class="page"></div>
                    <div id="page-report" class="page"></div>
                    <div id="page-favorites" class="page"></div>
                    <div id="page-posts" class="page"></div>
                    <div id="page-intentions" class="page"></div>
                </div>

                <!-- ËØ¶ÊÉÖÈ°µ‰∏ìÂ±ûÊìç‰ΩúÊ†è -->
                <div id="detail-action-bar" class="hidden"></div>
                
                <!-- Â∫ïÈÉ® Tab Ê†è -->
                <div id="tab-bar" class="tab-bar flex">
                    <div class="tab-item active" data-page="index"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg><span>È¶ñÈ°µ</span></div>
                    <div class="tab-item" data-page="post"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"></path></svg><span>ÂèëÂ∏É</span></div>
                    <div class="tab-item" data-page="profile"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg><span>ÊàëÁöÑ</span></div>
                </div>

                <!-- Áªü‰∏ÄÁöÑÈ°∂ÈÉ®ÈÄöÁü•Êù° -->
                <div id="notification-toast" class="absolute top-10 left-1/2 -translate-x-1/2 bg-black bg-opacity-75 text-white px-4 py-2 rounded-full shadow-lg z-50 opacity-0 transform -translate-y-4 transition-all duration-300 pointer-events-none">
                    <p id="notification-text"></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÁÆ°ÁêÜÂëòÊ°åÈù¢ËßÜÂõæ -->
    <div id="admin-view" class="hidden">
        <div class="admin-view">
            <!-- ‰æßËæπÊ†è -->
            <nav class="sidebar">
                <div class="p-6 text-center">
                    <h2 class="text-xl font-bold text-white">ÂêäËΩ¶ÁÆ°ÁêÜÂêéÂè∞</h2>
                </div>
                <div>
                    <a href="#" class="sidebar-item active" data-page="listings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>‰ø°ÊÅØÁÆ°ÁêÜ</a>
                    <a href="#" class="sidebar-item" data-page="users"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.975 5.975 0 0112 15a5.975 5.975 0 013-1.197z"></path></svg>Áî®Êà∑ÁÆ°ÁêÜ</a>
                    <a href="#" class="sidebar-item" data-page="intentions"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>ÊÑèÂêëÁÆ°ÁêÜ</a>
                    <a href="#" class="sidebar-item" data-page="data-maintenance"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7a8 8 0 0116 0M12 11a4 4 0 100-8 4 4 0 000 8z"></path></svg>Êï∞ÊçÆÁª¥Êä§</a>
                    <a href="#" class="sidebar-item" data-page="reports"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6H8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"></path></svg>‰∏æÊä•ÁÆ°ÁêÜ</a>
                    <a href="#" class="sidebar-item" data-page="settings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Á≥ªÁªüËÆæÁΩÆ</a>
                </div>
            </nav>
            <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
            <main class="main-content">
                <div id="admin-content-listings">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">‰ø°ÊÅØÁÆ°ÁêÜ</h1>
                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ÁºñÂè∑</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Ê†áÈ¢ò</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">‰ª∑Ê†º</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Áä∂ÊÄÅ</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="admin-listings-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
                <div id="admin-content-users" class="hidden">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">Áî®Êà∑ÁÆ°ÁêÜ</h1>
                     <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Áî®Êà∑ID</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Â§¥ÂÉè/ÊòµÁß∞</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ËÅîÁ≥ªÁîµËØù</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Ê≥®ÂÜåÊó∂Èó¥</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Áä∂ÊÄÅ</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="admin-users-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
                 <div id="admin-content-reports" class="hidden">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">‰∏æÊä•ÁÆ°ÁêÜ</h1>
                     <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">‰∏æÊä•ID</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Ë¢´‰∏æÊä•ÂÜÖÂÆπ</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">‰∏æÊä•ÁêÜÁî±</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Áä∂ÊÄÅ</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="admin-reports-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
                 <div id="admin-content-intentions" class="hidden">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">ÊÑèÂêëÁÆ°ÁêÜ</h1>
                     <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ÊÑèÂêëID</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Áî®Êà∑</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ÊÑèÂêëËØ¶ÊÉÖ</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="admin-intentions-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
                <div id="admin-content-data-maintenance" class="hidden">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">Âü∫Á°ÄÊï∞ÊçÆÁª¥Êä§</h1>
                    <div class="bg-white p-6 rounded-lg shadow space-y-6">
                        <!-- JSÂä®ÊÄÅÁîüÊàêÁ±ªÂûãÂíåÂìÅÁâåÁª¥Êä§Âå∫Âüü -->
                    </div>
                </div>
                <div id="admin-content-settings" class="hidden">
                     <h1 class="text-2xl font-bold text-gray-800 mb-6">Á≥ªÁªüËÆæÁΩÆ</h1>
                     <div class="space-y-8">
                        <!-- Â∏∏ËßÑËÆæÁΩÆ -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold text-gray-700 border-b pb-3 mb-4">Â∏∏ËßÑËÆæÁΩÆ</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="site-name" class="block text-sm font-medium text-gray-700">Â∞èÁ®ãÂ∫èÂêçÁß∞</label>
                                    <input type="text" id="site-name" value="‰∫åÊâãÂêäËΩ¶Â∞èÁ®ãÂ∫è" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                                <div>
                                    <label for="admin-email" class="block text-sm font-medium text-gray-700">ÁÆ°ÁêÜÂëòÈÇÆÁÆ±</label>
                                    <input type="email" id="admin-email" value="admin@example.com" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                            </div>
                        </div>

                        <!-- Ë¥¶Êà∑ÂÆâÂÖ® -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold text-gray-700 border-b pb-3 mb-4">Ë¥¶Êà∑ÂÆâÂÖ®</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="current-password" class="block text-sm font-medium text-gray-700">ÂΩìÂâçÂØÜÁ†Å</label>
                                    <input type="password" id="current-password" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                                <div>
                                    <label for="new-password" class="block text-sm font-medium text-gray-700">Êñ∞ÂØÜÁ†Å</label>
                                    <input type="password" id="new-password" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                                 <div>
                                    <label for="confirm-password" class="block text-sm font-medium text-gray-700">Á°ÆËÆ§Êñ∞ÂØÜÁ†Å</label>
                                    <input type="password" id="confirm-password" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end pt-4">
                            <button id="save-settings-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-lg shadow-lg hover:bg-indigo-700 transition">
                                ‰øùÂ≠òÊõ¥Êîπ
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ÂÖ®Â±ÄÂºπÁ™ó (ÂÖ±Áî®) -->
    <div id="call-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-xs text-center">
            <div class="p-6"><p class="text-lg font-semibold text-gray-800 mb-1"></p><p class="text-sm text-gray-500">Êàë‰ª¨Â∞ÜÂëºÂè´Ê≠§Âè∑Á†Å</p></div>
            <div class="border-t border-gray-200 grid grid-cols-2">
                <button id="cancel-call" class="py-3 text-gray-600">ÂèñÊ∂à</button>
                <button id="confirm-call" class="py-3 text-blue-500 font-semibold border-l border-gray-200">ÂëºÂè´</button>
            </div>
        </div>
    </div>
    <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-xs text-center">
            <div class="p-6"><p id="confirm-modal-text" class="text-lg font-semibold text-gray-800 mb-1"></p></div>
            <div class="border-t border-gray-200 grid grid-cols-2">
                <button id="cancel-confirm" class="py-3 text-gray-600">ÂèñÊ∂à</button>
                <button id="confirm-action" class="py-3 text-red-500 font-semibold border-l border-gray-200">Á°ÆËÆ§</button>
            </div>
        </div>
    </div>
    <div id="image-lightbox" class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4">
        <span id="close-lightbox" class="absolute top-4 right-6 text-white text-5xl cursor-pointer hover:text-gray-300">&times;</span>
        <img id="lightbox-image" src="" class="max-w-full max-h-full">
    </div>
    <div id="intention-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
         <div class="modal bg-white w-full max-w-[420px] rounded-t-2xl p-4 max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="intention-modal-title" class="text-lg font-bold">Ê∑ªÂä†ÊÑèÂêë</h3>
                <span id="close-intention-modal" class="text-2xl cursor-pointer">&times;</span>
            </div>
            <div class="flex-grow overflow-y-auto space-y-4 pr-2">
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ËÆæÂ§áÁ±ªÂûã</label><select id="intention-type" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ÂìÅÁâå</label><select id="intention-brand" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">Âê®‰Ωç</label><input type="number" id="intention-tonnage" class="col-span-2 form-input" placeholder="‰∏çÈôê"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ÊéíÊîæÊ†áÂáÜ</label><select id="intention-emission" class="col-span-2 form-select"></select></div>
                <div>
                    <label>ÊâÄÂú®Âú∞</label>
                    <div class="mt-2 p-2 bg-gray-100 rounded-md min-h-[40px]" id="intention-locations-display"></div>
                    <div class="flex items-center space-x-2 mt-2">
                         <select id="intention-province" class="form-select flex-1"></select>
                         <select id="intention-city" class="form-select flex-1"></select>
                         <button id="add-location-btn" class="bg-blue-500 text-white px-4 py-2 rounded-md flex-shrink-0">Ê∑ªÂä†</button>
                    </div>
                </div>
            </div>
            <button id="save-intention-btn" class="w-full bg-blue-600 text-white py-3 rounded-lg text-lg font-semibold mt-4">‰øùÂ≠òÊÑèÂêë</button>
         </div>
    </div>

    <!-- Êñ∞Â¢û: ÁÆ°ÁêÜÂëòÁºñËæëÂºπÁ™ó -->
    <div id="admin-edit-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="admin-edit-modal-title" class="text-xl font-bold">ÁºñËæë‰ø°ÊÅØ</h3>
                <span id="close-admin-edit-modal" class="text-2xl cursor-pointer hover:text-red-500">&times;</span>
            </div>
            <div id="admin-edit-form-container" class="p-6 overflow-y-auto">
                <!-- JS Âä®ÊÄÅÂ°´ÂÖÖË°®Âçï -->
            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    // --- ÂÖ®Â±ÄÂèòÈáèÂíåÁä∂ÊÄÅ ---
    let isAdminView = false;
    let pageHistory = ['index'];
    let notificationTimeout;
    let currentIntentionLocations = [];
    let editingIntentionId = null;

    // --- Ê®°ÊãüÊï∞ÊçÆ ---
    let mockListings = [
        { id: 1, title: "‰∏â‰∏Ä XCT25L5 - 80Âê®", tags: ["‰∏≠‰ªã‰ø°ÊÅØ", "Â°îÂêä", "ÂõΩ‰∫î"], type: "Ê±ΩËΩ¶Âêä", brand: "‰∏â‰∏Ä", tonnage: 80, manufacture_date: "2025-06", post_date: "6Â§©ÂâçÂèëÂ∏É", location: "Ê±üËãè ËãèÂ∑û", price: "180.00", phone: "138-0001-0001", images: ["https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0?q=80&w=800&h=600&fit=crop", "https://picsum.photos/seed/crane1-2/800/600", "https://picsum.photos/seed/crane1-3/800/600"], work_hours: 1500, mileage: 25000, contact_person: "ÁéãÁªèÁêÜ", status: 'selling'},
        { id: 2, title: "‰∏≠ËÅî XCT25L5 - 50Âê®", tags: ["‰∫åÊâãËΩ¶ÂïÜ", "Â°îÂêä", "ÂõΩ‰∫î"], type: "Ê±ΩËΩ¶Âêä", brand: "‰∏≠ËÅîÈáçÁßë", tonnage: 50, manufacture_date: "2025-06", post_date: "6Â§©ÂâçÂèëÂ∏É", location: "Â±±‰∏ú ÊµéÂçó", price: "80.00", phone: "138-0002-0002", images: ["https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=800&h=600&fit=crop", "https://picsum.photos/seed/crane2-2/800/600"], work_hours: 2200, mileage: 31000, contact_person: "ÊùéËÄÅÊùø", status: 'selling'},
        { id: 3, title: "ÂæêÂ∑• QY25K5 - 25Âê®", tags: ["ËΩ¶‰∏ªÁõ¥Âçñ", "Ê±ΩËΩ¶Âêä", "ÂõΩÂÖ≠"], type: "Ê±ΩËΩ¶Âêä", brand: "ÂæêÂ∑•", tonnage: 25, manufacture_date: "2024-01", post_date: "12Â§©ÂâçÂèëÂ∏É", location: "Ê≤≥Âåó Áü≥ÂÆ∂Â∫Ñ", price: "65.50", phone: "138-0003-0003", images: ["https://picsum.photos/id/1057/800/600", "https://picsum.photos/id/1058/800/600"], work_hours: 800, mileage: 12000, contact_person: "Âº†Â∏àÂÇÖ", status: 'selling'},
        { id: 4, title: "‰∏â‰∏Ä STC250 - 25Âê®", tags: ["ËΩ¶‰∏ªÁõ¥Âçñ", "Ê±ΩËΩ¶Âêä", "ÂõΩ‰∫î"], type: "Ê±ΩËΩ¶Âêä", brand: "‰∏â‰∏Ä", tonnage: 25, manufacture_date: "2023-08", post_date: "20Â§©ÂâçÂèëÂ∏É", location: "Âπø‰∏ú ÂπøÂ∑û", price: "55.00", phone: "138-0004-0004", images: ["https://picsum.photos/seed/crane4/600/400"], work_hours: 3500, mileage: 45000, contact_person: "ÈôàÂÖàÁîü", status: 'reviewing'},
        { id: 5, title: "Âà©ÂãÉÊµ∑Â∞î LTM 1500 - 500Âê®", tags: ["‰∏≠‰ªã‰ø°ÊÅØ", "Â±•Â∏¶Âêä", "ÂõΩÂõõ"], type: "Â±•Â∏¶Âêä", brand: "Âà©ÂãÉÊµ∑Â∞î", tonnage: 500, manufacture_date: "2022-01", post_date: "1ÊúàÂâçÂèëÂ∏É", location: "‰∏äÊµ∑ ‰∏äÊµ∑Â∏Ç", price: "1200.00", phone: "138-0005-0005", images: ["https://picsum.photos/seed/crane5/600/400"], work_hours: 5000, mileage: 0, contact_person: "ËµµÊÄª", status: 'off' },
    ];
    let mockUsers = [
        {id: 101, nickname: 'ÂêäËΩ¶Â§ßÁéã', avatar: 'https://picsum.photos/seed/avatar1/100/100', phone: '138-0001-0001', registration_date: '2023-05-10', status: 'active'},
        {id: 102, nickname: 'Ëµ∑ÈáçÂÖàÈîã', avatar: 'https://picsum.photos/seed/avatar2/100/100', phone: '138-0002-0002', registration_date: '2023-08-15', status: 'active'},
        {id: 103, nickname: 'Â∑•Á®ãÊú∫Ê¢∞', avatar: 'https://picsum.photos/seed/avatar3/100/100', phone: '138-0003-0003', registration_date: '2024-01-20', status: 'banned'},
        {id: 104, nickname: 'ÂêäË£ÖÂ∞èÁéãÂ≠ê', avatar: 'https://picsum.photos/seed/avatar4/100/100', phone: '138-0004-0004', registration_date: '2024-03-11', status: 'active'},
    ];
    let mockReports = [
        { id: 1, listingId: 4, reason: 'ËôöÂÅá‰ø°ÊÅØ', status: 'pending' },
        { id: 2, listingId: 1, reason: 'ËΩ¶ËæÜÂ∑≤ÂîÆ', status: 'processed' },
        { id: 3, listingId: 5, reason: '‰ª∑Ê†º‰∏éÊèèËø∞‰∏çÁ¨¶', status: 'pending' },
    ];
    let mockMyPosts = [
        { id: 3, status: 'selling' },
        { id: 4, status: 'reviewing' },
        { id: 5, status: 'off' },
    ];
    let mockFavorites = [1, 2];
    let mockIntentions = [
        { id: 1, userId: 101, type: 'Ê±ΩËΩ¶Âêä', brand: 'ÂæêÂ∑•', tonnage: '25', emission: 'ÂõΩÂÖ≠', locations: [{ province: 'Ê≤≥ÂåóÁúÅ', city: '‰∏çÈôê' }]},
        { id: 2, userId: 102, type: 'È´òÁ©∫ËΩ¶', brand: '‰∏çÈôê', tonnage: '20', emission: '‰∏çÈôê', locations: [{ province: 'Â±±‰∏úÁúÅ', city: 'ÊµéÂçóÂ∏Ç' }, { province: 'Ê±üËãèÁúÅ', city: 'ËãèÂ∑ûÂ∏Ç' }] },
        { id: 3, userId: 101, type: 'Â±•Â∏¶Âêä', brand: '‰∏â‰∏Ä', tonnage: '100', emission: '‰∏çÈôê', locations: [{ province: 'Âπø‰∏úÁúÅ', city: '‰∏çÈôê' }]},
    ];
    const chinaLocations = {
        "Âåó‰∫¨Â∏Ç": ["Âåó‰∫¨Â∏Ç"], "Â§©Ê¥•Â∏Ç": ["Â§©Ê¥•Â∏Ç"], "‰∏äÊµ∑Â∏Ç": ["‰∏äÊµ∑Â∏Ç"], "ÈáçÂ∫ÜÂ∏Ç": ["ÈáçÂ∫ÜÂ∏Ç"],
        "Ê≤≥ÂåóÁúÅ": ["Áü≥ÂÆ∂Â∫ÑÂ∏Ç", "ÂîêÂ±±Â∏Ç", "Áß¶ÁöáÂ≤õÂ∏Ç", "ÈÇØÈÉ∏Â∏Ç", "ÈÇ¢Âè∞Â∏Ç", "‰øùÂÆöÂ∏Ç", "Âº†ÂÆ∂Âè£Â∏Ç", "ÊâøÂæ∑Â∏Ç", "Ê≤ßÂ∑ûÂ∏Ç", "ÂªäÂùäÂ∏Ç", "Ë°°Ê∞¥Â∏Ç"], "Â±±Ë•øÁúÅ": ["Â§™ÂéüÂ∏Ç", "Â§ßÂêåÂ∏Ç", "Èò≥Ê≥âÂ∏Ç", "ÈïøÊ≤ªÂ∏Ç", "ÊôãÂüéÂ∏Ç", "ÊúîÂ∑ûÂ∏Ç", "Êôã‰∏≠Â∏Ç", "ËøêÂüéÂ∏Ç", "ÂøªÂ∑ûÂ∏Ç", "‰∏¥Ê±æÂ∏Ç", "ÂêïÊ¢ÅÂ∏Ç"], "ËæΩÂÆÅÁúÅ": ["Ê≤àÈò≥Â∏Ç", "Â§ßËøûÂ∏Ç", "ÈûçÂ±±Â∏Ç", "ÊäöÈ°∫Â∏Ç", "Êú¨Ê∫™Â∏Ç", "‰∏π‰∏úÂ∏Ç", "Èî¶Â∑ûÂ∏Ç", "Ëê•Âè£Â∏Ç", "ÈòúÊñ∞Â∏Ç", "ËæΩÈò≥Â∏Ç", "ÁõòÈî¶Â∏Ç", "ÈìÅÂ≤≠Â∏Ç", "ÊúùÈò≥Â∏Ç", "Ëë´Ëä¶Â≤õÂ∏Ç"], "ÂêâÊûóÁúÅ": ["ÈïøÊò•Â∏Ç", "ÂêâÊûóÂ∏Ç", "ÂõõÂπ≥Â∏Ç", "ËæΩÊ∫êÂ∏Ç", "ÈÄöÂåñÂ∏Ç", "ÁôΩÂ±±Â∏Ç", "ÊùæÂéüÂ∏Ç", "ÁôΩÂüéÂ∏Ç", "Âª∂ËæπÊúùÈ≤úÊóèËá™Ê≤ªÂ∑û"], "ÈªëÈæôÊ±üÁúÅ": ["ÂìàÂ∞îÊª®Â∏Ç", "ÈΩêÈΩêÂìàÂ∞îÂ∏Ç", "È∏°Ë•øÂ∏Ç", "Èπ§Â≤óÂ∏Ç", "ÂèåÈ∏≠Â±±Â∏Ç", "Â§ßÂ∫ÜÂ∏Ç", "‰ºäÊò•Â∏Ç", "‰Ω≥Êú®ÊñØÂ∏Ç", "‰∏ÉÂè∞Ê≤≥Â∏Ç", "Áâ°‰∏πÊ±üÂ∏Ç", "ÈªëÊ≤≥Â∏Ç", "Áª•ÂåñÂ∏Ç", "Â§ßÂÖ¥ÂÆâÂ≤≠Âú∞Âå∫"], "Ê±üËãèÁúÅ": ["Âçó‰∫¨Â∏Ç", "Êó†Èî°Â∏Ç", "ÂæêÂ∑ûÂ∏Ç", "Â∏∏Â∑ûÂ∏Ç", "ËãèÂ∑ûÂ∏Ç", "ÂçóÈÄöÂ∏Ç", "Ëøû‰∫ëÊ∏ØÂ∏Ç", "Ê∑ÆÂÆâÂ∏Ç", "ÁõêÂüéÂ∏Ç", "Êâ¨Â∑ûÂ∏Ç", "ÈïáÊ±üÂ∏Ç", "Ê≥∞Â∑ûÂ∏Ç", "ÂÆøËøÅÂ∏Ç"], "ÊµôÊ±üÁúÅ": ["Êù≠Â∑ûÂ∏Ç", "ÂÆÅÊ≥¢Â∏Ç", "Ê∏©Â∑ûÂ∏Ç", "ÂòâÂÖ¥Â∏Ç", "ÊπñÂ∑ûÂ∏Ç", "ÁªçÂÖ¥Â∏Ç", "ÈáëÂçéÂ∏Ç", "Ë°¢Â∑ûÂ∏Ç", "ËàüÂ±±Â∏Ç", "Âè∞Â∑ûÂ∏Ç", "‰∏ΩÊ∞¥Â∏Ç"], "ÂÆâÂæΩÁúÅ": ["ÂêàËÇ•Â∏Ç", "ËäúÊπñÂ∏Ç", "ËöåÂü†Â∏Ç", "Ê∑ÆÂçóÂ∏Ç", "È©¨ÈûçÂ±±Â∏Ç", "Ê∑ÆÂåóÂ∏Ç", "ÈìúÈôµÂ∏Ç", "ÂÆâÂ∫ÜÂ∏Ç", "ÈªÑÂ±±Â∏Ç", "ÊªÅÂ∑ûÂ∏Ç", "ÈòúÈò≥Â∏Ç", "ÂÆøÂ∑ûÂ∏Ç", "ÂÖ≠ÂÆâÂ∏Ç", "‰∫≥Â∑ûÂ∏Ç", "Ê±†Â∑ûÂ∏Ç", "ÂÆ£ÂüéÂ∏Ç"], "Á¶èÂª∫ÁúÅ": ["Á¶èÂ∑ûÂ∏Ç", "Âé¶Èó®Â∏Ç", "ËéÜÁî∞Â∏Ç", "‰∏âÊòéÂ∏Ç", "Ê≥âÂ∑ûÂ∏Ç", "Êº≥Â∑ûÂ∏Ç", "ÂçóÂπ≥Â∏Ç", "ÈæôÂ≤©Â∏Ç", "ÂÆÅÂæ∑Â∏Ç"], "Ê±üË•øÁúÅ": ["ÂçóÊòåÂ∏Ç", "ÊôØÂæ∑ÈïáÂ∏Ç", "Ëêç‰π°Â∏Ç", "‰πùÊ±üÂ∏Ç", "Êñ∞‰ΩôÂ∏Ç", "Èπ∞ÊΩ≠Â∏Ç", "Ëµ£Â∑ûÂ∏Ç", "ÂêâÂÆâÂ∏Ç", "ÂÆúÊò•Â∏Ç", "ÊäöÂ∑ûÂ∏Ç", "‰∏äÈ•∂Â∏Ç"], "Â±±‰∏úÁúÅ": ["ÊµéÂçóÂ∏Ç", "ÈùíÂ≤õÂ∏Ç", "Ê∑ÑÂçöÂ∏Ç", "Êû£Â∫ÑÂ∏Ç", "‰∏úËê•Â∏Ç", "ÁÉüÂè∞Â∏Ç", "ÊΩçÂùäÂ∏Ç", "ÊµéÂÆÅÂ∏Ç", "Ê≥∞ÂÆâÂ∏Ç", "Â®ÅÊµ∑Â∏Ç", "Êó•ÁÖßÂ∏Ç", "‰∏¥Ê≤ÇÂ∏Ç", "Âæ∑Â∑ûÂ∏Ç", "ËÅäÂüéÂ∏Ç", "Êª®Â∑ûÂ∏Ç", "ËèèÊ≥ΩÂ∏Ç"], "Ê≤≥ÂçóÁúÅ": ["ÈÉëÂ∑ûÂ∏Ç", "ÂºÄÂ∞ÅÂ∏Ç", "Ê¥õÈò≥Â∏Ç", "Âπ≥È°∂Â±±Â∏Ç", "ÂÆâÈò≥Â∏Ç", "Èπ§Â£ÅÂ∏Ç", "Êñ∞‰π°Â∏Ç", "ÁÑ¶‰ΩúÂ∏Ç", "ÊøÆÈò≥Â∏Ç", "ËÆ∏ÊòåÂ∏Ç", "ÊºØÊ≤≥Â∏Ç", "‰∏âÈó®Â≥°Â∏Ç", "ÂçóÈò≥Â∏Ç", "ÂïÜ‰∏òÂ∏Ç", "‰ø°Èò≥Â∏Ç", "Âë®Âè£Â∏Ç", "È©ªÈ©¨Â∫óÂ∏Ç"], "ÊπñÂåóÁúÅ": ["Ê≠¶Ê±âÂ∏Ç", "ÈªÑÁü≥Â∏Ç", "ÂçÅÂ†∞Â∏Ç", "ÂÆúÊòåÂ∏Ç", "Ë•ÑÈò≥Â∏Ç", "ÈÑÇÂ∑ûÂ∏Ç", "ËçÜÈó®Â∏Ç", "Â≠ùÊÑüÂ∏Ç", "ËçÜÂ∑ûÂ∏Ç", "ÈªÑÂÜàÂ∏Ç", "Âí∏ÂÆÅÂ∏Ç", "ÈöèÂ∑ûÂ∏Ç", "ÊÅ©ÊñΩÂúüÂÆ∂ÊóèËãóÊóèËá™Ê≤ªÂ∑û"], "ÊπñÂçóÁúÅ": ["ÈïøÊ≤ôÂ∏Ç", "Ê†™Ê¥≤Â∏Ç", "ÊπòÊΩ≠Â∏Ç", "Ë°°Èò≥Â∏Ç", "ÈÇµÈò≥Â∏Ç", "Â≤≥Èò≥Â∏Ç", "Â∏∏Âæ∑Â∏Ç", "Âº†ÂÆ∂ÁïåÂ∏Ç", "ÁõäÈò≥Â∏Ç", "ÈÉ¥Â∑ûÂ∏Ç", "Ê∞∏Â∑ûÂ∏Ç", "ÊÄÄÂåñÂ∏Ç", "Â®ÑÂ∫ïÂ∏Ç", "ÊπòË•øÂúüÂÆ∂ÊóèËãóÊóèËá™Ê≤ªÂ∑û"], "Âπø‰∏úÁúÅ": ["ÂπøÂ∑ûÂ∏Ç", "Èü∂ÂÖ≥Â∏Ç", "Ê∑±Âú≥Â∏Ç", "Áè†Êµ∑Â∏Ç", "Ê±ïÂ§¥Â∏Ç", "‰ΩõÂ±±Â∏Ç", "Ê±üÈó®Â∏Ç", "ÊπõÊ±üÂ∏Ç", "ËåÇÂêçÂ∏Ç", "ËÇáÂ∫ÜÂ∏Ç", "ÊÉ†Â∑ûÂ∏Ç", "Ê¢ÖÂ∑ûÂ∏Ç", "Ê±ïÂ∞æÂ∏Ç", "Ê≤≥Ê∫êÂ∏Ç", "Èò≥Ê±üÂ∏Ç", "Ê∏ÖËøúÂ∏Ç", "‰∏úËéûÂ∏Ç", "‰∏≠Â±±Â∏Ç", "ÊΩÆÂ∑ûÂ∏Ç", "Êè≠Èò≥Â∏Ç", "‰∫ëÊµÆÂ∏Ç"], "Êµ∑ÂçóÁúÅ": ["Êµ∑Âè£Â∏Ç", "‰∏â‰∫öÂ∏Ç", "‰∏âÊ≤ôÂ∏Ç", "ÂÑãÂ∑ûÂ∏Ç"], "ÂõõÂ∑ùÁúÅ": ["ÊàêÈÉΩÂ∏Ç", "Ëá™Ë¥°Â∏Ç", "ÊîÄÊûùËä±Â∏Ç", "Ê≥∏Â∑ûÂ∏Ç", "Âæ∑Èò≥Â∏Ç", "ÁªµÈò≥Â∏Ç", "ÂπøÂÖÉÂ∏Ç", "ÈÅÇÂÆÅÂ∏Ç", "ÂÜÖÊ±üÂ∏Ç", "‰πêÂ±±Â∏Ç", "ÂçóÂÖÖÂ∏Ç", "ÁúâÂ±±Â∏Ç", "ÂÆúÂÆæÂ∏Ç", "ÂπøÂÆâÂ∏Ç", "ËææÂ∑ûÂ∏Ç", "ÈõÖÂÆâÂ∏Ç", "Â∑¥‰∏≠Â∏Ç", "ËµÑÈò≥Â∏Ç", "ÈòøÂùùËóèÊóèÁæåÊóèËá™Ê≤ªÂ∑û", "ÁîòÂ≠úËóèÊóèËá™Ê≤ªÂ∑û", "ÂáâÂ±±ÂΩùÊóèËá™Ê≤ªÂ∑û"], "Ë¥µÂ∑ûÁúÅ": ["Ë¥µÈò≥Â∏Ç", "ÂÖ≠ÁõòÊ∞¥Â∏Ç", "ÈÅµ‰πâÂ∏Ç", "ÂÆâÈ°∫Â∏Ç", "ÊØïËäÇÂ∏Ç", "Èìú‰ªÅÂ∏Ç", "ÈªîË•øÂçóÂ∏É‰æùÊóèËãóÊóèËá™Ê≤ªÂ∑û", "Èªî‰∏úÂçóËãóÊóè‰æóÊóèËá™Ê≤ªÂ∑û", "ÈªîÂçóÂ∏É‰æùÊóèËãóÊóèËá™Ê≤ªÂ∑û"], "‰∫ëÂçóÁúÅ": ["ÊòÜÊòéÂ∏Ç", "Êõ≤ÈùñÂ∏Ç", "ÁéâÊ∫™Â∏Ç", "‰øùÂ±±Â∏Ç", "Êò≠ÈÄöÂ∏Ç", "‰∏ΩÊ±üÂ∏Ç", "ÊôÆÊ¥±Â∏Ç", "‰∏¥Ê≤ßÂ∏Ç", "Ê•öÈõÑÂΩùÊóèËá™Ê≤ªÂ∑û", "Á∫¢Ê≤≥ÂìàÂ∞ºÊóèÂΩùÊóèËá™Ê≤ªÂ∑û", "ÊñáÂ±±Â£ÆÊóèËãóÊóèËá™Ê≤ªÂ∑û", "Ë•øÂèåÁâàÁ∫≥ÂÇ£ÊóèËá™Ê≤ªÂ∑û", "Â§ßÁêÜÁôΩÊóèËá™Ê≤ªÂ∑û", "Âæ∑ÂÆèÂÇ£ÊóèÊôØÈ¢áÊóèËá™Ê≤ªÂ∑û", "ÊÄíÊ±üÂÇàÂÉ≥ÊóèËá™Ê≤ªÂ∑û", "Ëø™Â∫ÜËóèÊóèËá™Ê≤ªÂ∑û"], "ÈôïË•øÁúÅ": ["Ë•øÂÆâÂ∏Ç", "ÈìúÂ∑ùÂ∏Ç", "ÂÆùÈ∏°Â∏Ç", "Âí∏Èò≥Â∏Ç", "Ê∏≠ÂçóÂ∏Ç", "Âª∂ÂÆâÂ∏Ç", "Ê±â‰∏≠Â∏Ç", "Ê¶ÜÊûóÂ∏Ç", "ÂÆâÂ∫∑Â∏Ç", "ÂïÜÊ¥õÂ∏Ç"], "ÁîòËÇÉÁúÅ": ["ÂÖ∞Â∑ûÂ∏Ç", "ÂòâÂ≥™ÂÖ≥Â∏Ç", "ÈáëÊòåÂ∏Ç", "ÁôΩÈì∂Â∏Ç", "Â§©Ê∞¥Â∏Ç", "Ê≠¶Â®ÅÂ∏Ç", "Âº†ÊéñÂ∏Ç", "Âπ≥ÂáâÂ∏Ç", "ÈÖíÊ≥âÂ∏Ç", "Â∫ÜÈò≥Â∏Ç", "ÂÆöË•øÂ∏Ç", "ÈôáÂçóÂ∏Ç", "‰∏¥Â§èÂõûÊóèËá™Ê≤ªÂ∑û", "ÁîòÂçóËóèÊóèËá™Ê≤ªÂ∑û"], "ÈùíÊµ∑ÁúÅ": ["Ë•øÂÆÅÂ∏Ç", "Êµ∑‰∏úÂ∏Ç", "Êµ∑ÂåóËóèÊóèËá™Ê≤ªÂ∑û", "ÈªÑÂçóËóèÊóèËá™Ê≤ªÂ∑û", "Êµ∑ÂçóËóèÊóèËá™Ê≤ªÂ∑û", "ÊûúÊ¥õËóèÊóèËá™Ê≤ªÂ∑û", "ÁéâÊ†ëËóèÊóèËá™Ê≤ªÂ∑û", "Êµ∑Ë•øËíôÂè§ÊóèËóèÊóèËá™Ê≤ªÂ∑û"], "Âè∞ÊπæÁúÅ": ["Âè∞ÂåóÂ∏Ç", "Êñ∞ÂåóÂ∏Ç", "Ê°ÉÂõ≠Â∏Ç", "Âè∞‰∏≠Â∏Ç", "Âè∞ÂçóÂ∏Ç", "È´òÈõÑÂ∏Ç", "Âü∫ÈöÜÂ∏Ç", "Êñ∞Á´πÂ∏Ç", "Âòâ‰πâÂ∏Ç"], "ÂÜÖËíôÂè§Ëá™Ê≤ªÂå∫": ["ÂëºÂíåÊµ©ÁâπÂ∏Ç", "ÂåÖÂ§¥Â∏Ç", "‰πåÊµ∑Â∏Ç", "Ëµ§Â≥∞Â∏Ç", "ÈÄöËæΩÂ∏Ç", "ÈÑÇÂ∞îÂ§öÊñØÂ∏Ç", "Âëº‰º¶Ë¥ùÂ∞îÂ∏Ç", "Â∑¥ÂΩ¶Ê∑ñÂ∞îÂ∏Ç", "‰πåÂÖ∞ÂØüÂ∏ÉÂ∏Ç", "ÂÖ¥ÂÆâÁõü", "Èî°ÊûóÈÉ≠ÂãíÁõü", "ÈòøÊãâÂñÑÁõü"], "ÂπøË•øÂ£ÆÊóèËá™Ê≤ªÂå∫": ["ÂçóÂÆÅÂ∏Ç", "Êü≥Â∑ûÂ∏Ç", "Ê°ÇÊûóÂ∏Ç", "Ê¢ßÂ∑ûÂ∏Ç", "ÂåóÊµ∑Â∏Ç", "Èò≤ÂüéÊ∏ØÂ∏Ç", "Èí¶Â∑ûÂ∏Ç", "Ë¥µÊ∏ØÂ∏Ç", "ÁéâÊûóÂ∏Ç", "ÁôæËâ≤Â∏Ç", "Ë¥∫Â∑ûÂ∏Ç", "Ê≤≥Ê±†Â∏Ç", "Êù•ÂÆæÂ∏Ç", "Â¥áÂ∑¶Â∏Ç"], "Ë•øËóèËá™Ê≤ªÂå∫": ["ÊãâËê®Â∏Ç", "Êó•ÂñÄÂàôÂ∏Ç", "ÊòåÈÉΩÂ∏Ç", "ÊûóËäùÂ∏Ç", "Â±±ÂçóÂ∏Ç", "ÈÇ£Êõ≤Â∏Ç", "ÈòøÈáåÂú∞Âå∫"], "ÂÆÅÂ§èÂõûÊóèËá™Ê≤ªÂå∫": ["Èì∂Â∑ùÂ∏Ç", "Áü≥Âò¥Â±±Â∏Ç", "Âê¥Âø†Â∏Ç", "Âõ∫ÂéüÂ∏Ç", "‰∏≠Âç´Â∏Ç"], "Êñ∞ÁñÜÁª¥ÂêæÂ∞îËá™Ê≤ªÂå∫": ["‰πåÈ≤ÅÊú®ÈΩêÂ∏Ç", "ÂÖãÊãâÁéõ‰æùÂ∏Ç", "ÂêêÈ≤ÅÁï™Â∏Ç", "ÂìàÂØÜÂ∏Ç", "ÊòåÂêâÂõûÊóèËá™Ê≤ªÂ∑û", "ÂçöÂ∞îÂ°îÊãâËíôÂè§Ëá™Ê≤ªÂ∑û", "Â∑¥Èü≥ÈÉ≠Ê•ûËíôÂè§Ëá™Ê≤ªÂ∑û", "ÈòøÂÖãËãèÂú∞Âå∫", "ÂÖãÂ≠úÂãíËãèÊüØÂ∞îÂÖãÂ≠úËá™Ê≤ªÂ∑û", "ÂñÄ‰ªÄÂú∞Âå∫", "ÂíåÁî∞Âú∞Âå∫", "‰ºäÁäÅÂìàËê®ÂÖãËá™Ê≤ªÂ∑û", "Â°îÂüéÂú∞Âå∫", "ÈòøÂãíÊ≥∞Âú∞Âå∫"], "È¶ôÊ∏ØÁâπÂà´Ë°åÊîøÂå∫": ["È¶ôÊ∏ØÂ≤õ", "‰πùÈæô", "Êñ∞Áïå"], "Êæ≥Èó®ÁâπÂà´Ë°åÊîøÂå∫": ["Êæ≥Èó®ÂçäÂ≤õ", "Ê∞π‰ªî", "Ë∑ØÁéØ"]
    };
    let equipmentData = {
        'Ê±ΩËΩ¶Âêä': { brands: ['ÂæêÂ∑•', '‰∏â‰∏Ä', '‰∏≠ËÅîÈáçÁßë', 'Âà©ÂãÉÊµ∑Â∞î', 'Â§öÁî∞Èáé'], unit: 'Âê®' },
        'Â±•Â∏¶Âêä': { brands: ['ÂæêÂ∑•', '‰∏â‰∏Ä', 'ÊäöÊåñ', 'Êó•Á´ã‰ΩèÂèã', 'Âæ∑È©¨Ê†º'], unit: 'Âê®' },
        'Â°îÂêä': { brands: ['‰∏≠ËÅîÈáçÁßë', 'Ê∞∏ËåÇ', 'È©¨Â∞ºÊâòÁì¶ÂÖã', 'Ê≥¢Âù¶', 'ÁßëÊõºËê®'], unit: 'ÂûãÂè∑' },
        'È´òÁ©∫ËΩ¶': { brands: ['ÂæêÂ∑•', 'ÂêâÂ∞º', 'ÊòüÈÇ¶', 'JLG', 'Ê¨ßÂéÜËÉú'], unit: 'Á±≥' },
        'ÈöèËΩ¶Âêä': { brands: ['Áü≥ÁÖ§', 'ÂæêÂ∑•', 'Âè§Ê≤≥', 'Â∏ïÂ∞îËè≤Ê†º', 'Â∏åÂ∞îÂçö'], unit: 'Âê®' },
    };
    const emissionOptions = ["‰∏çÈôê", "ÂõΩ‰∏â", "ÂõΩÂõõ", "ÂõΩ‰∫î", "ÂõΩÂÖ≠"];

    // --- DOM ÂÖÉÁ¥† ---
    const viewToggleBtn = document.getElementById('view-toggle-btn');
    const userView = document.getElementById('user-view');
    const adminView = document.getElementById('admin-view');
    const adminSidebarItems = document.querySelectorAll('.sidebar-item');
    const adminContentPanels = {
        listings: document.getElementById('admin-content-listings'),
        users: document.getElementById('admin-content-users'),
        reports: document.getElementById('admin-content-reports'),
        settings: document.getElementById('admin-content-settings'),
        'data-maintenance': document.getElementById('admin-content-data-maintenance'),
        intentions: document.getElementById('admin-content-intentions'),
    };
    const adminListingsTable = document.getElementById('admin-listings-table');
    const adminUsersTable = document.getElementById('admin-users-table');
    const adminReportsTable = document.getElementById('admin-reports-table');
    const adminIntentionsTable = document.getElementById('admin-intentions-table');
    const adminEditModal = document.getElementById('admin-edit-modal');

    // Áî®Êà∑Á´Ø DOM
    const screenElement = document.getElementById('screen');
    const pages = document.querySelectorAll('.page');
    const tabItems = document.querySelectorAll('.tab-item');
    const navBar = document.getElementById('nav-bar');
    const navTitle = document.getElementById('nav-title');
    const backButton = document.getElementById('back-button');
    const callModal = document.getElementById('call-modal');
    const cancelCallBtn = document.getElementById('cancel-call');
    const confirmCallBtn = document.getElementById('confirm-call');
    const confirmModal = document.getElementById('confirm-modal');
    const confirmModalText = document.getElementById('confirm-modal-text');
    const cancelConfirmBtn = document.getElementById('cancel-confirm');
    const confirmActionBtn = document.getElementById('confirm-action');
    const imageLightbox = document.getElementById('image-lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    const closeLightboxBtn = document.getElementById('close-lightbox');
    const mainTabBar = document.getElementById('tab-bar');
    const detailActionBar = document.getElementById('detail-action-bar');
    const intentionModal = document.getElementById('intention-modal');
    const notificationToast = document.getElementById('notification-toast');
    const notificationText = document.getElementById('notification-text');

    // --- ÈÄöÁî®ËæÖÂä©ÂáΩÊï∞ ---
    function showNotification(text, type = 'success') {
        const toast = document.getElementById('notification-toast')
        if (!toast) return;
        toast.textContent = text;
        if(type === 'error'){
            toast.classList.add('bg-red-600');
        } else {
            toast.classList.remove('bg-red-600');
        }
        toast.classList.remove('opacity-0', '-translate-y-4');
        clearTimeout(notificationTimeout);
        notificationTimeout = setTimeout(() => {
            toast.classList.add('opacity-0', '-translate-y-4');
        }, 2500);
    }

    function updateTime() {
        const now = new Date();
        document.getElementById('time').textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
    }

    function populateSelect(selectElement, options, selectedValue) {
        if (!selectElement) return;
        selectElement.innerHTML = '';
        options.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.textContent = option;
            if (option === selectedValue) {
                optionElement.selected = true;
            }
            selectElement.appendChild(optionElement);
        });
    }

    // --- Áî®Êà∑Á´ØÂºπÁ™óÈÄªËæë ---
    function showCallModal(phone) {
        callModal.querySelector('p:first-child').textContent = phone || '138-8888-8888';
        callModal.classList.remove('hidden');
    }
    function hideCallModal() { callModal.classList.add('hidden'); }
    function showConfirmModal(text, onConfirm) {
        confirmModalText.textContent = text;
        confirmActionBtn.onclick = () => {
            onConfirm();
            hideConfirmModal();
        };
        confirmModal.classList.remove('hidden');
    }
    function hideConfirmModal() { confirmModal.classList.add('hidden'); }
    function openLightbox(src) {
        lightboxImage.src = src;
        imageLightbox.classList.remove('hidden');
    }
    function closeLightbox() { imageLightbox.classList.add('hidden'); }
    
    function closeIntentionModal() {
        intentionModal.classList.add('hidden');
        editingIntentionId = null;
    }
    
    function closeAdminEditModal() {
        adminEditModal.classList.add('hidden');
    }

    function handleImageUpload(event, container, imageUrls = []) {
        const previewsContainer = container.querySelector('.previews-container');
        const uploadTrigger = container.querySelector('.upload-trigger');
        
        previewsContainer.querySelectorAll('.image-preview-item').forEach(item => item.remove());

        const addPreview = (src) => {
            const currentPreviews = previewsContainer.querySelectorAll('.image-preview-item').length;
            if(currentPreviews >= 9) return;

            const previewItem = document.createElement('div');
            previewItem.className = 'w-full h-20 image-preview-item';
            previewItem.innerHTML = `
                <img src="${src}" class="w-full h-full object-cover rounded-md">
                <div class="delete-preview-btn">√ó</div>
            `;
            previewsContainer.insertBefore(previewItem, uploadTrigger);
            
            previewItem.querySelector('.delete-preview-btn').addEventListener('click', () => {
                previewItem.remove();
                checkUploadLimit(container);
            });
        };

        if (imageUrls.length > 0) {
            imageUrls.forEach(url => addPreview(url));
        } else {
             const files = event.target.files;
             for (const file of files) {
                 const reader = new FileReader();
                 reader.onload = (e) => addPreview(e.target.result);
                 reader.readAsDataURL(file);
            }
        }
        
        if(event.target) event.target.value = '';
        checkUploadLimit(container);
    }
    function checkUploadLimit(container) {
        const previewsContainer = container.querySelector('.previews-container');
        const uploadTrigger = container.querySelector('.upload-trigger');
        const currentPreviews = previewsContainer.querySelectorAll('.image-preview-item').length;
        uploadTrigger.style.display = currentPreviews >= 9 ? 'none' : 'flex';
    }

    // --- ÂØºËà™‰∏éÈ°µÈù¢Ê∏≤ÊüìÊ†∏ÂøÉ ---
    function navigateTo(pageId, title, data = null) {
        pageHistory.push(pageId);
        renderPage(pageId, null, data);
        showPage(pageId, title);
    }

    function navigateBack() {
        if (pageHistory.length > 1) {
            pageHistory.pop();
            const prevPageId = pageHistory[pageHistory.length - 1];
            const prevPage = document.querySelector(`.tab-item[data-page="${prevPageId}"], .profile-menu > div[data-page="${prevPageId}"]`);
            const prevTitle = prevPage ? (prevPage.querySelector('span') ? prevPage.querySelector('span').textContent : 'ËØ¶ÊÉÖ') : 'È¶ñÈ°µ';
            renderPage(prevPageId);
            showPage(prevPageId, prevTitle);
        }
    }
    function switchTab(pageId) {
        pageHistory = [pageId];
        renderPage(pageId);
        showPage(pageId);
    }

    function showPage(pageId, title) {
        pages.forEach(p => p.classList.remove('active'));
        navBar.classList.add('hidden');
        mainTabBar.classList.add('hidden');
        detailActionBar.classList.add('hidden');
        const targetPage = document.getElementById(`page-${pageId}`);
        if (targetPage) {
            targetPage.classList.add('active');
            if (['index', 'post', 'profile'].includes(pageId)) {
                mainTabBar.classList.remove('hidden');
            } else {
                navBar.classList.remove('hidden');
                navTitle.textContent = title || 'ËØ¶ÊÉÖ';
                if(pageId === 'detail') {
                    detailActionBar.classList.remove('hidden');
                }
            }
        }
        updateTabActive(pageId);
        screenElement.scrollTop = 0;
    }
    
    function updateTabActive(pageId) {
        let isTab = false;
        tabItems.forEach(item => {
            const isActive = item.dataset.page === pageId;
            item.classList.toggle('active', isActive);
            if (isActive) isTab = true;
        });
        if (!isTab) {
             tabItems.forEach(item => item.classList.remove('active'));
        }
    }
    
    function renderPage(pageId, container, data) {
        const pageContainer = container || document.getElementById(`page-${pageId}`);
        switch(pageId) {
            case 'index': renderIndexPage(pageContainer); break;
            case 'post': renderPostPage(pageContainer, data); break;
            case 'profile': renderProfilePage(pageContainer); break;
            case 'favorites': renderFavoritesPage(pageContainer); break;
            case 'posts': renderPostsPage(pageContainer); break;
            case 'intentions': renderIntentionsPage(pageContainer); break;
            case 'report': renderReportPage(pageContainer); break;
            case 'detail': renderDetailPage(data); break;
        }
    }

    // --- ËßÜÂõæÂàáÊç¢ÂíåÁÆ°ÁêÜÁ´ØÈÄªËæë ---
    function toggleView() {
        isAdminView = !isAdminView;
        userView.classList.toggle('hidden', isAdminView);
        adminView.classList.toggle('hidden', !isAdminView);
        viewToggleBtn.textContent = isAdminView ? 'ÂàáÊç¢Âà∞Áî®Êà∑ËßÜÂõæ' : 'ÂàáÊç¢Âà∞ÁÆ°ÁêÜÂëòËßÜÂõæ';
        
        if (isAdminView) {
            renderAdminContent('listings');
        }
    }

    function renderAdminContent(page) {
        adminSidebarItems.forEach(item => item.classList.remove('active'));
        document.querySelector(`.sidebar-item[data-page="${page}"]`).classList.add('active');
        
        for (const key in adminContentPanels) {
            adminContentPanels[key].classList.toggle('hidden', key !== page);
        }
        
        switch (page) {
            case 'listings': renderListingsManagement(); break;
            case 'users': renderUserManagement(); break;
            case 'reports': renderReportManagement(); break;
            case 'settings': renderSettingsPage(); break;
            case 'data-maintenance': renderDataMaintenancePage(); break;
            case 'intentions': renderIntentionManagement(); break;
        }
    }

    function renderListingsManagement() {
        if (!adminListingsTable) return;
        adminListingsTable.innerHTML = '';

        const statusMap = { selling: 'Â∑≤‰∏äÊû∂', reviewing: 'ÂæÖÂÆ°Ê†∏', off: 'Â∑≤‰∏ãÊû∂' };
        const statusColorMap = { selling: 'status-selling', reviewing: 'status-reviewing', off: 'status-off' };

        mockListings.forEach(item => {
            const tr = document.createElement('tr');
            tr.className = "hover:bg-gray-50";
            tr.innerHTML = `
                <td class="p-3 text-sm text-gray-700">#${String(item.id).padStart(5, '0')}</td>
                <td class="p-3 text-sm text-gray-700">${item.title}</td>
                <td class="p-3 text-sm text-gray-700">${item.price} ‰∏á</td>
                <td class="p-3 text-sm"><span class="status-badge ${statusColorMap[item.status]}">${statusMap[item.status]}</span></td>
                <td class="p-3 text-sm">
                    ${item.status === 'reviewing' ? `
                        <button class="action-btn text-green-600 hover:bg-green-100" data-action="approve" data-id="${item.id}">ÈÄöËøá</button>
                        <button class="action-btn text-red-600 hover:bg-red-100" data-action="reject" data-id="${item.id}">È©≥Âõû</button>
                    ` : ''}
                    <button class="action-btn text-blue-600 hover:bg-blue-100" data-action="edit" data-id="${item.id}">ÁºñËæë</button>
                    <button class="action-btn text-gray-600 hover:bg-gray-100" data-action="delete" data-id="${item.id}">Âà†Èô§</button>
                </td>
            `;
            adminListingsTable.appendChild(tr);
        });

        adminListingsTable.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', handleListingAction);
        });
    }

    function renderUserManagement() {
        if (!adminUsersTable) return;
        adminUsersTable.innerHTML = '';

        const statusMap = { active: 'Ê≠£Â∏∏', banned: 'Â∑≤Â∞ÅÁ¶Å' };
        const statusColorMap = { active: 'status-active', banned: 'status-banned' };

        mockUsers.forEach(user => {
            const tr = document.createElement('tr');
            tr.className = "hover:bg-gray-50";
            tr.innerHTML = `
                <td class="p-3 text-sm text-gray-700">#${user.id}</td>
                <td class="p-3 text-sm text-gray-700">
                    <div class="flex items-center">
                        <img src="${user.avatar}" class="w-8 h-8 rounded-full object-cover mr-3">
                        <span>${user.nickname}</span>
                    </div>
                </td>
                <td class="p-3 text-sm text-gray-700">${user.phone}</td>
                <td class="p-3 text-sm text-gray-700">${user.registration_date}</td>
                <td class="p-3 text-sm"><span class="status-badge ${statusColorMap[user.status]}">${statusMap[user.status]}</span></td>
                <td class="p-3 text-sm">
                    ${user.status === 'active' 
                        ? `<button class="action-btn text-red-600 hover:bg-red-100" data-action="ban" data-id="${user.id}">Â∞ÅÁ¶Å</button>`
                        : `<button class="action-btn text-green-600 hover:bg-green-100" data-action="unban" data-id="${user.id}">Ëß£Â∞Å</button>`
                    }
                </td>
            `;
            adminUsersTable.appendChild(tr);
        });

        adminUsersTable.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', handleUserAction);
        });
    }

    function renderReportManagement() {
        if (!adminReportsTable) return;
        adminReportsTable.innerHTML = '';
        
        const statusMap = { pending: 'ÂæÖÂ§ÑÁêÜ', processed: 'Â∑≤Â§ÑÁêÜ' };
        const statusColorMap = { pending: 'status-pending', processed: 'status-processed' };

        mockReports.forEach(report => {
            const listing = mockListings.find(l => l.id === report.listingId);
            if (!listing) return;

            const tr = document.createElement('tr');
            tr.className = "hover:bg-gray-50";
            tr.innerHTML = `
                <td class="p-3 text-sm text-gray-700">#${report.id}</td>
                <td class="p-3 text-sm text-gray-700">${listing.title}</td>
                <td class="p-3 text-sm text-gray-700">${report.reason}</td>
                <td class="p-3 text-sm"><span class="status-badge ${statusColorMap[report.status]}">${statusMap[report.status]}</span></td>
                <td class="p-3 text-sm">
                     <button class="action-btn text-blue-600 hover:bg-blue-100" data-action="view" data-id="${listing.id}">Êü•ÁúãËΩ¶ËæÜ</button>
                    ${report.status === 'pending' ? `<button class="action-btn text-green-600 hover:bg-green-100" data-action="process" data-id="${report.id}">Ê†áËÆ∞Â∑≤Â§ÑÁêÜ</button>` : ''}
                </td>
            `;
            adminReportsTable.appendChild(tr);
        });

        adminReportsTable.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', handleReportAction);
        });
    }
    
    function renderIntentionManagement() {
        const container = adminContentPanels.intentions;
        if (!container) return;

        container.innerHTML = `
            <h1 class="text-2xl font-bold text-gray-800 mb-6">ÊÑèÂêëÁÆ°ÁêÜ</h1>
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label for="filter-intention-type" class="block text-sm font-medium text-gray-700">ËÆæÂ§áÁ±ªÂûã</label>
                        <select id="filter-intention-type" class="mt-1 block w-full form-select"></select>
                    </div>
                    <div>
                        <label for="filter-intention-brand" class="block text-sm font-medium text-gray-700">ÂìÅÁâå</label>
                        <select id="filter-intention-brand" class="mt-1 block w-full form-select"></select>
                    </div>
                    <div>
                        <label for="filter-intention-province" class="block text-sm font-medium text-gray-700">ÁúÅ‰ªΩ</label>
                        <select id="filter-intention-province" class="mt-1 block w-full form-select"></select>
                    </div>
                    <div class="flex items-end space-x-2">
                        <button id="apply-intention-filters" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600">Á≠õÈÄâ</button>
                        <button id="reset-intention-filters" class="w-full bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600">ÈáçÁΩÆ</button>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="p-3 text-left text-sm font-semibold text-gray-600">ÊÑèÂêëID</th>
                            <th class="p-3 text-left text-sm font-semibold text-gray-600">Áî®Êà∑</th>
                            <th class="p-3 text-left text-sm font-semibold text-gray-600">ÊÑèÂêëËØ¶ÊÉÖ</th>
                            <th class="p-3 text-left text-sm font-semibold text-gray-600">Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody id="admin-intentions-table" class="divide-y divide-gray-200"></tbody>
                </table>
            </div>
        `;

        const typeSelect = document.getElementById('filter-intention-type');
        const brandSelect = document.getElementById('filter-intention-brand');
        const provinceSelect = document.getElementById('filter-intention-province');
        const applyBtn = document.getElementById('apply-intention-filters');
        const resetBtn = document.getElementById('reset-intention-filters');

        // Populate filters
        populateSelect(typeSelect, ['‰∏çÈôê', ...Object.keys(equipmentData)]);
        populateSelect(brandSelect, ['‰∏çÈôê']);
        populateSelect(provinceSelect, ['‰∏çÈôê', ...Object.keys(chinaLocations)]);
        
        typeSelect.addEventListener('change', (e) => {
            const selectedType = e.target.value;
            if (selectedType === '‰∏çÈôê') {
                const allBrands = ["‰∏çÈôê", ...new Set(Object.values(equipmentData).flatMap(type => type.brands))];
                populateSelect(brandSelect, allBrands);
            } else {
                const brands = equipmentData[selectedType] ? ["‰∏çÈôê", ...equipmentData[selectedType].brands] : ["‰∏çÈôê"];
                populateSelect(brandSelect, brands);
            }
        });

        const applyFilters = () => {
            let filteredIntentions = [...mockIntentions];

            const type = typeSelect.value;
            const brand = brandSelect.value;
            const province = provinceSelect.value;

            if (type !== '‰∏çÈôê') {
                filteredIntentions = filteredIntentions.filter(i => i.type === type);
            }
            if (brand !== '‰∏çÈôê') {
                filteredIntentions = filteredIntentions.filter(i => i.brand === brand);
            }
            if (province !== '‰∏çÈôê') {
                filteredIntentions = filteredIntentions.filter(i => i.locations.some(loc => loc.province === province));
            }

            renderIntentionTable(filteredIntentions);
        };

        applyBtn.addEventListener('click', applyFilters);

        resetBtn.addEventListener('click', () => {
            typeSelect.value = '‰∏çÈôê';
            provinceSelect.value = '‰∏çÈôê';
            typeSelect.dispatchEvent(new Event('change')); // to reset brand dropdown
            brandSelect.value = '‰∏çÈôê';
            renderIntentionTable(mockIntentions);
        });

        // Initial render
        renderIntentionTable(mockIntentions);
    }

    function renderIntentionTable(intentions) {
        const tableBody = document.getElementById('admin-intentions-table');
        if (!tableBody) return;
        tableBody.innerHTML = '';

        intentions.forEach(intention => {
            const user = mockUsers.find(u => u.id === intention.userId);
            const locationsText = intention.locations.map(loc => `${loc.province.replace(/ÁúÅ|Â∏Ç/, '')}-${loc.city.replace(/Â∏Ç/, '')}`).join(', ');

            const tr = document.createElement('tr');
            tr.className = "hover:bg-gray-50";
            tr.innerHTML = `
                <td class="p-3 text-sm text-gray-700">#${intention.id}</td>
                <td class="p-3 text-sm text-gray-700">
                    <div class="flex items-center">
                        ${user ? `<img src="${user.avatar}" class="w-8 h-8 rounded-full object-cover mr-3"><span>${user.nickname}</span>` : 'Êú™Áü•Áî®Êà∑'}
                    </div>
                </td>
                <td class="p-3 text-sm text-gray-700">
                    <p><strong>Á±ªÂûã:</strong> ${intention.type}</p>
                    <p><strong>ÂìÅÁâå:</strong> ${intention.brand}</p>
                    <p><strong>ËßÑÊ†º:</strong> ${intention.tonnage || '‰∏çÈôê'}</p>
                    <p><strong>Âú∞Âå∫:</strong> ${locationsText}</p>
                </td>
                <td class="p-3 text-sm">
                     <button class="action-btn text-red-600 hover:bg-red-100" data-action="delete" data-id="${intention.id}">Âà†Èô§</button>
                </td>
            `;
            tableBody.appendChild(tr);
        });

        tableBody.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', handleIntentionAction);
        });
    }


    function renderDataMaintenancePage() {
        const container = adminContentPanels['data-maintenance'].querySelector('.bg-white');
        if (!container) return;
        container.innerHTML = `
            <div>
                <h4 class="text-md font-semibold text-gray-600 mb-2">ËÆæÂ§áÁ±ªÂûãÁÆ°ÁêÜ</h4>
                <div id="types-list" class="space-y-2"></div>
                <div class="flex items-center mt-2">
                    <input type="text" id="new-type-name" class="form-input w-48 mr-2" placeholder="Êñ∞Á±ªÂûãÂêçÁß∞">
                    <input type="text" id="new-type-unit" class="form-input w-24 mr-2" placeholder="Âçï‰Ωç(Âê®/Á±≥)">
                    <button id="add-new-type" class="bg-blue-500 text-white px-4 py-2 rounded-md">Ê∑ªÂä†Á±ªÂûã</button>
                </div>
            </div>
            <div>
                <h4 class="text-md font-semibold text-gray-600 mb-2 mt-6">ÂìÅÁâåÁÆ°ÁêÜ</h4>
                <select id="brand-type-select" class="form-select w-48 mb-2"></select>
                <div id="brands-list" class="space-y-2"></div>
                 <div class="flex items-center mt-2">
                    <input type="text" id="new-brand-name" class="form-input w-48 mr-2" placeholder="Êñ∞ÂìÅÁâåÂêçÁß∞">
                    <button id="add-new-brand" class="bg-blue-500 text-white px-4 py-2 rounded-md">Ê∑ªÂä†ÂìÅÁâå</button>
                </div>
            </div>
        `;

        renderTypeManagement();
        
        const brandTypeSelect = document.getElementById('brand-type-select');
        populateSelect(brandTypeSelect, Object.keys(equipmentData));
        brandTypeSelect.addEventListener('change', () => renderBrandManagement(brandTypeSelect.value));
        renderBrandManagement(brandTypeSelect.value);

        document.getElementById('add-new-type').addEventListener('click', addNewType);
        document.getElementById('add-new-brand').addEventListener('click', addNewBrand);
    }
    
    function renderSettingsPage() {
        // This function is for the main settings page, which is now simpler.
    }
    
    function renderTypeManagement() {
        const list = document.getElementById('types-list');
        list.innerHTML = '';
        for (const type in equipmentData) {
            const item = document.createElement('div');
            item.className = 'flex items-center justify-between p-2 bg-gray-50 rounded';
            item.innerHTML = `<span>${type} (Âçï‰Ωç: ${equipmentData[type].unit})</span>
                              <button data-type="${type}" class="text-red-500 hover:text-red-700 text-sm delete-type-btn">Âà†Èô§</button>`;
            list.appendChild(item);
        }
        document.querySelectorAll('.delete-type-btn').forEach(btn => btn.addEventListener('click', deleteType));
    }

    function renderBrandManagement(type) {
        const list = document.getElementById('brands-list');
        list.innerHTML = '';
        if (!equipmentData[type]) return;

        equipmentData[type].brands.forEach(brand => {
            const item = document.createElement('div');
            item.className = 'flex items-center justify-between p-2 bg-gray-50 rounded';
            item.innerHTML = `<span>${brand}</span>
                              <button data-type="${type}" data-brand="${brand}" class="text-red-500 hover:text-red-700 text-sm delete-brand-btn">Âà†Èô§</button>`;
            list.appendChild(item);
        });
         document.querySelectorAll('.delete-brand-btn').forEach(btn => btn.addEventListener('click', deleteBrand));
    }


    function addNewType() {
        const nameInput = document.getElementById('new-type-name');
        const unitInput = document.getElementById('new-type-unit');
        const name = nameInput.value.trim();
        const unit = unitInput.value.trim();
        if (name && unit && !equipmentData[name]) {
            equipmentData[name] = { brands: [], unit: unit };
            renderTypeManagement();
            const brandTypeSelect = document.getElementById('brand-type-select');
            populateSelect(brandTypeSelect, Object.keys(equipmentData));
            nameInput.value = '';
            unitInput.value = '';
            showNotification(`Á±ªÂûã "${name}" Â∑≤Ê∑ªÂä†`);
        } else {
            showNotification('ËØ∑ËæìÂÖ•ÊúâÊïà‰∏î‰∏çÈáçÂ§çÁöÑÁ±ªÂûãÂêçÁß∞ÂíåÂçï‰Ωç', 'error');
        }
    }

    function deleteType(e) {
        const type = e.target.dataset.type;
        showConfirmModal(`Á°ÆÂÆöË¶ÅÂà†Èô§Á±ªÂûã "${type}" ÂêóÔºüÂÖ∂‰∏ãÊâÄÊúâÂìÅÁâå‰πüÂ∞ÜË¢´Âà†Èô§„ÄÇ`, () => {
            delete equipmentData[type];
            renderTypeManagement();
            const brandTypeSelect = document.getElementById('brand-type-select');
            populateSelect(brandTypeSelect, Object.keys(equipmentData));
            renderBrandManagement(brandTypeSelect.value);
            showNotification(`Á±ªÂûã "${type}" Â∑≤Âà†Èô§`);
        });
    }

    function addNewBrand() {
        const type = document.getElementById('brand-type-select').value;
        const nameInput = document.getElementById('new-brand-name');
        const name = nameInput.value.trim();
        if (name && equipmentData[type] && !equipmentData[type].brands.includes(name)) {
            equipmentData[type].brands.push(name);
            renderBrandManagement(type);
            nameInput.value = '';
            showNotification(`ÂìÅÁâå "${name}" Â∑≤Ê∑ªÂä†Âà∞ "${type}"`);
        } else {
             showNotification('ËØ∑ËæìÂÖ•ÊúâÊïà‰∏î‰∏çÈáçÂ§çÁöÑÂìÅÁâåÂêçÁß∞', 'error');
        }
    }

    function deleteBrand(e) {
        const {type, brand} = e.target.dataset;
        showConfirmModal(`Á°ÆÂÆöË¶Å‰ªé "${type}" ‰∏≠Âà†Èô§ÂìÅÁâå "${brand}" ÂêóÔºü`, () => {
            const brandIndex = equipmentData[type].brands.indexOf(brand);
            if (brandIndex > -1) {
                equipmentData[type].brands.splice(brandIndex, 1);
                renderBrandManagement(type);
                showNotification(`ÂìÅÁâå "${brand}" Â∑≤Âà†Èô§`);
            }
        });
    }


    function handleListingAction(e) {
        const { action, id } = e.target.dataset;
        const listing = mockListings.find(item => item.id === parseInt(id));
        if (!listing) return;

        switch(action) {
            case 'approve':
                listing.status = 'selling';
                showNotification(`ÁºñÂè∑ #${id} Â∑≤ÂÆ°Ê†∏ÈÄöËøáÂπ∂‰∏äÊû∂„ÄÇ`);
                renderListingsManagement();
                break;
            case 'reject':
                showConfirmModal(`Á°ÆÂÆöË¶ÅÈ©≥ÂõûÁºñÂè∑ #${id} Âêó?`, () => {
                    listing.status = 'off';
                    showNotification(`ÁºñÂè∑ #${id} Â∑≤Ë¢´È©≥Âõû„ÄÇ`);
                    renderListingsManagement();
                });
                break;
            case 'edit':
                 openAdminEditModal(parseInt(id));
                break;
            case 'delete':
                showConfirmModal(`Á°ÆÂÆöË¶ÅÊ∞∏‰πÖÂà†Èô§ÁºñÂè∑ #${id} Âêó?`, () => {
                    mockListings = mockListings.filter(item => item.id !== parseInt(id));
                    showNotification(`ÁºñÂè∑ #${id} Â∑≤Ë¢´Âà†Èô§„ÄÇ`);
                    renderListingsManagement();
                });
                break;
        }
    }

    function handleUserAction(e) {
        const { action, id } = e.target.dataset;
        const user = mockUsers.find(u => u.id === parseInt(id));
        if (!user) return;

        if (action === 'ban') {
            showConfirmModal(`Á°ÆÂÆöË¶ÅÂ∞ÅÁ¶ÅÁî®Êà∑ ‚Äú${user.nickname}‚Äù Âêó?`, () => {
                user.status = 'banned';
                showNotification(`Áî®Êà∑ ‚Äú${user.nickname}‚Äù Â∑≤Ë¢´Â∞ÅÁ¶Å„ÄÇ`);
                renderUserManagement();
            });
        } else if (action === 'unban') {
            user.status = 'active';
            showNotification(`Áî®Êà∑ ‚Äú${user.nickname}‚Äù Â∑≤Ëß£Â∞Å„ÄÇ`);
            renderUserManagement();
        }
    }

    function handleReportAction(e) {
        const { action, id } = e.target.dataset;
        if (action === 'view') {
             openAdminEditModal(parseInt(id), { readOnly: true });
        } else if (action === 'process') {
            const report = mockReports.find(r => r.id === parseInt(id));
            if (report) {
                report.status = 'processed';
                showNotification(`‰∏æÊä• #${id} Â∑≤Ê†áËÆ∞‰∏∫Â§ÑÁêÜ„ÄÇ`);
                renderReportManagement();
            }
        }
    }
    
    function handleIntentionAction(e) {
        const { action, id } = e.target.dataset;
        if (action === 'delete') {
            showConfirmModal(`Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ÊÑèÂêëÂêó (ID: #${id})Ôºü`, () => {
                mockIntentions = mockIntentions.filter(i => i.id !== parseInt(id));
                document.getElementById('apply-intention-filters').click(); // Re-apply filters
                showNotification('ÊÑèÂêëÂ∑≤Âà†Èô§');
            });
        }
    }

    // --- Áî®Êà∑Á´ØÈ°µÈù¢Ê∏≤Êüì ---
    function renderIndexPage(container) {
    container.innerHTML = `
        <div class="w-full">
            <div class="bg-white p-4 border-b border-gray-200">
                <div class="filter-toggle flex justify-between items-center cursor-pointer">
                    <span class="text-base font-medium text-gray-800">Â±ïÂºÄÁ≠õÈÄâ</span>
                    <div class="filter-arrow"></div>
                </div>
                <div class="filter-content hidden mt-4 space-y-4">
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">Âú∞Âå∫:</label><select class="province-select col-span-2 form-select"></select><select class="city-select col-span-2 form-select"></select></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">Êù•Ê∫ê:</label><select class="source-select col-span-4 form-select"></select></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">Á±ªÂûã:</label><select class="type-select col-span-4 form-select"></select></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">ÂìÅÁâå:</label><select class="brand-select col-span-4 form-select"></select></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label id="spec-label" class="col-span-1 text-sm text-gray-600">ËßÑÊ†º:</label><input class="spec-input col-span-4 form-input" placeholder="ËØ∑ÂÖàÈÄâÊã©Á±ªÂûã" /></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">ÊéíÊîæ:</label><select class="emission-select col-span-4 form-select"></select></div>
                     <div class="flex space-x-4 mt-4"><button id="reset-filters" class="flex-1 bg-yellow-500 text-white py-2 rounded-md">ÈáçÁΩÆ</button><button id="apply-filters" class="flex-1 bg-blue-500 text-white py-2 rounded-md">Á≠õÈÄâ</button></div>
                </div>
            </div>
            <div class="listings-container p-3 space-y-3"></div>
        </div>
    `;
    renderListings(container.querySelector('.listings-container'), mockListings.filter(l => l.status === 'selling'));
    
    container.querySelector('.filter-toggle').addEventListener('click', (e) => {
        const content = container.querySelector('.filter-content');
        const arrow = e.currentTarget.querySelector('.filter-arrow');
        const label = e.currentTarget.querySelector('span');
        content.classList.toggle('hidden');
        arrow.classList.toggle('up');
        label.textContent = content.classList.contains('hidden') ? "Â±ïÂºÄÁ≠õÈÄâ" : "Êî∂Ëµ∑Á≠õÈÄâ";
    });
    
    const provinceSelect = container.querySelector('.province-select');
    const citySelect = container.querySelector('.city-select');
    const typeSelect = container.querySelector('.type-select');
    const brandSelect = container.querySelector('.brand-select');
    const sourceSelect = container.querySelector('.source-select');
    const specInput = container.querySelector('.spec-input');
    const specLabel = container.querySelector('#spec-label');
    const emissionSelect = container.querySelector('.emission-select');
    const applyBtn = container.querySelector('#apply-filters');
    const resetBtn = container.querySelector('#reset-filters');

    // Populate selects
    populateSelect(provinceSelect, ["‰∏çÈôê", ...Object.keys(chinaLocations)]);
    populateSelect(citySelect, ['‰∏çÈôê']);
    citySelect.disabled = true;
    const equipmentTypesForFilter = ['‰∏çÈôê', ...Object.keys(equipmentData)];
    populateSelect(typeSelect, equipmentTypesForFilter);
    const allBrands = ["‰∏çÈôê", ...new Set(Object.values(equipmentData).flatMap(type => type.brands))];
    populateSelect(brandSelect, allBrands);
    populateSelect(sourceSelect, ["‰∏çÈôê", "ËΩ¶‰∏ªÁõ¥Âçñ", "‰∏≠‰ªã‰ø°ÊÅØ", "‰∫åÊâãËΩ¶ÂïÜ"]);
    populateSelect(emissionSelect, emissionOptions);

    // Event listeners for filters
    provinceSelect.addEventListener('change', (e) => {
        const cities = chinaLocations[e.target.value] ? ["‰∏çÈôê", ...chinaLocations[e.target.value]] : ["‰∏çÈôê"];
        populateSelect(citySelect, cities);
        citySelect.disabled = (e.target.value === '‰∏çÈôê');
    });
    
    typeSelect.addEventListener('change', (e) => {
        const selectedType = e.target.value;
        const data = equipmentData[selectedType];
        
        if (data) {
            populateSelect(brandSelect, ["‰∏çÈôê", ...data.brands]);
        } else {
            populateSelect(brandSelect, allBrands);
        }

        if(data) {
            specLabel.textContent = data.unit === 'ÂûãÂè∑' ? 'ÂûãÂè∑:' : `${data.unit}:`;
            specInput.placeholder = `ËØ∑ËæìÂÖ•${data.unit}`;
        } else {
             specLabel.textContent = 'ËßÑÊ†º:';
             specInput.placeholder = 'ËØ∑ÂÖàÈÄâÊã©Á±ªÂûã';
        }
    });

    applyBtn.addEventListener('click', () => {
        let filteredListings = mockListings.filter(l => l.status === 'selling');

        const province = provinceSelect.value;
        const city = citySelect.value;
        const type = typeSelect.value;
        const brand = brandSelect.value;
        const source = sourceSelect.value;
        const spec = specInput.value;
        const emission = emissionSelect.value;

        if (province !== '‰∏çÈôê') {
            filteredListings = filteredListings.filter(l => l.location.startsWith(province));
            if (city !== '‰∏çÈôê') {
                 filteredListings = filteredListings.filter(l => l.location === `${province} ${city}`);
            }
        }
        if (type !== '‰∏çÈôê') {
            filteredListings = filteredListings.filter(l => l.type === type);
        }
        if (brand !== '‰∏çÈôê') {
            filteredListings = filteredListings.filter(l => l.brand === brand);
        }
        if (source !== '‰∏çÈôê') {
            filteredListings = filteredListings.filter(l => l.tags[0] === source);
        }
         if (spec) {
            filteredListings = filteredListings.filter(l => l.tonnage == spec);
        }
        if (emission !== '‰∏çÈôê') {
            filteredListings = filteredListings.filter(l => l.tags.includes(emission));
        }
        
        renderListings(container.querySelector('.listings-container'), filteredListings);
    });

    resetBtn.addEventListener('click', () => {
        provinceSelect.value = '‰∏çÈôê';
        citySelect.innerHTML = '<option>‰∏çÈôê</option>';
        citySelect.disabled = true;
        typeSelect.value = '‰∏çÈôê';
        brandSelect.value = '‰∏çÈôê';
        sourceSelect.value = '‰∏çÈôê';
        specInput.value = '';
        emissionSelect.value = '‰∏çÈôê';
        typeSelect.dispatchEvent(new Event('change'));
        renderListings(container.querySelector('.listings-container'), mockListings.filter(l => l.status === 'selling'));
    });
}
function renderListings(container, list) {
    if (!container) return;
    container.innerHTML = '';
    if (list.length === 0) {
        container.innerHTML = `<p class="text-center text-gray-500 p-8">Ê≤°ÊúâÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑËΩ¶ËæÜ</p>`;
        return;
    }
    list.forEach(item => {
        const div = document.createElement('div');
        div.className = 'bg-white rounded-lg p-3 shadow-sm relative overflow-hidden cursor-pointer';
        div.dataset.id = item.id;
        div.innerHTML = `
            <div class="absolute top-3 left-3 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded-full">${item.tags[0]}</div>
            <img src="${item.images[0]}" alt="${item.title}" class="w-full h-40 object-cover rounded-md mb-3" onerror="this.onerror=null;this.src='https://placehold.co/800x600/ccc/FFF?text=Image+Not+Found';">
            <div class="space-y-2">
                <h3 class="text-lg font-bold text-gray-800">${item.title}</h3>
                <div class="flex space-x-2">
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">${item.type}</span>
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">${item.tags[2]}</span>
                </div>
                <div class="text-xs text-gray-500 space-y-1">
                    <p>Âá∫ÂéÇÊó•Êúü: ${item.manufacture_date}</p><p>ÂèëÂ∏ÉÊó∂Èó¥: ${item.post_date}</p><p>ÊâÄÂú®Âú∞Âå∫: ${item.location}</p>
                </div>
                <div class="flex justify-between items-center pt-2">
                    <span class="text-xl font-bold text-red-500">${item.price}‰∏á</span>
                    <button class="call-btn bg-blue-500 text-white text-sm px-4 py-2 rounded-full" data-phone="${item.phone}">Êã®ÊâìÁîµËØù</button>
                </div>
            </div>
        `;
        div.addEventListener('click', (e) => {
            if (!e.target.closest('.call-btn')) {
               navigateTo('detail', 'ËΩ¶ËæÜËØ¶ÊÉÖ', parseInt(e.currentTarget.dataset.id));
            }
        });
        container.appendChild(div);
    });
}
function renderDetailPage(id) {
    const pageDetail = document.getElementById('page-detail');
    const item = mockListings.find(i => i.id === id);
    if (!item) return;

    const serialNumber = String(item.id).padStart(5, '0');

    let imageSlides = item.images.map(imgUrl => `
        <div class="flex-shrink-0 w-full h-full carousel-slide">
            <img src="${imgUrl}" class="w-full h-full object-cover cursor-pointer" onerror="this.onerror=null;this.src='https://placehold.co/800x600/ccc/FFF?text=Image+Not+Found';">
        </div>
    `).join('');

    const isFavorited = mockFavorites.includes(id);

    pageDetail.innerHTML = `
        <div class="w-full bg-gray-100 pb-20">
            <div class="relative w-full h-64 bg-black overflow-hidden">
                <div class="flex h-full carousel-container">${imageSlides}</div>
            </div>
            <div class="bg-white p-4 -mt-2 rounded-t-lg">
                <div class="flex justify-between items-start">
                    <h2 class="text-xl font-bold text-gray-800">${item.title}</h2>
                    <span class="text-sm text-gray-400 font-mono flex-shrink-0 ml-2 pt-1">ÁºñÂè∑: #${serialNumber}</span>
                </div>
                <p class="text-2xl font-bold text-red-500 my-2">${item.price} ‰∏á</p>
                <div class="flex space-x-2 my-3">
                    <span class="bg-gray-100 text-gray-700 text-xs font-medium px-2.5 py-1 rounded">${item.type}</span>
                    <span class="bg-gray-100 text-gray-700 text-xs font-medium px-2.5 py-1 rounded">${item.tags[2]}</span>
                </div>
            </div>
            <div class="bg-white p-4 mt-2">
                <h3 class="font-semibold text-base mb-3 border-l-4 border-blue-500 pl-2">ËØ¶ÁªÜ‰ø°ÊÅØ</h3>
                <div class="grid grid-cols-2 gap-y-3 text-gray-600 text-sm">
                    <p><strong>ËÆæÂ§áÂìÅÁâå:</strong> ${item.brand}</p>
                    <p><strong>ËÆæÂ§áÂûãÂè∑:</strong> ${item.title.split(' - ')[0]}</p>
                    <p><strong>Â∑•‰ΩúÂ∞èÊó∂:</strong> ${item.work_hours} Â∞èÊó∂</p>
                    <p><strong>Ë°åÈ©∂ÈáåÁ®ã:</strong> ${item.mileage > 0 ? `${item.mileage} ÂÖ¨Èáå` : 'Êó†'}</p>
                    <p><strong>Âá∫ÂéÇÊó•Êúü:</strong> ${item.manufacture_date}</p>
                    <p><strong>ÊéíÊîæÊ†áÂáÜ:</strong> ${item.tags[2]}</p>
                    <p><strong>ÊâÄÂú®Âú∞Âå∫:</strong> ${item.location}</p>
                    <p><strong>ÂèëÂ∏ÉÊó∂Èó¥:</strong> ${item.post_date}</p>
                </div>
            </div>
             <div class="bg-white p-4 mt-2">
                <h3 class="font-semibold text-base mb-3 border-l-4 border-blue-500 pl-2">ËÅîÁ≥ªÊñπÂºè</h3>
                <div class="grid grid-cols-2 gap-y-3 text-gray-600 text-sm">
                     <p><strong>ËÅîÁ≥ª‰∫∫:</strong> ${item.contact_person}</p>
                     <p><strong>ËÅîÁ≥ªÁîµËØù:</strong> ${item.phone}</p>
                </div>
            </div>
            <div class="bg-white p-4 mt-2">
                 <h3 class="font-semibold text-base mb-3 border-l-4 border-blue-500 pl-2">ËØ¶ÊÉÖÊèèËø∞</h3>
                 <p class="text-gray-600 text-sm leading-relaxed">ËΩ¶ÂÜµËâØÂ•ΩÔºå‰øùÂÖªÂà∞‰ΩçÔºåÊâãÁª≠ÈΩêÂÖ®Ôºå‰∏™‰∫∫‰∏ÄÊâãËΩ¶ÔºåÈöèÊó∂ÂèØ‰ª•ÁúãËΩ¶...</p>
            </div>
        </div>
    `;
    
    detailActionBar.innerHTML = `
        <div class="h-full bg-white p-2 flex justify-between items-center text-sm text-gray-600">
             <div class="flex items-center space-x-4 pl-2">
                <span class="fav-btn cursor-pointer flex flex-col items-center" data-id="${id}">
                   <svg class="w-6 h-6 mb-1 ${isFavorited ? 'text-yellow-500' : 'text-gray-500'}" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                   <span>${isFavorited ? 'Â∑≤Êî∂Ëóè' : 'Êî∂Ëóè'}</span>
                </span>
                <span class="share-btn cursor-pointer flex flex-col items-center">
                   <svg class="w-6 h-6 mb-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.368a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path></svg>
                   <span>ÂàÜ‰∫´</span>
                </span>
                <span class="report-btn cursor-pointer flex flex-col items-center">
                    <svg class="w-6 h-6 mb-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>‰∏æÊä•</span>
                </span>
             </div>
             <button class="call-btn bg-blue-500 text-white py-3 px-8 rounded-full text-base font-semibold" data-phone="${item.phone}">‰∏ÄÈîÆÊã®Âè∑</button>
        </div>
    `;

    pageDetail.querySelectorAll('.carousel-slide img').forEach(img => img.addEventListener('click', () => openLightbox(img.src)));
    
    detailActionBar.querySelector('.report-btn').addEventListener('click', () => {
        navigateTo('report', '‰ø°ÊÅØ‰∏æÊä•');
    });
    detailActionBar.querySelector('.share-btn').addEventListener('click', () => showNotification('Â∑≤Ê®°ÊãüÂàÜ‰∫´Êìç‰Ωú'));
    detailActionBar.querySelector('.fav-btn').addEventListener('click', (e) => {
        const btn = e.currentTarget;
        const carId = parseInt(btn.dataset.id);
        const favIndex = mockFavorites.indexOf(carId);
        const isFavorited = favIndex > -1;

        if (isFavorited) {
            mockFavorites.splice(favIndex, 1);
        } else {
            mockFavorites.push(carId);
        }
        
        btn.innerHTML = `
            <svg class="w-6 h-6 mb-1 ${!isFavorited ? 'text-yellow-500' : 'text-gray-500'}" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
            <span>${!isFavorited ? 'Â∑≤Êî∂Ëóè' : 'Êî∂Ëóè'}</span>
        `;
        showNotification(!isFavorited ? 'Êî∂ËóèÊàêÂäü' : 'Â∑≤ÂèñÊ∂àÊî∂Ëóè');
    });
}
function renderPostPage(container, postToEditId = null) {
    const isEditing = postToEditId !== null;
    const postToEdit = isEditing ? mockListings.find(p => p.id === postToEditId) : null;
    const submitButtonText = isEditing ? '‰øùÂ≠ò‰øÆÊîπ' : 'Êèê‰∫§ÂÆ°Ê†∏';
    
    container.innerHTML = `
        <div class="w-full p-4 space-y-4 bg-white min-h-full">
            <div class="p-4 bg-gray-50 rounded-lg">
                <p class="font-medium text-gray-700 mb-2">ËΩ¶ËæÜÁÖßÁâá (ÊúÄÂ§ö9Âº†)</p>
                <div class="previews-container grid grid-cols-4 gap-3">
                    <input type="file" class="image-upload hidden" multiple accept="image/*">
                    <div class="upload-trigger w-full h-20 bg-gray-200 rounded-md flex items-center justify-center cursor-pointer">
                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ÂèëÂ∏ÉËÄÖË∫´‰ªΩ</label><select id="post-identity-select" class="col-span-2 form-select"><option>ËΩ¶‰∏ªÁõ¥Âçñ</option><option>‰∏≠‰ªã‰ø°ÊÅØ</option><option>‰∫åÊâãËΩ¶ÂïÜ</option></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ËÆæÂ§áÁ±ªÂûã</label><select id="post-type-select" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ÂìÅÁâå</label><select id="post-brand-select" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ÂûãÂè∑</label><input id="post-model-input" class="col-span-2 form-input" placeholder="ËØ∑ËæìÂÖ•ÂûãÂè∑"></div>
                <div class="grid grid-cols-3 items-center"><label id="post-spec-label" class="col-span-1">ËßÑÊ†º</label><input type="number" id="post-spec-input" class="col-span-2 form-input" placeholder="ËØ∑ÈÄâÊã©Á±ªÂûã"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">‰ª∑Ê†º(‰∏á)</label><input type="number" id="post-price-input" class="col-span-2 form-input" placeholder="ÁïôÁ©∫ÂàôÊòæÁ§∫‚ÄúÈù¢ËÆÆ‚Äù"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ÊâÄÂú®Âú∞</label><div class="col-span-2 grid grid-cols-2 gap-2"><select id="post-province-select" class="form-select"></select><select id="post-city-select" class="form-select"></select></div></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">Âá∫ÂéÇÊó•Êúü</label><input id="post-date-input" type="month" class="col-span-2 form-input"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ÊéíÊîæÊ†áÂáÜ</label><select id="post-emission-select" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">Â∑•‰ΩúÂ∞èÊó∂</label><input id="post-work-hours" type="number" class="col-span-2 form-input" placeholder="ËØ∑ËæìÂÖ•Â∑•‰ΩúÂ∞èÊó∂"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">Ë°åÈ©∂ÈáåÁ®ã</label><input id="post-mileage" type="number" class="col-span-2 form-input" placeholder="ËØ∑ËæìÂÖ•Ë°åÈ©∂ÈáåÁ®ã(ÂÖ¨Èáå)"></div>
                <div><label>ËΩ¶ÂÜµÊèèËø∞</label><textarea class="form-textarea mt-2" rows="4" placeholder="ËØ∑ËæìÂÖ•ËΩ¶ÂÜµÊèèËø∞..."></textarea></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ËÅîÁ≥ª‰∫∫</label><input id="post-contact-person" class="col-span-2 form-input" placeholder="ËØ∑ËæìÂÖ•ËÅîÁ≥ª‰∫∫ÂßìÂêç"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ËÅîÁ≥ªÁîµËØù</label><input id="post-phone" type="tel" class="col-span-2 form-input" placeholder="ËØ∑ËæìÂÖ•ËÅîÁ≥ªÁîµËØù"></div>
            </div>
            
            <button id="save-post-btn" class="w-full bg-blue-500 text-white py-3 rounded-lg text-lg font-semibold mt-6">${submitButtonText}</button>
        </div>
    `;
    const uploadTrigger = container.querySelector('.upload-trigger');
    const imageUploadInput = container.querySelector('.image-upload');
    uploadTrigger.addEventListener('click', () => imageUploadInput.click());
    imageUploadInput.addEventListener('change', (e) => handleImageUpload(e, container));
    
    const typeSelect = container.querySelector('#post-type-select');
    const brandSelect = container.querySelector('#post-brand-select');
    const specLabel = container.querySelector('#post-spec-label');
    const specInput = container.querySelector('#post-spec-input');
    const provinceSelect = container.querySelector('#post-province-select');
    const citySelect = container.querySelector('#post-city-select');

    populateSelect(typeSelect, Object.keys(equipmentData));
    typeSelect.addEventListener('change', e => {
        const type = e.target.value;
        const data = equipmentData[type];
        populateSelect(brandSelect, data ? data.brands : []);
        specLabel.textContent = data ? `${data.unit}:` : `ËßÑÊ†º:`;
        specInput.placeholder = data ? `ËØ∑ËæìÂÖ•${data.unit}` : `ËØ∑ÈÄâÊã©Á±ªÂûã`;
    });
    
    populateSelect(provinceSelect, Object.keys(chinaLocations));
    provinceSelect.addEventListener('change', e => {
        populateSelect(citySelect, chinaLocations[e.target.value] || []);
    });
    
    populateSelect(container.querySelector('#post-emission-select'), emissionOptions.slice(1));
    
    if(isEditing && postToEdit) {
        typeSelect.value = postToEdit.type;
        typeSelect.dispatchEvent(new Event('change'));
        brandSelect.value = postToEdit.brand;
        container.querySelector('#post-model-input').value = postToEdit.title.split(' - ')[0]; 
        specInput.value = postToEdit.tonnage;
        container.querySelector('#post-price-input').value = postToEdit.price;
        container.querySelector('#post-work-hours').value = postToEdit.work_hours;
        container.querySelector('#post-mileage').value = postToEdit.mileage;
        container.querySelector('#post-contact-person').value = postToEdit.contact_person;
        container.querySelector('#post-phone').value = postToEdit.phone;
        const [province, city] = postToEdit.location.split(' ');
        provinceSelect.value = Object.keys(chinaLocations).find(p => p.startsWith(province));
        provinceSelect.dispatchEvent(new Event('change'));
        citySelect.value = city;
        container.querySelector('#post-date-input').value = postToEdit.manufacture_date;
        container.querySelector('#post-emission-select').value = postToEdit.tags[2];
        handleImageUpload({ target: { files: [] }}, container, postToEdit.images);
    } else {
         typeSelect.dispatchEvent(new Event('change'));
         provinceSelect.dispatchEvent(new Event('change'));
    }

    container.querySelector('#save-post-btn').addEventListener('click', () => {
         showNotification(isEditing ? '‰øÆÊîπÂ∑≤‰øùÂ≠ò' : 'Â∑≤Êèê‰∫§ÂÆ°Ê†∏');
         navigateBack();
    });
}
function renderProfilePage(container) {
    container.innerHTML = `
         <div class="w-full">
             <div class="p-6 bg-white flex items-center space-x-4">
                 <img src="https://picsum.photos/seed/avatar/80/80" class="w-20 h-20 rounded-full object-cover" alt="avatar" />
                 <div>
                     <p class="text-xl font-bold">ÂêäËΩ¶Â§ßÁéã</p>
                     <p class="text-sm text-gray-500 mt-1">ID: user_123456</p>
                 </div>
             </div>
             <div class="mt-4 bg-white profile-menu">
                 <div class="p-4 border-b border-gray-200 flex justify-between items-center cursor-pointer" data-page="favorites"><span>ÊàëÁöÑÊî∂Ëóè</span><span>&gt;</span></div>
                 <div class="p-4 border-b border-gray-200 flex justify-between items-center cursor-pointer" data-page="posts"><span>ÊàëÁöÑÂèëÂ∏É</span><span>&gt;</span></div>
                 <div class="p-4 border-b border-gray-200 flex justify-between items-center cursor-pointer" data-page="intentions"><span>ÊÑèÂêëËΩ¶Âûã</span><span>&gt;</span></div>
             </div>
         </div>
    `;
    container.querySelector('.profile-menu').addEventListener('click', (e) => {
        const target = e.target.closest('div[data-page]');
        if (target) {
            const pageId = target.dataset.page;
            const title = target.querySelector('span').textContent;
            navigateTo(pageId, title);
        }
    });
}
function renderReportPage(container) {
    container.innerHTML = `
        <div class="w-full p-4 space-y-5">
            <div class="bg-blue-50 p-3 rounded-lg text-sm text-blue-700"><strong>ËØ¥Êòé:</strong> ÂùöÂÜ≥Á¶ÅÊ≠¢ÈùûÊ≥ï„ÄÅËôöÂÅáÁ≠â‰ø°ÊÅØÔºåÊÇ®ÁöÑÊäïËØâÊàë‰ª¨‰ºöËÆ§ÁúüÊü•ÂÆûÂπ∂Ê†πÊçÆÂπ≥Âè∞ÂçèËÆÆËøõË°åËêΩÂÆûÔºÅ</div>
            <div class="bg-white p-4 rounded-lg space-y-4"><p class="font-semibold">ËΩ¶ËæÜ‰ø°ÊÅØ</p>
                <label class="flex items-center space-x-3"><input type="radio" name="report_reason" class="form-radio h-5 w-5 text-blue-600" checked><span>ËôöÂÅá‰ø°ÊÅØ</span></label>
                <label class="flex items-center space-x-3"><input type="radio" name="report_reason" class="form-radio h-5 w-5 text-blue-600"><span>ËΩ¶ËæÜÂ∑≤ÂîÆ</span></label>
                <label class="flex items-center space-x-3"><input type="radio" name="report_reason" class="form-radio h-5 w-5 text-blue-600"><span>‰∏≠‰ªãËΩ¶Ê∫ê/ËΩ¶‰∏ªËΩ¶Ê∫ê Ê†áËØÜÈîôËØØ</span></label>
            </div>
            <div class="bg-white p-4 rounded-lg"><p class="font-semibold mb-2">ÊäïËØâÁêÜÁî±</p><textarea class="w-full h-32 p-2 bg-gray-50 rounded-md focus:outline-none" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑ‰∏æÊä•ÁêÜÁî±..."></textarea></div>
            <button class="w-full bg-blue-500 text-white py-3 rounded-lg text-lg font-semibold">Êèê‰∫§</button>
            <p class="text-xs text-gray-500 mt-2">*ÂÖçË¥£Â£∞Êòé: Âπ≥Âè∞‰ªÖÊèê‰æõ‰ø°ÊÅØÂ±ïÁ§∫ÊúçÂä°, ÂÜÖÂÆπÁúüÂÆûÊÄßÁî±Áî®Êà∑Ëá™Ë°åÂÆ°Ê†∏, Ëá™Ë°åË¥üË¥£„ÄÇ</p>
        </div>
    `;
}
function renderFavoritesPage(page) {
    const favList = mockListings.filter(item => mockFavorites.includes(item.id));
    
    if (favList.length === 0) {
        page.innerHTML = `<div class="text-center p-10 text-gray-500">‰Ω†ËøòÊ≤°ÊúâÊî∂Ëóè‰ªª‰ΩïËΩ¶ËæÜ</div>`;
        return;
    }

    let content = '<div class="p-3 space-y-3">';
    favList.forEach(item => {
        content += `
         <div class="bg-white rounded-lg p-3 shadow-sm flex items-center space-x-4">
             <div class="flex-1 flex items-center space-x-4 cursor-pointer item-link" data-id="${item.id}">
                 <img src="${item.images[0]}" class="w-24 h-24 object-cover rounded-md flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/200/ccc/FFF?text=N/A';">
                 <div class="flex-1">
                     <h4 class="font-bold text-gray-800">${item.title}</h4>
                     <p class="text-sm text-gray-500">${item.location}</p>
                     <p class="text-lg font-bold text-red-500 mt-2">${item.price}‰∏á</p>
                 </div>
             </div>
             <button class="unfav-btn text-sm bg-gray-200 px-3 py-1 rounded-full flex-shrink-0" data-id="${item.id}">ÂèñÊ∂àÊî∂Ëóè</button>
        </div>`;
    });
    content += '</div>';
    page.innerHTML = content;
    
    page.querySelectorAll('.item-link').forEach(link => {
        link.addEventListener('click', e => {
            const carId = parseInt(e.currentTarget.dataset.id);
            navigateTo('detail', 'ËΩ¶ËæÜËØ¶ÊÉÖ', carId);
        });
    });

    page.querySelectorAll('.unfav-btn').forEach(btn => btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const carId = parseInt(e.target.dataset.id);
        showConfirmModal('Á°ÆÂÆöË¶ÅÂèñÊ∂àÊî∂ËóèÂêó?', () => {
            const favIndex = mockFavorites.indexOf(carId);
            if (favIndex > -1) {
                mockFavorites.splice(favIndex, 1);
                renderFavoritesPage(page); 
            }
        });
    }));
}
function renderPostsPage(page) {
    let content = '<div class="p-3 space-y-3">';
    const userPostings = mockListings.filter(listing => mockMyPosts.some(p => p.id === listing.id));
    
    userPostings.forEach(item => {
        const statusMap = { selling: 'Â∑≤‰∏äÊû∂', reviewing: 'ÂÆ°Ê†∏‰∏≠', off: 'Â∑≤‰∏ãÊû∂' };
        const statusColor = { selling: 'text-green-600', reviewing: 'text-yellow-600', off: 'text-gray-500' };

        content += `
         <div class="bg-white rounded-lg p-3 shadow-sm">
             <div class="flex space-x-4">
                 <img src="${item.images[0]}" class="w-24 h-24 object-cover rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/200/ccc/FFF?text=N/A';">
                 <div class="flex-1">
                     <h4 class="font-bold text-gray-800">${item.title}</h4>
                     <p class="text-sm font-semibold ${statusColor[item.status]} mt-2">${statusMap[item.status]}</p>
                 </div>
             </div>
             <div class="border-t border-gray-100 mt-3 pt-3 flex justify-end space-x-2">
                 ${item.status === 'off' ? `<button class="post-action-btn" data-action="list" data-id="${item.id}">‰∏äÊû∂</button>` : ''}
                 ${item.status === 'selling' ? `<button class="post-action-btn" data-action="unlist" data-id="${item.id}">‰∏ãÊû∂</button>` : ''}
                 <button class="post-action-btn" data-action="edit" data-id="${item.id}">ÁºñËæë</button>
                 <button class="post-action-btn text-red-500" data-action="delete" data-id="${item.id}">Âà†Èô§</button>
             </div>
        </div>`;
    });
    content += '</div>';
    page.innerHTML = content;
    
    page.querySelectorAll('.post-action-btn').forEach(btn => btn.addEventListener('click', e => {
        const action = e.target.dataset.action;
        const id = parseInt(e.target.dataset.id);
        const post = mockListings.find(p => p.id === id);

        if (action === 'delete') {
             showConfirmModal('Á°ÆÂÆöË¶ÅÂà†Èô§ÂêóÔºü', () => {
                 mockListings = mockListings.filter(p => p.id !== id);
                 mockMyPosts = mockMyPosts.filter(p => p.id !== id);
                 renderPostsPage(page);
             });
        } else if (action === 'list') {
             if (post) {
                 post.status = 'selling';
                 renderPostsPage(page);
             }
        } else if (action === 'unlist') {
             if (post) {
                 post.status = 'off';
                 renderPostsPage(page);
             }
        } else if (action === 'edit') {
             navigateTo('post', 'ÁºñËæë‰ø°ÊÅØ', id);
        }
    }));
}
function renderIntentionsPage(page) {
    let content = `<div class="p-3 space-y-3">
        <button id="add-intention-btn-page" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold">Ê∑ªÂä†ÊÑèÂêëËΩ¶Âûã</button>
    `;
    mockIntentions.forEach(item => {
        const locationsText = item.locations.map(loc => `${loc.province}-${loc.city}`).join(', ');
        content += `
        <div class="bg-white rounded-lg p-4 shadow-sm">
            <div class="flex justify-between items-start">
                <div>
                    <h4 class="font-bold text-lg">${item.brand} - ${item.type}</h4>
                    <p class="text-sm text-gray-600">ËßÑÊ†º: ${item.tonnage || '‰∏çÈôê'} | ÊéíÊîæ: ${item.emission}</p>
                    <p class="text-sm text-gray-600 mt-1">Âú∞Âå∫: ${locationsText}</p>
                </div>
                <div class="flex space-x-2 flex-shrink-0 pl-2">
                    <button class="edit-intention-btn text-sm text-blue-500" data-id="${item.id}">‰øÆÊîπ</button>
                    <button class="delete-intention-btn text-sm text-red-500" data-id="${item.id}">Âà†Èô§</button>
                </div>
            </div>
        </div>
        `;
    });
    content += '</div>';
    page.innerHTML = content;
    
    page.querySelector('#add-intention-btn-page').addEventListener('click', () => openIntentionModal());
    page.querySelectorAll('.edit-intention-btn').forEach(btn => btn.addEventListener('click', e => {
        const id = parseInt(e.target.dataset.id);
        openIntentionModal(id);
    }));
    page.querySelectorAll('.delete-intention-btn').forEach(btn => btn.addEventListener('click', e => {
        showConfirmModal('Á°ÆÂÆöË¶ÅÂà†Èô§Ê≠§ÊÑèÂêëÂêó?', () => {
            const id = parseInt(e.target.dataset.id);
            mockIntentions = mockIntentions.filter(i => i.id !== id);
            renderIntentionsPage(page);
        });
    }));
}
function openIntentionModal(id = null) {
    editingIntentionId = id;
    const modalTitle = intentionModal.querySelector('#intention-modal-title');
    const typeSelect = intentionModal.querySelector('#intention-type');
    const brandSelect = intentionModal.querySelector('#intention-brand');
    const tonnageInput = intentionModal.querySelector('#intention-tonnage');
    const emissionSelect = intentionModal.querySelector('#intention-emission');
    
    populateSelect(typeSelect, Object.keys(equipmentData));
    populateSelect(emissionSelect, emissionOptions);
    
    typeSelect.onchange = e => {
        const type = e.target.value;
        const brands = equipmentData[type] ? ["‰∏çÈôê", ...equipmentData[type].brands] : ["‰∏çÈôê"];
        populateSelect(brandSelect, brands);
    };

    if (id !== null) {
        modalTitle.textContent = '‰øÆÊîπÊÑèÂêë';
        const intention = mockIntentions.find(i => i.id === id);
        typeSelect.value = intention.type;
        tonnageInput.value = intention.tonnage === '‰∏çÈôê' ? '' : intention.tonnage;
        emissionSelect.value = intention.emission;
        currentIntentionLocations = [...intention.locations];
        typeSelect.dispatchEvent(new Event('change'));
        brandSelect.value = intention.brand;

    } else {
        modalTitle.textContent = 'Ê∑ªÂä†ÊÑèÂêë';
        currentIntentionLocations = [];
        typeSelect.value = Object.keys(equipmentData)[0];
        tonnageInput.value = '';
        emissionSelect.value = '‰∏çÈôê';
        typeSelect.dispatchEvent(new Event('change'));
    }

    setupLocationPicker();
    renderLocationTags();
    intentionModal.classList.remove('hidden');
}
function setupLocationPicker() {
    const provinceSelect = intentionModal.querySelector('#intention-province');
    const citySelect = intentionModal.querySelector('#intention-city');
    populateSelect(provinceSelect, Object.keys(chinaLocations));
    provinceSelect.onchange = e => {
        const cities = chinaLocations[e.target.value] ? ["‰∏çÈôê", ...chinaLocations[e.target.value]] : [];
        populateSelect(citySelect, cities);
    };
    provinceSelect.dispatchEvent(new Event('change'));
}
function renderLocationTags() {
    const displayDiv = intentionModal.querySelector('#intention-locations-display');
    displayDiv.innerHTML = '';
    if (currentIntentionLocations.length === 0) {
        displayDiv.innerHTML = `<span class="text-gray-400">Â∞öÊú™Ê∑ªÂä†Âú∞Âå∫</span>`;
    }
    currentIntentionLocations.forEach((loc, index) => {
        const tag = document.createElement('span');
        tag.className = 'inline-flex items-center bg-blue-100 text-blue-800 text-sm font-medium mr-2 mb-2 px-2.5 py-1 rounded-full';
        tag.innerHTML = `${loc.province} - ${loc.city} <button class="ml-2 text-blue-600 hover:text-blue-800" data-index="${index}">&times;</button>`;
        tag.querySelector('button').addEventListener('click', e => {
            currentIntentionLocations.splice(parseInt(e.target.dataset.index), 1);
            renderLocationTags();
        });
        displayDiv.appendChild(tag);
    });
}
function openAdminEditModal(listingId, options = {}) {
    const { readOnly = false } = options;
    const item = mockListings.find(l => l.id === listingId);
    if (!item) return;

    const formContainer = document.getElementById('admin-edit-form-container');
    const sourceOptions = ["ËΩ¶‰∏ªÁõ¥Âçñ", "‰∏≠‰ªã‰ø°ÊÅØ", "‰∫åÊâãËΩ¶ÂïÜ"];
    const statusMap = { selling: 'Â∑≤‰∏äÊû∂', reviewing: 'ÂæÖÂÆ°Ê†∏', off: 'Â∑≤‰∏ãÊû∂' };
    
    formContainer.innerHTML = `
        <div class="space-y-4">
            <div class="grid grid-cols-3 items-center"><label class="col-span-1">Ê†áÈ¢ò</label><input id="admin-edit-title" class="col-span-2 form-input" value="${item.title}" ${readOnly ? 'disabled' : ''}></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">‰ª∑Ê†º(‰∏á)</label><input type="number" id="admin-edit-price" class="col-span-2 form-input" value="${item.price}" ${readOnly ? 'disabled' : ''}></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">Êù•Ê∫ê</label><select id="admin-edit-source" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">ËÆæÂ§áÁ±ªÂûã</label><select id="admin-edit-type" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">ÂìÅÁâå</label><select id="admin-edit-brand" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">ÊéíÊîæÊ†áÂáÜ</label><select id="admin-edit-emission" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">Â∑•‰ΩúÂ∞èÊó∂</label><input type="number" id="admin-edit-work-hours" class="col-span-2 form-input" value="${item.work_hours}" ${readOnly ? 'disabled' : ''}></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">Ë°åÈ©∂ÈáåÁ®ã(km)</label><input type="number" id="admin-edit-mileage" class="col-span-2 form-input" value="${item.mileage}" ${readOnly ? 'disabled' : ''}></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">Áä∂ÊÄÅ</label><select id="admin-edit-status" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div id="admin-modal-buttons" class="flex justify-end space-x-4 pt-4">
                <button id="cancel-admin-edit" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md">ÂèñÊ∂à</button>
                <button id="save-admin-edit" data-id="${listingId}" class="bg-blue-600 text-white px-4 py-2 rounded-md">‰øùÂ≠òÊõ¥Êîπ</button>
            </div>
        </div>
    `;
    
    const typeSelect = document.getElementById('admin-edit-type');
    const brandSelect = document.getElementById('admin-edit-brand');
    const statusSelect = document.getElementById('admin-edit-status');
    const modalButtons = document.getElementById('admin-modal-buttons');
    
    populateSelect(document.getElementById('admin-edit-source'), sourceOptions, item.tags[0]);
    populateSelect(typeSelect, Object.keys(equipmentData), item.type);
    populateSelect(brandSelect, equipmentData[item.type].brands, item.brand);
    populateSelect(document.getElementById('admin-edit-emission'), emissionOptions, item.tags[2]);
    
    statusSelect.innerHTML = Object.entries(statusMap).map(([key, value]) => `<option value="${key}">${value}</option>`).join('');
    statusSelect.value = item.status;

    typeSelect.addEventListener('change', e => {
        const selectedType = e.target.value;
        const brands = equipmentData[selectedType] ? equipmentData[selectedType].brands : [];
        populateSelect(brandSelect, brands);
    });

    if (readOnly) {
        document.getElementById('admin-edit-modal-title').textContent = 'Êü•Áúã‰ø°ÊÅØ';
        modalButtons.innerHTML = `<button id="cancel-admin-edit" class="bg-blue-600 text-white px-4 py-2 rounded-md">ÂÖ≥Èó≠</button>`;
    } else {
        document.getElementById('admin-edit-modal-title').textContent = 'ÁºñËæë‰ø°ÊÅØ';
        document.getElementById('save-admin-edit').addEventListener('click', saveAdminEdit);
    }
    
    document.getElementById('cancel-admin-edit').addEventListener('click', closeAdminEditModal);
    adminEditModal.classList.remove('hidden');
}

function saveAdminEdit(e) {
    const listingId = parseInt(e.target.dataset.id);
    const listing = mockListings.find(l => l.id === listingId);
    if (listing) {
        listing.title = document.getElementById('admin-edit-title').value;
        listing.price = document.getElementById('admin-edit-price').value;
        listing.status = document.getElementById('admin-edit-status').value;
        listing.type = document.getElementById('admin-edit-type').value;
        listing.brand = document.getElementById('admin-edit-brand').value;
        listing.work_hours = document.getElementById('admin-edit-work-hours').value;
        listing.mileage = document.getElementById('admin-edit-mileage').value;
        listing.tags[0] = document.getElementById('admin-edit-source').value;
        listing.tags[2] = document.getElementById('admin-edit-emission').value;
        
        showNotification('‰ø°ÊÅØÂ∑≤Êõ¥Êñ∞');
        renderListingsManagement();
        closeAdminEditModal();
    }
}
    function initializeApp() {
        // ÂÖ®Â±Ä‰∫ã‰ª∂ÁõëÂê¨
        viewToggleBtn.addEventListener('click', toggleView);
        adminSidebarItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                renderAdminContent(item.dataset.page);
            });
        });
        document.getElementById('save-settings-btn').addEventListener('click', () => {
            showNotification('ËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºÅ');
        });
        document.getElementById('close-admin-edit-modal').addEventListener('click', closeAdminEditModal);

        // Áî®Êà∑Á´Ø‰∫ã‰ª∂ÁõëÂê¨
        tabItems.forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.page)));
        backButton.addEventListener('click', navigateBack);
        screenElement.addEventListener('click', (e) => {
            const callButton = e.target.closest('.call-btn');
            if (callButton) {
                e.stopPropagation();
                showCallModal(callButton.dataset.phone);
            }
        });
        detailActionBar.addEventListener('click', (e) => {
            const callButton = e.target.closest('.call-btn');
            if(callButton){
                e.stopPropagation();
                showCallModal(callButton.dataset.phone);
            }
        });
        cancelCallBtn.addEventListener('click', hideCallModal);
        confirmCallBtn.addEventListener('click', () => {
            showNotification('Ê®°ÊãüÂëºÂè´‰∏≠...');
            hideCallModal();
        });
        cancelConfirmBtn.addEventListener('click', hideConfirmModal);
        closeLightboxBtn.addEventListener('click', closeLightbox);
        intentionModal.querySelector('#close-intention-modal').addEventListener('click', closeIntentionModal);
        intentionModal.querySelector('#add-location-btn').addEventListener('click', () => {
            const province = intentionModal.querySelector('#intention-province').value;
            const city = intentionModal.querySelector('#intention-city').value;
            if(province && city) {
                if (!currentIntentionLocations.some(l => l.province === province && l.city === city)) {
                    currentIntentionLocations.push({ province, city });
                    renderLocationTags();
                } else {
                    showNotification('ËØ•Âú∞Âå∫Â∑≤Ê∑ªÂä†');
                }
            }
        });
        intentionModal.querySelector('#save-intention-btn').addEventListener('click', () => {
            const newIntention = {
                id: editingIntentionId !== null ? editingIntentionId : Date.now(),
                userId: 104, // Mock user ID
                type: intentionModal.querySelector('#intention-type').value,
                brand: intentionModal.querySelector('#intention-brand').value,
                tonnage: intentionModal.querySelector('#intention-tonnage').value || '‰∏çÈôê',
                emission: intentionModal.querySelector('#intention-emission').value,
                locations: [...currentIntentionLocations]
            };
            if(newIntention.locations.length === 0) {
                showNotification('ËØ∑Ëá≥Â∞ëÊ∑ªÂä†‰∏Ä‰∏™Âú∞Âå∫');
                return;
            }
            if (editingIntentionId !== null) {
                const index = mockIntentions.findIndex(i => i.id === editingIntentionId);
                mockIntentions[index] = newIntention;
            } else {
                newIntention.id = Date.now();
                mockIntentions.push(newIntention);
            }
            renderIntentionsPage(document.getElementById('page-intentions'));
            closeIntentionModal();
        });

        // ÂàùÂßãÂä†ËΩΩ
        updateTime();
        setInterval(updateTime, 1000 * 60);
        renderPage('index');
        showPage('index');
    }

    // --- Â∫îÁî®ÂêØÂä® ---
    initializeApp();
    });
</script>

</body>
</html>
