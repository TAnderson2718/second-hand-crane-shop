<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒæ‰‹åŠè½¦å°ç¨‹åº (ç”¨æˆ·ç«¯+ç®¡ç†ç«¯)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- é€šç”¨æ ·å¼ --- */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #E5E7EB;
        }

        /* --- æ‰‹æœºè§†å›¾æ ·å¼ --- */
        .mobile-container {
             display: flex;
             justify-content: center;
             align-items: center;
             padding: 2rem;
             min-height: 100vh;
        }
        .mobile-frame {
            width: 100%;
            max-width: 420px;
            height: 850px;
            background-color: #F4F4F4;
            border: 12px solid #1F2937;
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        .status-bar {
            height: 30px;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            color: #1F2937;
            flex-shrink: 0;
            border-bottom: 1px solid #E5E7EB;
        }
        .status-bar .time { font-weight: 600; }
        .status-bar .icons span { margin-left: 5px; }
        .screen {
            flex-grow: 1;
            overflow-y: auto;
            position: relative;
        }
        .screen::-webkit-scrollbar { display: none; }
        .page {
            display: none;
            flex-direction: column;
            background-color: #F4F4F4;
            animation: fadeIn 0.3s ease-in-out;
            min-height: 100%;
        }
        .page.active { display: flex; }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        .tab-bar, #detail-action-bar {
            height: 60px;
            background-color: #FFFFFF;
            border-top: 1px solid #E5E7EB;
            flex-shrink: 0;
            z-index: 10;
        }
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #6B7280;
            cursor: pointer;
            transition: color 0.2s;
            flex: 1;
        }
        .tab-item.active { color: #3B82F6; }
        .tab-item svg { width: 24px; height: 24px; margin-bottom: 2px; }
        .nav-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            height: 44px;
            background-color: #fff;
            border-bottom: 1px solid #E5E7EB;
            flex-shrink: 0;
            z-index: 10;
        }
        .nav-bar .back-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        .nav-bar .title { font-size: 18px; font-weight: 600; }
        .image-preview-item { position: relative; }
        .delete-preview-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background-color: #EF4444;
            color: white;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            line-height: 1;
            cursor: pointer;
            border: 1px solid white;
        }
        .form-select, .form-input, .form-textarea {
            background-color: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            font-size: 14px;
            width: 100%;
        }
        .carousel-container {
            scroll-snap-type: x mandatory;
            overflow-x: auto;
        }
        .carousel-slide { scroll-snap-align: start; }
        .modal { animation: fadeInModal 0.3s ease-out; }
         @keyframes fadeInModal {
            from { opacity: 0; transform: translateY(30px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .post-action-btn { @apply text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full; }

        /* --- ç®¡ç†ç«¯æ ·å¼ --- */
        .admin-view {
            width: 100%;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 250px;
            background-color: #1F2937;
            color: #D1D5DB;
            flex-shrink: 0;
        }
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .sidebar-item:hover, .sidebar-item.active {
            background-color: #374151;
            color: white;
        }
        .sidebar-item svg {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
        }
        .main-content {
            flex-grow: 1;
            padding: 2rem;
            background-color: #F3F4F6;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-block;
        }
        .status-pending, .status-reviewing, .status-banned { background-color: #FEF3C7; color: #92400E; }
        .status-processed, .status-selling, .status-active { background-color: #D1FAE5; color: #065F46; }
        .status-off { background-color: #E5E7EB; color: #4B5563; }
        
        .action-btn {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
            margin: 0 0.2rem;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    
    <!-- å…¨å±€è§†å›¾åˆ‡æ¢æŒ‰é’® -->
    <div class="fixed top-4 right-4 z-50">
        <button id="view-toggle-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-indigo-700 transition">
            åˆ‡æ¢åˆ°ç®¡ç†å‘˜è§†å›¾
        </button>
    </div>

    <!-- ç”¨æˆ·æ‰‹æœºè§†å›¾ -->
    <div id="user-view">
        <div class="mobile-container">
            <div class="mobile-frame">
                 <!-- çŠ¶æ€æ  -->
                <div class="status-bar">
                    <span id="time" class="time">17:15</span>
                    <div class="icons"><span>ğŸ“¶</span><span>5G</span><span>ğŸ”‹</span></div>
                </div>

                <!-- å¯¼èˆªæ  -->
                <div id="nav-bar" class="nav-bar hidden">
                    <div id="back-button" class="back-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    </div>
                    <span id="nav-title" class="title"></span>
                </div>
                
                <!-- å±å¹•å†…å®¹åŒº -->
                <div id="screen" class="screen">
                    <!-- å„ä¸ªé¡µé¢å®¹å™¨ -->
                    <div id="page-index" class="page active"></div>
                    <div id="page-detail" class="page"></div>
                    <div id="page-post" class="page"></div>
                    <div id="page-profile" class="page"></div>
                    <div id="page-report" class="page"></div>
                    <div id="page-favorites" class="page"></div>
                    <div id="page-posts" class="page"></div>
                    <div id="page-intentions" class="page"></div>
                </div>

                <!-- è¯¦æƒ…é¡µä¸“å±æ“ä½œæ  -->
                <div id="detail-action-bar" class="hidden"></div>
                
                <!-- åº•éƒ¨ Tab æ  -->
                <div id="tab-bar" class="tab-bar flex">
                    <div class="tab-item active" data-page="index"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg><span>é¦–é¡µ</span></div>
                    <div class="tab-item" data-page="post"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"></path></svg><span>å‘å¸ƒ</span></div>
                    <div class="tab-item" data-page="profile"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg><span>æˆ‘çš„</span></div>
                </div>

                <!-- ç»Ÿä¸€çš„é¡¶éƒ¨é€šçŸ¥æ¡ -->
                <div id="notification-toast" class="absolute top-10 left-1/2 -translate-x-1/2 bg-black bg-opacity-75 text-white px-4 py-2 rounded-full shadow-lg z-50 opacity-0 transform -translate-y-4 transition-all duration-300 pointer-events-none">
                    <p id="notification-text"></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç®¡ç†å‘˜æ¡Œé¢è§†å›¾ -->
    <div id="admin-view" class="hidden">
        <div class="admin-view">
            <!-- ä¾§è¾¹æ  -->
            <nav class="sidebar">
                <div class="p-6 text-center">
                    <h2 class="text-xl font-bold text-white">åŠè½¦ç®¡ç†åå°</h2>
                </div>
                <div>
                    <a href="#" class="sidebar-item active" data-page="listings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>ä¿¡æ¯ç®¡ç†</a>
                    <a href="#" class="sidebar-item" data-page="users"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.975 5.975 0 0112 15a5.975 5.975 0 013-1.197z"></path></svg>ç”¨æˆ·ç®¡ç†</a>
                    <a href="#" class="sidebar-item" data-page="intentions"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>æ„å‘ç®¡ç†</a>
                    <a href="#" class="sidebar-item" data-page="data-maintenance"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7a8 8 0 0116 0M12 11a4 4 0 100-8 4 4 0 000 8z"></path></svg>æ•°æ®ç»´æŠ¤</a>
                    <a href="#" class="sidebar-item" data-page="reports"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6H8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"></path></svg>ä¸¾æŠ¥ç®¡ç†</a>
                    <a href="#" class="sidebar-item" data-page="settings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>ç³»ç»Ÿè®¾ç½®</a>
                </div>
            </nav>
            <!-- ä¸»å†…å®¹åŒº -->
            <main class="main-content">
                <div id="admin-content-listings">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">ä¿¡æ¯ç®¡ç†</h1>
                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ç¼–å·</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">æ ‡é¢˜</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ä»·æ ¼</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">çŠ¶æ€</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="admin-listings-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
                <div id="admin-content-users" class="hidden">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">ç”¨æˆ·ç®¡ç†</h1>
                     <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ç”¨æˆ·ID</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">å¤´åƒ/æ˜µç§°</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">è”ç³»ç”µè¯</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">æ³¨å†Œæ—¶é—´</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">çŠ¶æ€</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="admin-users-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
                 <div id="admin-content-reports" class="hidden">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">ä¸¾æŠ¥ç®¡ç†</h1>
                     <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ä¸¾æŠ¥ID</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">è¢«ä¸¾æŠ¥å†…å®¹</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ä¸¾æŠ¥ç†ç”±</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">çŠ¶æ€</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="admin-reports-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
                 <div id="admin-content-intentions" class="hidden">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">æ„å‘ç®¡ç†</h1>
                     <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">æ„å‘ID</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">ç”¨æˆ·</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">æ„å‘è¯¦æƒ…</th>
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="admin-intentions-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
                <div id="admin-content-data-maintenance" class="hidden">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">åŸºç¡€æ•°æ®ç»´æŠ¤</h1>
                    <div class="bg-white p-6 rounded-lg shadow space-y-6">
                        <!-- JSåŠ¨æ€ç”Ÿæˆç±»å‹å’Œå“ç‰Œç»´æŠ¤åŒºåŸŸ -->
                    </div>
                </div>
                <div id="admin-content-settings" class="hidden">
                     <h1 class="text-2xl font-bold text-gray-800 mb-6">ç³»ç»Ÿè®¾ç½®</h1>
                     <div class="space-y-8">
                        <!-- å¸¸è§„è®¾ç½® -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold text-gray-700 border-b pb-3 mb-4">å¸¸è§„è®¾ç½®</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="site-name" class="block text-sm font-medium text-gray-700">å°ç¨‹åºåç§°</label>
                                    <input type="text" id="site-name" value="äºŒæ‰‹åŠè½¦å°ç¨‹åº" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                                <div>
                                    <label for="admin-email" class="block text-sm font-medium text-gray-700">ç®¡ç†å‘˜é‚®ç®±</label>
                                    <input type="email" id="admin-email" value="admin@example.com" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                            </div>
                        </div>

                        <!-- è´¦æˆ·å®‰å…¨ -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold text-gray-700 border-b pb-3 mb-4">è´¦æˆ·å®‰å…¨</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="current-password" class="block text-sm font-medium text-gray-700">å½“å‰å¯†ç </label>
                                    <input type="password" id="current-password" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                                <div>
                                    <label for="new-password" class="block text-sm font-medium text-gray-700">æ–°å¯†ç </label>
                                    <input type="password" id="new-password" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                                 <div>
                                    <label for="confirm-password" class="block text-sm font-medium text-gray-700">ç¡®è®¤æ–°å¯†ç </label>
                                    <input type="password" id="confirm-password" class="mt-1 block w-full md:w-1/2 form-input">
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end pt-4">
                            <button id="save-settings-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-lg shadow-lg hover:bg-indigo-700 transition">
                                ä¿å­˜æ›´æ”¹
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- å…¨å±€å¼¹çª— (å…±ç”¨) -->
    <div id="call-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-xs text-center">
            <div class="p-6"><p class="text-lg font-semibold text-gray-800 mb-1"></p><p class="text-sm text-gray-500">æˆ‘ä»¬å°†å‘¼å«æ­¤å·ç </p></div>
            <div class="border-t border-gray-200 grid grid-cols-2">
                <button id="cancel-call" class="py-3 text-gray-600">å–æ¶ˆ</button>
                <button id="confirm-call" class="py-3 text-blue-500 font-semibold border-l border-gray-200">å‘¼å«</button>
            </div>
        </div>
    </div>
    <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-xs text-center">
            <div class="p-6"><p id="confirm-modal-text" class="text-lg font-semibold text-gray-800 mb-1"></p></div>
            <div class="border-t border-gray-200 grid grid-cols-2">
                <button id="cancel-confirm" class="py-3 text-gray-600">å–æ¶ˆ</button>
                <button id="confirm-action" class="py-3 text-red-500 font-semibold border-l border-gray-200">ç¡®è®¤</button>
            </div>
        </div>
    </div>
    <div id="image-lightbox" class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4">
        <span id="close-lightbox" class="absolute top-4 right-6 text-white text-5xl cursor-pointer hover:text-gray-300">&times;</span>
        <img id="lightbox-image" src="" class="max-w-full max-h-full">
    </div>
    <div id="intention-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
         <div class="modal bg-white w-full max-w-[420px] rounded-t-2xl p-4 max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="intention-modal-title" class="text-lg font-bold">æ·»åŠ æ„å‘</h3>
                <span id="close-intention-modal" class="text-2xl cursor-pointer">&times;</span>
            </div>
            <div class="flex-grow overflow-y-auto space-y-4 pr-2">
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">è®¾å¤‡ç±»å‹</label><select id="intention-type" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">å“ç‰Œ</label><select id="intention-brand" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">å¨ä½</label><input type="number" id="intention-tonnage" class="col-span-2 form-input" placeholder="ä¸é™"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">æ’æ”¾æ ‡å‡†</label><select id="intention-emission" class="col-span-2 form-select"></select></div>
                <div>
                    <label>æ‰€åœ¨åœ°</label>
                    <div class="mt-2 p-2 bg-gray-100 rounded-md min-h-[40px]" id="intention-locations-display"></div>
                    <div class="flex items-center space-x-2 mt-2">
                         <select id="intention-province" class="form-select flex-1"></select>
                         <select id="intention-city" class="form-select flex-1"></select>
                         <button id="add-location-btn" class="bg-blue-500 text-white px-4 py-2 rounded-md flex-shrink-0">æ·»åŠ </button>
                    </div>
                </div>
            </div>
            <button id="save-intention-btn" class="w-full bg-blue-600 text-white py-3 rounded-lg text-lg font-semibold mt-4">ä¿å­˜æ„å‘</button>
         </div>
    </div>

    <!-- æ–°å¢: ç®¡ç†å‘˜ç¼–è¾‘å¼¹çª— -->
    <div id="admin-edit-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="admin-edit-modal-title" class="text-xl font-bold">ç¼–è¾‘ä¿¡æ¯</h3>
                <span id="close-admin-edit-modal" class="text-2xl cursor-pointer hover:text-red-500">&times;</span>
            </div>
            <div id="admin-edit-form-container" class="p-6 overflow-y-auto">
                <!-- JS åŠ¨æ€å¡«å……è¡¨å• -->
            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    // --- å…¨å±€å˜é‡å’ŒçŠ¶æ€ ---
    let isAdminView = false;
    let pageHistory = ['index'];
    let notificationTimeout;
    let currentIntentionLocations = [];
    let editingIntentionId = null;

    // --- æ¨¡æ‹Ÿæ•°æ® ---
    let mockListings = [
        { id: 1, title: "ä¸‰ä¸€ XCT25L5 - 80å¨", tags: ["ä¸­ä»‹ä¿¡æ¯", "å¡”åŠ", "å›½äº”"], type: "æ±½è½¦åŠ", brand: "ä¸‰ä¸€", tonnage: 80, manufacture_date: "2025-06", post_date: "6å¤©å‰å‘å¸ƒ", location: "æ±Ÿè‹ è‹å·", price: "180.00", phone: "138-0001-0001", images: ["https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0?q=80&w=800&h=600&fit=crop", "https://picsum.photos/seed/crane1-2/800/600", "https://picsum.photos/seed/crane1-3/800/600"], work_hours: 1500, mileage: 25000, contact_person: "ç‹ç»ç†", status: 'selling'},
        { id: 2, title: "ä¸­è” XCT25L5 - 50å¨", tags: ["äºŒæ‰‹è½¦å•†", "å¡”åŠ", "å›½äº”"], type: "æ±½è½¦åŠ", brand: "ä¸­è”é‡ç§‘", tonnage: 50, manufacture_date: "2025-06", post_date: "6å¤©å‰å‘å¸ƒ", location: "å±±ä¸œ æµå—", price: "80.00", phone: "138-0002-0002", images: ["https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=800&h=600&fit=crop", "https://picsum.photos/seed/crane2-2/800/600"], work_hours: 2200, mileage: 31000, contact_person: "æè€æ¿", status: 'selling'},
        { id: 3, title: "å¾å·¥ QY25K5 - 25å¨", tags: ["è½¦ä¸»ç›´å–", "æ±½è½¦åŠ", "å›½å…­"], type: "æ±½è½¦åŠ", brand: "å¾å·¥", tonnage: 25, manufacture_date: "2024-01", post_date: "12å¤©å‰å‘å¸ƒ", location: "æ²³åŒ— çŸ³å®¶åº„", price: "65.50", phone: "138-0003-0003", images: ["https://picsum.photos/id/1057/800/600", "https://picsum.photos/id/1058/800/600"], work_hours: 800, mileage: 12000, contact_person: "å¼ å¸ˆå‚…", status: 'selling'},
        { id: 4, title: "ä¸‰ä¸€ STC250 - 25å¨", tags: ["è½¦ä¸»ç›´å–", "æ±½è½¦åŠ", "å›½äº”"], type: "æ±½è½¦åŠ", brand: "ä¸‰ä¸€", tonnage: 25, manufacture_date: "2023-08", post_date: "20å¤©å‰å‘å¸ƒ", location: "å¹¿ä¸œ å¹¿å·", price: "55.00", phone: "138-0004-0004", images: ["https://picsum.photos/seed/crane4/600/400"], work_hours: 3500, mileage: 45000, contact_person: "é™ˆå…ˆç”Ÿ", status: 'reviewing'},
        { id: 5, title: "åˆ©å‹ƒæµ·å°” LTM 1500 - 500å¨", tags: ["ä¸­ä»‹ä¿¡æ¯", "å±¥å¸¦åŠ", "å›½å››"], type: "å±¥å¸¦åŠ", brand: "åˆ©å‹ƒæµ·å°”", tonnage: 500, manufacture_date: "2022-01", post_date: "1æœˆå‰å‘å¸ƒ", location: "ä¸Šæµ· ä¸Šæµ·å¸‚", price: "1200.00", phone: "138-0005-0005", images: ["https://picsum.photos/seed/crane5/600/400"], work_hours: 5000, mileage: 0, contact_person: "èµµæ€»", status: 'off' },
    ];
    let mockUsers = [
        {id: 101, nickname: 'åŠè½¦å¤§ç‹', avatar: 'https://picsum.photos/seed/avatar1/100/100', phone: '138-0001-0001', registration_date: '2023-05-10', status: 'active'},
        {id: 102, nickname: 'èµ·é‡å…ˆé”‹', avatar: 'https://picsum.photos/seed/avatar2/100/100', phone: '138-0002-0002', registration_date: '2023-08-15', status: 'active'},
        {id: 103, nickname: 'å·¥ç¨‹æœºæ¢°', avatar: 'https://picsum.photos/seed/avatar3/100/100', phone: '138-0003-0003', registration_date: '2024-01-20', status: 'banned'},
        {id: 104, nickname: 'åŠè£…å°ç‹å­', avatar: 'https://picsum.photos/seed/avatar4/100/100', phone: '138-0004-0004', registration_date: '2024-03-11', status: 'active'},
    ];
    let mockReports = [
        { id: 1, listingId: 4, reason: 'è™šå‡ä¿¡æ¯', status: 'pending' },
        { id: 2, listingId: 1, reason: 'è½¦è¾†å·²å”®', status: 'processed' },
        { id: 3, listingId: 5, reason: 'ä»·æ ¼ä¸æè¿°ä¸ç¬¦', status: 'pending' },
    ];
    let mockMyPosts = [
        { id: 3, status: 'selling' },
        { id: 4, status: 'reviewing' },
        { id: 5, status: 'off' },
    ];
    let mockFavorites = [1, 2];
    let mockIntentions = [
        { id: 1, userId: 101, type: 'æ±½è½¦åŠ', brand: 'å¾å·¥', tonnage: '25', emission: 'å›½å…­', locations: [{ province: 'æ²³åŒ—çœ', city: 'ä¸é™' }]},
        { id: 2, userId: 102, type: 'é«˜ç©ºè½¦', brand: 'ä¸é™', tonnage: '20', emission: 'ä¸é™', locations: [{ province: 'å±±ä¸œçœ', city: 'æµå—å¸‚' }, { province: 'æ±Ÿè‹çœ', city: 'è‹å·å¸‚' }] },
        { id: 3, userId: 101, type: 'å±¥å¸¦åŠ', brand: 'ä¸‰ä¸€', tonnage: '100', emission: 'ä¸é™', locations: [{ province: 'å¹¿ä¸œçœ', city: 'ä¸é™' }]},
    ];
    const chinaLocations = {
        "åŒ—äº¬å¸‚": ["åŒ—äº¬å¸‚"], "å¤©æ´¥å¸‚": ["å¤©æ´¥å¸‚"], "ä¸Šæµ·å¸‚": ["ä¸Šæµ·å¸‚"], "é‡åº†å¸‚": ["é‡åº†å¸‚"],
        "æ²³åŒ—çœ": ["çŸ³å®¶åº„å¸‚", "å”å±±å¸‚", "ç§¦çš‡å²›å¸‚", "é‚¯éƒ¸å¸‚", "é‚¢å°å¸‚", "ä¿å®šå¸‚", "å¼ å®¶å£å¸‚", "æ‰¿å¾·å¸‚", "æ²§å·å¸‚", "å»ŠåŠå¸‚", "è¡¡æ°´å¸‚"], "å±±è¥¿çœ": ["å¤ªåŸå¸‚", "å¤§åŒå¸‚", "é˜³æ³‰å¸‚", "é•¿æ²»å¸‚", "æ™‹åŸå¸‚", "æœ”å·å¸‚", "æ™‹ä¸­å¸‚", "è¿åŸå¸‚", "å¿»å·å¸‚", "ä¸´æ±¾å¸‚", "å•æ¢å¸‚"], "è¾½å®çœ": ["æ²ˆé˜³å¸‚", "å¤§è¿å¸‚", "éå±±å¸‚", "æŠšé¡ºå¸‚", "æœ¬æºªå¸‚", "ä¸¹ä¸œå¸‚", "é”¦å·å¸‚", "è¥å£å¸‚", "é˜œæ–°å¸‚", "è¾½é˜³å¸‚", "ç›˜é”¦å¸‚", "é“å²­å¸‚", "æœé˜³å¸‚", "è‘«èŠ¦å²›å¸‚"], "å‰æ—çœ": ["é•¿æ˜¥å¸‚", "å‰æ—å¸‚", "å››å¹³å¸‚", "è¾½æºå¸‚", "é€šåŒ–å¸‚", "ç™½å±±å¸‚", "æ¾åŸå¸‚", "ç™½åŸå¸‚", "å»¶è¾¹æœé²œæ—è‡ªæ²»å·"], "é»‘é¾™æ±Ÿçœ": ["å“ˆå°”æ»¨å¸‚", "é½é½å“ˆå°”å¸‚", "é¸¡è¥¿å¸‚", "é¹¤å²—å¸‚", "åŒé¸­å±±å¸‚", "å¤§åº†å¸‚", "ä¼Šæ˜¥å¸‚", "ä½³æœ¨æ–¯å¸‚", "ä¸ƒå°æ²³å¸‚", "ç‰¡ä¸¹æ±Ÿå¸‚", "é»‘æ²³å¸‚", "ç»¥åŒ–å¸‚", "å¤§å…´å®‰å²­åœ°åŒº"], "æ±Ÿè‹çœ": ["å—äº¬å¸‚", "æ— é”¡å¸‚", "å¾å·å¸‚", "å¸¸å·å¸‚", "è‹å·å¸‚", "å—é€šå¸‚", "è¿äº‘æ¸¯å¸‚", "æ·®å®‰å¸‚", "ç›åŸå¸‚", "æ‰¬å·å¸‚", "é•‡æ±Ÿå¸‚", "æ³°å·å¸‚", "å®¿è¿å¸‚"], "æµ™æ±Ÿçœ": ["æ­å·å¸‚", "å®æ³¢å¸‚", "æ¸©å·å¸‚", "å˜‰å…´å¸‚", "æ¹–å·å¸‚", "ç»å…´å¸‚", "é‡‘åå¸‚", "è¡¢å·å¸‚", "èˆŸå±±å¸‚", "å°å·å¸‚", "ä¸½æ°´å¸‚"], "å®‰å¾½çœ": ["åˆè‚¥å¸‚", "èŠœæ¹–å¸‚", "èšŒåŸ å¸‚", "æ·®å—å¸‚", "é©¬éå±±å¸‚", "æ·®åŒ—å¸‚", "é“œé™µå¸‚", "å®‰åº†å¸‚", "é»„å±±å¸‚", "æ»å·å¸‚", "é˜œé˜³å¸‚", "å®¿å·å¸‚", "å…­å®‰å¸‚", "äº³å·å¸‚", "æ± å·å¸‚", "å®£åŸå¸‚"], "ç¦å»ºçœ": ["ç¦å·å¸‚", "å¦é—¨å¸‚", "è†ç”°å¸‚", "ä¸‰æ˜å¸‚", "æ³‰å·å¸‚", "æ¼³å·å¸‚", "å—å¹³å¸‚", "é¾™å²©å¸‚", "å®å¾·å¸‚"], "æ±Ÿè¥¿çœ": ["å—æ˜Œå¸‚", "æ™¯å¾·é•‡å¸‚", "èä¹¡å¸‚", "ä¹æ±Ÿå¸‚", "æ–°ä½™å¸‚", "é¹°æ½­å¸‚", "èµ£å·å¸‚", "å‰å®‰å¸‚", "å®œæ˜¥å¸‚", "æŠšå·å¸‚", "ä¸Šé¥¶å¸‚"], "å±±ä¸œçœ": ["æµå—å¸‚", "é’å²›å¸‚", "æ·„åšå¸‚", "æ£åº„å¸‚", "ä¸œè¥å¸‚", "çƒŸå°å¸‚", "æ½åŠå¸‚", "æµå®å¸‚", "æ³°å®‰å¸‚", "å¨æµ·å¸‚", "æ—¥ç…§å¸‚", "ä¸´æ²‚å¸‚", "å¾·å·å¸‚", "èŠåŸå¸‚", "æ»¨å·å¸‚", "èæ³½å¸‚"], "æ²³å—çœ": ["éƒ‘å·å¸‚", "å¼€å°å¸‚", "æ´›é˜³å¸‚", "å¹³é¡¶å±±å¸‚", "å®‰é˜³å¸‚", "é¹¤å£å¸‚", "æ–°ä¹¡å¸‚", "ç„¦ä½œå¸‚", "æ¿®é˜³å¸‚", "è®¸æ˜Œå¸‚", "æ¼¯æ²³å¸‚", "ä¸‰é—¨å³¡å¸‚", "å—é˜³å¸‚", "å•†ä¸˜å¸‚", "ä¿¡é˜³å¸‚", "å‘¨å£å¸‚", "é©»é©¬åº—å¸‚"], "æ¹–åŒ—çœ": ["æ­¦æ±‰å¸‚", "é»„çŸ³å¸‚", "åå °å¸‚", "å®œæ˜Œå¸‚", "è¥„é˜³å¸‚", "é„‚å·å¸‚", "è†é—¨å¸‚", "å­æ„Ÿå¸‚", "è†å·å¸‚", "é»„å†ˆå¸‚", "å’¸å®å¸‚", "éšå·å¸‚", "æ©æ–½åœŸå®¶æ—è‹—æ—è‡ªæ²»å·"], "æ¹–å—çœ": ["é•¿æ²™å¸‚", "æ ªæ´²å¸‚", "æ¹˜æ½­å¸‚", "è¡¡é˜³å¸‚", "é‚µé˜³å¸‚", "å²³é˜³å¸‚", "å¸¸å¾·å¸‚", "å¼ å®¶ç•Œå¸‚", "ç›Šé˜³å¸‚", "éƒ´å·å¸‚", "æ°¸å·å¸‚", "æ€€åŒ–å¸‚", "å¨„åº•å¸‚", "æ¹˜è¥¿åœŸå®¶æ—è‹—æ—è‡ªæ²»å·"], "å¹¿ä¸œçœ": ["å¹¿å·å¸‚", "éŸ¶å…³å¸‚", "æ·±åœ³å¸‚", "ç æµ·å¸‚", "æ±•å¤´å¸‚", "ä½›å±±å¸‚", "æ±Ÿé—¨å¸‚", "æ¹›æ±Ÿå¸‚", "èŒ‚åå¸‚", "è‚‡åº†å¸‚", "æƒ å·å¸‚", "æ¢…å·å¸‚", "æ±•å°¾å¸‚", "æ²³æºå¸‚", "é˜³æ±Ÿå¸‚", "æ¸…è¿œå¸‚", "ä¸œèå¸‚", "ä¸­å±±å¸‚", "æ½®å·å¸‚", "æ­é˜³å¸‚", "äº‘æµ®å¸‚"], "æµ·å—çœ": ["æµ·å£å¸‚", "ä¸‰äºšå¸‚", "ä¸‰æ²™å¸‚", "å„‹å·å¸‚"], "å››å·çœ": ["æˆéƒ½å¸‚", "è‡ªè´¡å¸‚", "æ”€æèŠ±å¸‚", "æ³¸å·å¸‚", "å¾·é˜³å¸‚", "ç»µé˜³å¸‚", "å¹¿å…ƒå¸‚", "é‚å®å¸‚", "å†…æ±Ÿå¸‚", "ä¹å±±å¸‚", "å—å……å¸‚", "çœ‰å±±å¸‚", "å®œå®¾å¸‚", "å¹¿å®‰å¸‚", "è¾¾å·å¸‚", "é›…å®‰å¸‚", "å·´ä¸­å¸‚", "èµ„é˜³å¸‚", "é˜¿åè—æ—ç¾Œæ—è‡ªæ²»å·", "ç”˜å­œè—æ—è‡ªæ²»å·", "å‡‰å±±å½æ—è‡ªæ²»å·"], "è´µå·çœ": ["è´µé˜³å¸‚", "å…­ç›˜æ°´å¸‚", "éµä¹‰å¸‚", "å®‰é¡ºå¸‚", "æ¯•èŠ‚å¸‚", "é“œä»å¸‚", "é»”è¥¿å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·", "é»”ä¸œå—è‹—æ—ä¾—æ—è‡ªæ²»å·", "é»”å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·"], "äº‘å—çœ": ["æ˜†æ˜å¸‚", "æ›²é–å¸‚", "ç‰æºªå¸‚", "ä¿å±±å¸‚", "æ˜­é€šå¸‚", "ä¸½æ±Ÿå¸‚", "æ™®æ´±å¸‚", "ä¸´æ²§å¸‚", "æ¥šé›„å½æ—è‡ªæ²»å·", "çº¢æ²³å“ˆå°¼æ—å½æ—è‡ªæ²»å·", "æ–‡å±±å£®æ—è‹—æ—è‡ªæ²»å·", "è¥¿åŒç‰ˆçº³å‚£æ—è‡ªæ²»å·", "å¤§ç†ç™½æ—è‡ªæ²»å·", "å¾·å®å‚£æ—æ™¯é¢‡æ—è‡ªæ²»å·", "æ€’æ±Ÿå‚ˆåƒ³æ—è‡ªæ²»å·", "è¿ªåº†è—æ—è‡ªæ²»å·"], "é™•è¥¿çœ": ["è¥¿å®‰å¸‚", "é“œå·å¸‚", "å®é¸¡å¸‚", "å’¸é˜³å¸‚", "æ¸­å—å¸‚", "å»¶å®‰å¸‚", "æ±‰ä¸­å¸‚", "æ¦†æ—å¸‚", "å®‰åº·å¸‚", "å•†æ´›å¸‚"], "ç”˜è‚ƒçœ": ["å…°å·å¸‚", "å˜‰å³ªå…³å¸‚", "é‡‘æ˜Œå¸‚", "ç™½é“¶å¸‚", "å¤©æ°´å¸‚", "æ­¦å¨å¸‚", "å¼ æ–å¸‚", "å¹³å‡‰å¸‚", "é…’æ³‰å¸‚", "åº†é˜³å¸‚", "å®šè¥¿å¸‚", "é™‡å—å¸‚", "ä¸´å¤å›æ—è‡ªæ²»å·", "ç”˜å—è—æ—è‡ªæ²»å·"], "é’æµ·çœ": ["è¥¿å®å¸‚", "æµ·ä¸œå¸‚", "æµ·åŒ—è—æ—è‡ªæ²»å·", "é»„å—è—æ—è‡ªæ²»å·", "æµ·å—è—æ—è‡ªæ²»å·", "æœæ´›è—æ—è‡ªæ²»å·", "ç‰æ ‘è—æ—è‡ªæ²»å·", "æµ·è¥¿è’™å¤æ—è—æ—è‡ªæ²»å·"], "å°æ¹¾çœ": ["å°åŒ—å¸‚", "æ–°åŒ—å¸‚", "æ¡ƒå›­å¸‚", "å°ä¸­å¸‚", "å°å—å¸‚", "é«˜é›„å¸‚", "åŸºéš†å¸‚", "æ–°ç«¹å¸‚", "å˜‰ä¹‰å¸‚"], "å†…è’™å¤è‡ªæ²»åŒº": ["å‘¼å’Œæµ©ç‰¹å¸‚", "åŒ…å¤´å¸‚", "ä¹Œæµ·å¸‚", "èµ¤å³°å¸‚", "é€šè¾½å¸‚", "é„‚å°”å¤šæ–¯å¸‚", "å‘¼ä¼¦è´å°”å¸‚", "å·´å½¦æ·–å°”å¸‚", "ä¹Œå…°å¯Ÿå¸ƒå¸‚", "å…´å®‰ç›Ÿ", "é”¡æ—éƒ­å‹’ç›Ÿ", "é˜¿æ‹‰å–„ç›Ÿ"], "å¹¿è¥¿å£®æ—è‡ªæ²»åŒº": ["å—å®å¸‚", "æŸ³å·å¸‚", "æ¡‚æ—å¸‚", "æ¢§å·å¸‚", "åŒ—æµ·å¸‚", "é˜²åŸæ¸¯å¸‚", "é’¦å·å¸‚", "è´µæ¸¯å¸‚", "ç‰æ—å¸‚", "ç™¾è‰²å¸‚", "è´ºå·å¸‚", "æ²³æ± å¸‚", "æ¥å®¾å¸‚", "å´‡å·¦å¸‚"], "è¥¿è—è‡ªæ²»åŒº": ["æ‹‰è¨å¸‚", "æ—¥å–€åˆ™å¸‚", "æ˜Œéƒ½å¸‚", "æ—èŠå¸‚", "å±±å—å¸‚", "é‚£æ›²å¸‚", "é˜¿é‡Œåœ°åŒº"], "å®å¤å›æ—è‡ªæ²»åŒº": ["é“¶å·å¸‚", "çŸ³å˜´å±±å¸‚", "å´å¿ å¸‚", "å›ºåŸå¸‚", "ä¸­å«å¸‚"], "æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº": ["ä¹Œé²æœ¨é½å¸‚", "å…‹æ‹‰ç›ä¾å¸‚", "åé²ç•ªå¸‚", "å“ˆå¯†å¸‚", "æ˜Œå‰å›æ—è‡ªæ²»å·", "åšå°”å¡”æ‹‰è’™å¤è‡ªæ²»å·", "å·´éŸ³éƒ­æ¥è’™å¤è‡ªæ²»å·", "é˜¿å…‹è‹åœ°åŒº", "å…‹å­œå‹’è‹æŸ¯å°”å…‹å­œè‡ªæ²»å·", "å–€ä»€åœ°åŒº", "å’Œç”°åœ°åŒº", "ä¼ŠçŠå“ˆè¨å…‹è‡ªæ²»å·", "å¡”åŸåœ°åŒº", "é˜¿å‹’æ³°åœ°åŒº"], "é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº": ["é¦™æ¸¯å²›", "ä¹é¾™", "æ–°ç•Œ"], "æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº": ["æ¾³é—¨åŠå²›", "æ°¹ä»”", "è·¯ç¯"]
    };
    let equipmentData = {
        'æ±½è½¦åŠ': { brands: ['å¾å·¥', 'ä¸‰ä¸€', 'ä¸­è”é‡ç§‘', 'åˆ©å‹ƒæµ·å°”', 'å¤šç”°é‡'], unit: 'å¨' },
        'å±¥å¸¦åŠ': { brands: ['å¾å·¥', 'ä¸‰ä¸€', 'æŠšæŒ–', 'æ—¥ç«‹ä½å‹', 'å¾·é©¬æ ¼'], unit: 'å¨' },
        'å¡”åŠ': { brands: ['ä¸­è”é‡ç§‘', 'æ°¸èŒ‚', 'é©¬å°¼æ‰˜ç“¦å…‹', 'æ³¢å¦', 'ç§‘æ›¼è¨'], unit: 'å‹å·' },
        'é«˜ç©ºè½¦': { brands: ['å¾å·¥', 'å‰å°¼', 'æ˜Ÿé‚¦', 'JLG', 'æ¬§å†èƒœ'], unit: 'ç±³' },
        'éšè½¦åŠ': { brands: ['çŸ³ç…¤', 'å¾å·¥', 'å¤æ²³', 'å¸•å°”è²æ ¼', 'å¸Œå°”åš'], unit: 'å¨' },
    };
    const emissionOptions = ["ä¸é™", "å›½ä¸‰", "å›½å››", "å›½äº”", "å›½å…­"];

    // --- DOM å…ƒç´  ---
    const viewToggleBtn = document.getElementById('view-toggle-btn');
    const userView = document.getElementById('user-view');
    const adminView = document.getElementById('admin-view');
    const adminSidebarItems = document.querySelectorAll('.sidebar-item');
    const adminContentPanels = {
        listings: document.getElementById('admin-content-listings'),
        users: document.getElementById('admin-content-users'),
        reports: document.getElementById('admin-content-reports'),
        settings: document.getElementById('admin-content-settings'),
        'data-maintenance': document.getElementById('admin-content-data-maintenance'),
        intentions: document.getElementById('admin-content-intentions'),
    };
    const adminListingsTable = document.getElementById('admin-listings-table');
    const adminUsersTable = document.getElementById('admin-users-table');
    const adminReportsTable = document.getElementById('admin-reports-table');
    const adminIntentionsTable = document.getElementById('admin-intentions-table');
    const adminEditModal = document.getElementById('admin-edit-modal');

    // ç”¨æˆ·ç«¯ DOM
    const screenElement = document.getElementById('screen');
    const pages = document.querySelectorAll('.page');
    const tabItems = document.querySelectorAll('.tab-item');
    const navBar = document.getElementById('nav-bar');
    const navTitle = document.getElementById('nav-title');
    const backButton = document.getElementById('back-button');
    const callModal = document.getElementById('call-modal');
    const cancelCallBtn = document.getElementById('cancel-call');
    const confirmCallBtn = document.getElementById('confirm-call');
    const confirmModal = document.getElementById('confirm-modal');
    const confirmModalText = document.getElementById('confirm-modal-text');
    const cancelConfirmBtn = document.getElementById('cancel-confirm');
    const confirmActionBtn = document.getElementById('confirm-action');
    const imageLightbox = document.getElementById('image-lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    const closeLightboxBtn = document.getElementById('close-lightbox');
    const mainTabBar = document.getElementById('tab-bar');
    const detailActionBar = document.getElementById('detail-action-bar');
    const intentionModal = document.getElementById('intention-modal');
    const notificationToast = document.getElementById('notification-toast');
    const notificationText = document.getElementById('notification-text');

    // --- é€šç”¨è¾…åŠ©å‡½æ•° ---
    function showNotification(text, type = 'success') {
        const toast = document.getElementById('notification-toast')
        if (!toast) return;
        toast.textContent = text;
        if(type === 'error'){
            toast.classList.add('bg-red-600');
        } else {
            toast.classList.remove('bg-red-600');
        }
        toast.classList.remove('opacity-0', '-translate-y-4');
        clearTimeout(notificationTimeout);
        notificationTimeout = setTimeout(() => {
            toast.classList.add('opacity-0', '-translate-y-4');
        }, 2500);
    }

    function updateTime() {
        const now = new Date();
        document.getElementById('time').textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
    }

    function populateSelect(selectElement, options, selectedValue) {
        if (!selectElement) return;
        selectElement.innerHTML = '';
        options.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.textContent = option;
            if (option === selectedValue) {
                optionElement.selected = true;
            }
            selectElement.appendChild(optionElement);
        });
    }

    // --- ç”¨æˆ·ç«¯å¼¹çª—é€»è¾‘ ---
    function showCallModal(phone) {
        callModal.querySelector('p:first-child').textContent = phone || '138-8888-8888';
        callModal.classList.remove('hidden');
    }
    function hideCallModal() { callModal.classList.add('hidden'); }
    function showConfirmModal(text, onConfirm) {
        confirmModalText.textContent = text;
        confirmActionBtn.onclick = () => {
            onConfirm();
            hideConfirmModal();
        };
        confirmModal.classList.remove('hidden');
    }
    function hideConfirmModal() { confirmModal.classList.add('hidden'); }
    function openLightbox(src) {
        lightboxImage.src = src;
        imageLightbox.classList.remove('hidden');
    }
    function closeLightbox() { imageLightbox.classList.add('hidden'); }
    
    function closeIntentionModal() {
        intentionModal.classList.add('hidden');
        editingIntentionId = null;
    }
    
    function closeAdminEditModal() {
        adminEditModal.classList.add('hidden');
    }

    function handleImageUpload(event, container, imageUrls = []) {
        const previewsContainer = container.querySelector('.previews-container');
        const uploadTrigger = container.querySelector('.upload-trigger');
        
        previewsContainer.querySelectorAll('.image-preview-item').forEach(item => item.remove());

        const addPreview = (src) => {
            const currentPreviews = previewsContainer.querySelectorAll('.image-preview-item').length;
            if(currentPreviews >= 9) return;

            const previewItem = document.createElement('div');
            previewItem.className = 'w-full h-20 image-preview-item';
            previewItem.innerHTML = `
                <img src="${src}" class="w-full h-full object-cover rounded-md">
                <div class="delete-preview-btn">Ã—</div>
            `;
            previewsContainer.insertBefore(previewItem, uploadTrigger);
            
            previewItem.querySelector('.delete-preview-btn').addEventListener('click', () => {
                previewItem.remove();
                checkUploadLimit(container);
            });
        };

        if (imageUrls.length > 0) {
            imageUrls.forEach(url => addPreview(url));
        } else {
             const files = event.target.files;
             for (const file of files) {
                 const reader = new FileReader();
                 reader.onload = (e) => addPreview(e.target.result);
                 reader.readAsDataURL(file);
            }
        }
        
        if(event.target) event.target.value = '';
        checkUploadLimit(container);
    }
    function checkUploadLimit(container) {
        const previewsContainer = container.querySelector('.previews-container');
        const uploadTrigger = container.querySelector('.upload-trigger');
        const currentPreviews = previewsContainer.querySelectorAll('.image-preview-item').length;
        uploadTrigger.style.display = currentPreviews >= 9 ? 'none' : 'flex';
    }

    // --- å¯¼èˆªä¸é¡µé¢æ¸²æŸ“æ ¸å¿ƒ ---
    function navigateTo(pageId, title, data = null) {
        pageHistory.push(pageId);
        renderPage(pageId, null, data);
        showPage(pageId, title);
    }

    function navigateBack() {
        if (pageHistory.length > 1) {
            pageHistory.pop();
            const prevPageId = pageHistory[pageHistory.length - 1];
            const prevPage = document.querySelector(`.tab-item[data-page="${prevPageId}"], .profile-menu > div[data-page="${prevPageId}"]`);
            const prevTitle = prevPage ? (prevPage.querySelector('span') ? prevPage.querySelector('span').textContent : 'è¯¦æƒ…') : 'é¦–é¡µ';
            renderPage(prevPageId);
            showPage(prevPageId, prevTitle);
        }
    }
    function switchTab(pageId) {
        pageHistory = [pageId];
        renderPage(pageId);
        showPage(pageId);
    }

    function showPage(pageId, title) {
        pages.forEach(p => p.classList.remove('active'));
        navBar.classList.add('hidden');
        mainTabBar.classList.add('hidden');
        detailActionBar.classList.add('hidden');
        const targetPage = document.getElementById(`page-${pageId}`);
        if (targetPage) {
            targetPage.classList.add('active');
            if (['index', 'post', 'profile'].includes(pageId)) {
                mainTabBar.classList.remove('hidden');
            } else {
                navBar.classList.remove('hidden');
                navTitle.textContent = title || 'è¯¦æƒ…';
                if(pageId === 'detail') {
                    detailActionBar.classList.remove('hidden');
                }
            }
        }
        updateTabActive(pageId);
        screenElement.scrollTop = 0;
    }
    
    function updateTabActive(pageId) {
        let isTab = false;
        tabItems.forEach(item => {
            const isActive = item.dataset.page === pageId;
            item.classList.toggle('active', isActive);
            if (isActive) isTab = true;
        });
        if (!isTab) {
             tabItems.forEach(item => item.classList.remove('active'));
        }
    }
    
    function renderPage(pageId, container, data) {
        const pageContainer = container || document.getElementById(`page-${pageId}`);
        switch(pageId) {
            case 'index': renderIndexPage(pageContainer); break;
            case 'post': renderPostPage(pageContainer, data); break;
            case 'profile': renderProfilePage(pageContainer); break;
            case 'favorites': renderFavoritesPage(pageContainer); break;
            case 'posts': renderPostsPage(pageContainer); break;
            case 'intentions': renderIntentionsPage(pageContainer); break;
            case 'report': renderReportPage(pageContainer); break;
            case 'detail': renderDetailPage(data); break;
        }
    }

    // --- è§†å›¾åˆ‡æ¢å’Œç®¡ç†ç«¯é€»è¾‘ ---
    function toggleView() {
        isAdminView = !isAdminView;
        userView.classList.toggle('hidden', isAdminView);
        adminView.classList.toggle('hidden', !isAdminView);
        viewToggleBtn.textContent = isAdminView ? 'åˆ‡æ¢åˆ°ç”¨æˆ·è§†å›¾' : 'åˆ‡æ¢åˆ°ç®¡ç†å‘˜è§†å›¾';
        
        if (isAdminView) {
            renderAdminContent('listings');
        }
    }

    function renderAdminContent(page) {
        adminSidebarItems.forEach(item => item.classList.remove('active'));
        document.querySelector(`.sidebar-item[data-page="${page}"]`).classList.add('active');
        
        for (const key in adminContentPanels) {
            adminContentPanels[key].classList.toggle('hidden', key !== page);
        }
        
        switch (page) {
            case 'listings': renderListingsManagement(); break;
            case 'users': renderUserManagement(); break;
            case 'reports': renderReportManagement(); break;
            case 'settings': renderSettingsPage(); break;
            case 'data-maintenance': renderDataMaintenancePage(); break;
            case 'intentions': renderIntentionManagement(); break;
        }
    }

    function renderListingsManagement() {
        if (!adminListingsTable) return;
        adminListingsTable.innerHTML = '';

        const statusMap = { selling: 'å·²ä¸Šæ¶', reviewing: 'å¾…å®¡æ ¸', off: 'å·²ä¸‹æ¶' };
        const statusColorMap = { selling: 'status-selling', reviewing: 'status-reviewing', off: 'status-off' };

        mockListings.forEach(item => {
            const tr = document.createElement('tr');
            tr.className = "hover:bg-gray-50";
            tr.innerHTML = `
                <td class="p-3 text-sm text-gray-700">#${String(item.id).padStart(5, '0')}</td>
                <td class="p-3 text-sm text-gray-700">${item.title}</td>
                <td class="p-3 text-sm text-gray-700">${item.price} ä¸‡</td>
                <td class="p-3 text-sm"><span class="status-badge ${statusColorMap[item.status]}">${statusMap[item.status]}</span></td>
                <td class="p-3 text-sm">
                    ${item.status === 'reviewing' ? `
                        <button class="action-btn text-green-600 hover:bg-green-100" data-action="approve" data-id="${item.id}">é€šè¿‡</button>
                        <button class="action-btn text-red-600 hover:bg-red-100" data-action="reject" data-id="${item.id}">é©³å›</button>
                    ` : ''}
                    <button class="action-btn text-blue-600 hover:bg-blue-100" data-action="edit" data-id="${item.id}">ç¼–è¾‘</button>
                    <button class="action-btn text-gray-600 hover:bg-gray-100" data-action="delete" data-id="${item.id}">åˆ é™¤</button>
                </td>
            `;
            adminListingsTable.appendChild(tr);
        });

        adminListingsTable.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', handleListingAction);
        });
    }

    function renderUserManagement() {
        if (!adminUsersTable) return;
        adminUsersTable.innerHTML = '';

        const statusMap = { active: 'æ­£å¸¸', banned: 'å·²å°ç¦' };
        const statusColorMap = { active: 'status-active', banned: 'status-banned' };

        mockUsers.forEach(user => {
            const tr = document.createElement('tr');
            tr.className = "hover:bg-gray-50";
            tr.innerHTML = `
                <td class="p-3 text-sm text-gray-700">#${user.id}</td>
                <td class="p-3 text-sm text-gray-700">
                    <div class="flex items-center">
                        <img src="${user.avatar}" class="w-8 h-8 rounded-full object-cover mr-3">
                        <span>${user.nickname}</span>
                    </div>
                </td>
                <td class="p-3 text-sm text-gray-700">${user.phone}</td>
                <td class="p-3 text-sm text-gray-700">${user.registration_date}</td>
                <td class="p-3 text-sm"><span class="status-badge ${statusColorMap[user.status]}">${statusMap[user.status]}</span></td>
                <td class="p-3 text-sm">
                    ${user.status === 'active' 
                        ? `<button class="action-btn text-red-600 hover:bg-red-100" data-action="ban" data-id="${user.id}">å°ç¦</button>`
                        : `<button class="action-btn text-green-600 hover:bg-green-100" data-action="unban" data-id="${user.id}">è§£å°</button>`
                    }
                </td>
            `;
            adminUsersTable.appendChild(tr);
        });

        adminUsersTable.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', handleUserAction);
        });
    }

    function renderReportManagement() {
        if (!adminReportsTable) return;
        adminReportsTable.innerHTML = '';
        
        const statusMap = { pending: 'å¾…å¤„ç†', processed: 'å·²å¤„ç†' };
        const statusColorMap = { pending: 'status-pending', processed: 'status-processed' };

        mockReports.forEach(report => {
            const listing = mockListings.find(l => l.id === report.listingId);
            if (!listing) return;

            const tr = document.createElement('tr');
            tr.className = "hover:bg-gray-50";
            tr.innerHTML = `
                <td class="p-3 text-sm text-gray-700">#${report.id}</td>
                <td class="p-3 text-sm text-gray-700">${listing.title}</td>
                <td class="p-3 text-sm text-gray-700">${report.reason}</td>
                <td class="p-3 text-sm"><span class="status-badge ${statusColorMap[report.status]}">${statusMap[report.status]}</span></td>
                <td class="p-3 text-sm">
                     <button class="action-btn text-blue-600 hover:bg-blue-100" data-action="view" data-id="${listing.id}">æŸ¥çœ‹è½¦è¾†</button>
                    ${report.status === 'pending' ? `<button class="action-btn text-green-600 hover:bg-green-100" data-action="process" data-id="${report.id}">æ ‡è®°å·²å¤„ç†</button>` : ''}
                </td>
            `;
            adminReportsTable.appendChild(tr);
        });

        adminReportsTable.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', handleReportAction);
        });
    }
    
    function renderIntentionManagement() {
        const container = adminContentPanels.intentions;
        if (!container) return;

        container.innerHTML = `
            <h1 class="text-2xl font-bold text-gray-800 mb-6">æ„å‘ç®¡ç†</h1>
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label for="filter-intention-type" class="block text-sm font-medium text-gray-700">è®¾å¤‡ç±»å‹</label>
                        <select id="filter-intention-type" class="mt-1 block w-full form-select"></select>
                    </div>
                    <div>
                        <label for="filter-intention-brand" class="block text-sm font-medium text-gray-700">å“ç‰Œ</label>
                        <select id="filter-intention-brand" class="mt-1 block w-full form-select"></select>
                    </div>
                    <div>
                        <label for="filter-intention-province" class="block text-sm font-medium text-gray-700">çœä»½</label>
                        <select id="filter-intention-province" class="mt-1 block w-full form-select"></select>
                    </div>
                    <div class="flex items-end space-x-2">
                        <button id="apply-intention-filters" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600">ç­›é€‰</button>
                        <button id="reset-intention-filters" class="w-full bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600">é‡ç½®</button>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="p-3 text-left text-sm font-semibold text-gray-600">æ„å‘ID</th>
                            <th class="p-3 text-left text-sm font-semibold text-gray-600">ç”¨æˆ·</th>
                            <th class="p-3 text-left text-sm font-semibold text-gray-600">æ„å‘è¯¦æƒ…</th>
                            <th class="p-3 text-left text-sm font-semibold text-gray-600">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="admin-intentions-table" class="divide-y divide-gray-200"></tbody>
                </table>
            </div>
        `;

        const typeSelect = document.getElementById('filter-intention-type');
        const brandSelect = document.getElementById('filter-intention-brand');
        const provinceSelect = document.getElementById('filter-intention-province');
        const applyBtn = document.getElementById('apply-intention-filters');
        const resetBtn = document.getElementById('reset-intention-filters');

        // Populate filters
        populateSelect(typeSelect, ['ä¸é™', ...Object.keys(equipmentData)]);
        populateSelect(brandSelect, ['ä¸é™']);
        populateSelect(provinceSelect, ['ä¸é™', ...Object.keys(chinaLocations)]);
        
        typeSelect.addEventListener('change', (e) => {
            const selectedType = e.target.value;
            if (selectedType === 'ä¸é™') {
                const allBrands = ["ä¸é™", ...new Set(Object.values(equipmentData).flatMap(type => type.brands))];
                populateSelect(brandSelect, allBrands);
            } else {
                const brands = equipmentData[selectedType] ? ["ä¸é™", ...equipmentData[selectedType].brands] : ["ä¸é™"];
                populateSelect(brandSelect, brands);
            }
        });

        const applyFilters = () => {
            let filteredIntentions = [...mockIntentions];

            const type = typeSelect.value;
            const brand = brandSelect.value;
            const province = provinceSelect.value;

            if (type !== 'ä¸é™') {
                filteredIntentions = filteredIntentions.filter(i => i.type === type);
            }
            if (brand !== 'ä¸é™') {
                filteredIntentions = filteredIntentions.filter(i => i.brand === brand);
            }
            if (province !== 'ä¸é™') {
                filteredIntentions = filteredIntentions.filter(i => i.locations.some(loc => loc.province === province));
            }

            renderIntentionTable(filteredIntentions);
        };

        applyBtn.addEventListener('click', applyFilters);

        resetBtn.addEventListener('click', () => {
            typeSelect.value = 'ä¸é™';
            provinceSelect.value = 'ä¸é™';
            typeSelect.dispatchEvent(new Event('change')); // to reset brand dropdown
            brandSelect.value = 'ä¸é™';
            renderIntentionTable(mockIntentions);
        });

        // Initial render
        renderIntentionTable(mockIntentions);
    }

    function renderIntentionTable(intentions) {
        const tableBody = document.getElementById('admin-intentions-table');
        if (!tableBody) return;
        tableBody.innerHTML = '';

        intentions.forEach(intention => {
            const user = mockUsers.find(u => u.id === intention.userId);
            const locationsText = intention.locations.map(loc => `${loc.province.replace(/çœ|å¸‚/, '')}-${loc.city.replace(/å¸‚/, '')}`).join(', ');

            const tr = document.createElement('tr');
            tr.className = "hover:bg-gray-50";
            tr.innerHTML = `
                <td class="p-3 text-sm text-gray-700">#${intention.id}</td>
                <td class="p-3 text-sm text-gray-700">
                    <div class="flex items-center">
                        ${user ? `<img src="${user.avatar}" class="w-8 h-8 rounded-full object-cover mr-3"><span>${user.nickname}</span>` : 'æœªçŸ¥ç”¨æˆ·'}
                    </div>
                </td>
                <td class="p-3 text-sm text-gray-700">
                    <p><strong>ç±»å‹:</strong> ${intention.type}</p>
                    <p><strong>å“ç‰Œ:</strong> ${intention.brand}</p>
                    <p><strong>è§„æ ¼:</strong> ${intention.tonnage || 'ä¸é™'}</p>
                    <p><strong>åœ°åŒº:</strong> ${locationsText}</p>
                </td>
                <td class="p-3 text-sm">
                     <button class="action-btn text-red-600 hover:bg-red-100" data-action="delete" data-id="${intention.id}">åˆ é™¤</button>
                </td>
            `;
            tableBody.appendChild(tr);
        });

        tableBody.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', handleIntentionAction);
        });
    }


    function renderDataMaintenancePage() {
        const container = adminContentPanels['data-maintenance'].querySelector('.bg-white');
        if (!container) return;
        container.innerHTML = `
            <div>
                <h4 class="text-md font-semibold text-gray-600 mb-2">è®¾å¤‡ç±»å‹ç®¡ç†</h4>
                <div id="types-list" class="space-y-2"></div>
                <div class="flex items-center mt-2">
                    <input type="text" id="new-type-name" class="form-input w-48 mr-2" placeholder="æ–°ç±»å‹åç§°">
                    <input type="text" id="new-type-unit" class="form-input w-24 mr-2" placeholder="å•ä½(å¨/ç±³)">
                    <button id="add-new-type" class="bg-blue-500 text-white px-4 py-2 rounded-md">æ·»åŠ ç±»å‹</button>
                </div>
            </div>
            <div>
                <h4 class="text-md font-semibold text-gray-600 mb-2 mt-6">å“ç‰Œç®¡ç†</h4>
                <select id="brand-type-select" class="form-select w-48 mb-2"></select>
                <div id="brands-list" class="space-y-2"></div>
                 <div class="flex items-center mt-2">
                    <input type="text" id="new-brand-name" class="form-input w-48 mr-2" placeholder="æ–°å“ç‰Œåç§°">
                    <button id="add-new-brand" class="bg-blue-500 text-white px-4 py-2 rounded-md">æ·»åŠ å“ç‰Œ</button>
                </div>
            </div>
        `;

        renderTypeManagement();
        
        const brandTypeSelect = document.getElementById('brand-type-select');
        populateSelect(brandTypeSelect, Object.keys(equipmentData));
        brandTypeSelect.addEventListener('change', () => renderBrandManagement(brandTypeSelect.value));
        renderBrandManagement(brandTypeSelect.value);

        document.getElementById('add-new-type').addEventListener('click', addNewType);
        document.getElementById('add-new-brand').addEventListener('click', addNewBrand);
    }
    
    function renderSettingsPage() {
        // This function is for the main settings page, which is now simpler.
    }
    
    function renderTypeManagement() {
        const list = document.getElementById('types-list');
        list.innerHTML = '';
        for (const type in equipmentData) {
            const item = document.createElement('div');
            item.className = 'flex items-center justify-between p-2 bg-gray-50 rounded';
            item.innerHTML = `<span>${type} (å•ä½: ${equipmentData[type].unit})</span>
                              <button data-type="${type}" class="text-red-500 hover:text-red-700 text-sm delete-type-btn">åˆ é™¤</button>`;
            list.appendChild(item);
        }
        document.querySelectorAll('.delete-type-btn').forEach(btn => btn.addEventListener('click', deleteType));
    }

    function renderBrandManagement(type) {
        const list = document.getElementById('brands-list');
        list.innerHTML = '';
        if (!equipmentData[type]) return;

        equipmentData[type].brands.forEach(brand => {
            const item = document.createElement('div');
            item.className = 'flex items-center justify-between p-2 bg-gray-50 rounded';
            item.innerHTML = `<span>${brand}</span>
                              <button data-type="${type}" data-brand="${brand}" class="text-red-500 hover:text-red-700 text-sm delete-brand-btn">åˆ é™¤</button>`;
            list.appendChild(item);
        });
         document.querySelectorAll('.delete-brand-btn').forEach(btn => btn.addEventListener('click', deleteBrand));
    }


    function addNewType() {
        const nameInput = document.getElementById('new-type-name');
        const unitInput = document.getElementById('new-type-unit');
        const name = nameInput.value.trim();
        const unit = unitInput.value.trim();
        if (name && unit && !equipmentData[name]) {
            equipmentData[name] = { brands: [], unit: unit };
            renderTypeManagement();
            const brandTypeSelect = document.getElementById('brand-type-select');
            populateSelect(brandTypeSelect, Object.keys(equipmentData));
            nameInput.value = '';
            unitInput.value = '';
            showNotification(`ç±»å‹ "${name}" å·²æ·»åŠ `);
        } else {
            showNotification('è¯·è¾“å…¥æœ‰æ•ˆä¸”ä¸é‡å¤çš„ç±»å‹åç§°å’Œå•ä½', 'error');
        }
    }

    function deleteType(e) {
        const type = e.target.dataset.type;
        showConfirmModal(`ç¡®å®šè¦åˆ é™¤ç±»å‹ "${type}" å—ï¼Ÿå…¶ä¸‹æ‰€æœ‰å“ç‰Œä¹Ÿå°†è¢«åˆ é™¤ã€‚`, () => {
            delete equipmentData[type];
            renderTypeManagement();
            const brandTypeSelect = document.getElementById('brand-type-select');
            populateSelect(brandTypeSelect, Object.keys(equipmentData));
            renderBrandManagement(brandTypeSelect.value);
            showNotification(`ç±»å‹ "${type}" å·²åˆ é™¤`);
        });
    }

    function addNewBrand() {
        const type = document.getElementById('brand-type-select').value;
        const nameInput = document.getElementById('new-brand-name');
        const name = nameInput.value.trim();
        if (name && equipmentData[type] && !equipmentData[type].brands.includes(name)) {
            equipmentData[type].brands.push(name);
            renderBrandManagement(type);
            nameInput.value = '';
            showNotification(`å“ç‰Œ "${name}" å·²æ·»åŠ åˆ° "${type}"`);
        } else {
             showNotification('è¯·è¾“å…¥æœ‰æ•ˆä¸”ä¸é‡å¤çš„å“ç‰Œåç§°', 'error');
        }
    }

    function deleteBrand(e) {
        const {type, brand} = e.target.dataset;
        showConfirmModal(`ç¡®å®šè¦ä» "${type}" ä¸­åˆ é™¤å“ç‰Œ "${brand}" å—ï¼Ÿ`, () => {
            const brandIndex = equipmentData[type].brands.indexOf(brand);
            if (brandIndex > -1) {
                equipmentData[type].brands.splice(brandIndex, 1);
                renderBrandManagement(type);
                showNotification(`å“ç‰Œ "${brand}" å·²åˆ é™¤`);
            }
        });
    }


    function handleListingAction(e) {
        const { action, id } = e.target.dataset;
        const listing = mockListings.find(item => item.id === parseInt(id));
        if (!listing) return;

        switch(action) {
            case 'approve':
                listing.status = 'selling';
                showNotification(`ç¼–å· #${id} å·²å®¡æ ¸é€šè¿‡å¹¶ä¸Šæ¶ã€‚`);
                renderListingsManagement();
                break;
            case 'reject':
                showConfirmModal(`ç¡®å®šè¦é©³å›ç¼–å· #${id} å—?`, () => {
                    listing.status = 'off';
                    showNotification(`ç¼–å· #${id} å·²è¢«é©³å›ã€‚`);
                    renderListingsManagement();
                });
                break;
            case 'edit':
                 openAdminEditModal(parseInt(id));
                break;
            case 'delete':
                showConfirmModal(`ç¡®å®šè¦æ°¸ä¹…åˆ é™¤ç¼–å· #${id} å—?`, () => {
                    mockListings = mockListings.filter(item => item.id !== parseInt(id));
                    showNotification(`ç¼–å· #${id} å·²è¢«åˆ é™¤ã€‚`);
                    renderListingsManagement();
                });
                break;
        }
    }

    function handleUserAction(e) {
        const { action, id } = e.target.dataset;
        const user = mockUsers.find(u => u.id === parseInt(id));
        if (!user) return;

        if (action === 'ban') {
            showConfirmModal(`ç¡®å®šè¦å°ç¦ç”¨æˆ· â€œ${user.nickname}â€ å—?`, () => {
                user.status = 'banned';
                showNotification(`ç”¨æˆ· â€œ${user.nickname}â€ å·²è¢«å°ç¦ã€‚`);
                renderUserManagement();
            });
        } else if (action === 'unban') {
            user.status = 'active';
            showNotification(`ç”¨æˆ· â€œ${user.nickname}â€ å·²è§£å°ã€‚`);
            renderUserManagement();
        }
    }

    function handleReportAction(e) {
        const { action, id } = e.target.dataset;
        if (action === 'view') {
             openAdminEditModal(parseInt(id), { readOnly: true });
        } else if (action === 'process') {
            const report = mockReports.find(r => r.id === parseInt(id));
            if (report) {
                report.status = 'processed';
                showNotification(`ä¸¾æŠ¥ #${id} å·²æ ‡è®°ä¸ºå¤„ç†ã€‚`);
                renderReportManagement();
            }
        }
    }
    
    function handleIntentionAction(e) {
        const { action, id } = e.target.dataset;
        if (action === 'delete') {
            showConfirmModal(`ç¡®å®šè¦åˆ é™¤è¿™æ¡æ„å‘å— (ID: #${id})ï¼Ÿ`, () => {
                mockIntentions = mockIntentions.filter(i => i.id !== parseInt(id));
                document.getElementById('apply-intention-filters').click(); // Re-apply filters
                showNotification('æ„å‘å·²åˆ é™¤');
            });
        }
    }

    // --- ç”¨æˆ·ç«¯é¡µé¢æ¸²æŸ“ ---
    function renderIndexPage(container) {
    container.innerHTML = `
        <div class="w-full">
            <div class="bg-white p-4 border-b border-gray-200">
                <div class="filter-toggle flex justify-between items-center cursor-pointer">
                    <span class="text-base font-medium text-gray-800">å±•å¼€ç­›é€‰</span>
                    <div class="filter-arrow"></div>
                </div>
                <div class="filter-content hidden mt-4 space-y-4">
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">åœ°åŒº:</label><select class="province-select col-span-2 form-select"></select><select class="city-select col-span-2 form-select"></select></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">æ¥æº:</label><select class="source-select col-span-4 form-select"></select></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">ç±»å‹:</label><select class="type-select col-span-4 form-select"></select></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">å“ç‰Œ:</label><select class="brand-select col-span-4 form-select"></select></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label id="spec-label" class="col-span-1 text-sm text-gray-600">è§„æ ¼:</label><input class="spec-input col-span-4 form-input" placeholder="è¯·å…ˆé€‰æ‹©ç±»å‹" /></div>
                     <div class="grid grid-cols-5 gap-2 items-center"><label class="col-span-1 text-sm text-gray-600">æ’æ”¾:</label><select class="emission-select col-span-4 form-select"></select></div>
                     <div class="flex space-x-4 mt-4"><button id="reset-filters" class="flex-1 bg-yellow-500 text-white py-2 rounded-md">é‡ç½®</button><button id="apply-filters" class="flex-1 bg-blue-500 text-white py-2 rounded-md">ç­›é€‰</button></div>
                </div>
            </div>
            <div class="listings-container p-3 space-y-3"></div>
        </div>
    `;
    renderListings(container.querySelector('.listings-container'), mockListings.filter(l => l.status === 'selling'));
    
    container.querySelector('.filter-toggle').addEventListener('click', (e) => {
        const content = container.querySelector('.filter-content');
        const arrow = e.currentTarget.querySelector('.filter-arrow');
        const label = e.currentTarget.querySelector('span');
        content.classList.toggle('hidden');
        arrow.classList.toggle('up');
        label.textContent = content.classList.contains('hidden') ? "å±•å¼€ç­›é€‰" : "æ”¶èµ·ç­›é€‰";
    });
    
    const provinceSelect = container.querySelector('.province-select');
    const citySelect = container.querySelector('.city-select');
    const typeSelect = container.querySelector('.type-select');
    const brandSelect = container.querySelector('.brand-select');
    const sourceSelect = container.querySelector('.source-select');
    const specInput = container.querySelector('.spec-input');
    const specLabel = container.querySelector('#spec-label');
    const emissionSelect = container.querySelector('.emission-select');
    const applyBtn = container.querySelector('#apply-filters');
    const resetBtn = container.querySelector('#reset-filters');

    // Populate selects
    populateSelect(provinceSelect, ["ä¸é™", ...Object.keys(chinaLocations)]);
    populateSelect(citySelect, ['ä¸é™']);
    citySelect.disabled = true;
    const equipmentTypesForFilter = ['ä¸é™', ...Object.keys(equipmentData)];
    populateSelect(typeSelect, equipmentTypesForFilter);
    const allBrands = ["ä¸é™", ...new Set(Object.values(equipmentData).flatMap(type => type.brands))];
    populateSelect(brandSelect, allBrands);
    populateSelect(sourceSelect, ["ä¸é™", "è½¦ä¸»ç›´å–", "ä¸­ä»‹ä¿¡æ¯", "äºŒæ‰‹è½¦å•†"]);
    populateSelect(emissionSelect, emissionOptions);

    // Event listeners for filters
    provinceSelect.addEventListener('change', (e) => {
        const cities = chinaLocations[e.target.value] ? ["ä¸é™", ...chinaLocations[e.target.value]] : ["ä¸é™"];
        populateSelect(citySelect, cities);
        citySelect.disabled = (e.target.value === 'ä¸é™');
    });
    
    typeSelect.addEventListener('change', (e) => {
        const selectedType = e.target.value;
        const data = equipmentData[selectedType];
        
        if (data) {
            populateSelect(brandSelect, ["ä¸é™", ...data.brands]);
        } else {
            populateSelect(brandSelect, allBrands);
        }

        if(data) {
            specLabel.textContent = data.unit === 'å‹å·' ? 'å‹å·:' : `${data.unit}:`;
            specInput.placeholder = `è¯·è¾“å…¥${data.unit}`;
        } else {
             specLabel.textContent = 'è§„æ ¼:';
             specInput.placeholder = 'è¯·å…ˆé€‰æ‹©ç±»å‹';
        }
    });

    applyBtn.addEventListener('click', () => {
        let filteredListings = mockListings.filter(l => l.status === 'selling');

        const province = provinceSelect.value;
        const city = citySelect.value;
        const type = typeSelect.value;
        const brand = brandSelect.value;
        const source = sourceSelect.value;
        const spec = specInput.value;
        const emission = emissionSelect.value;

        if (province !== 'ä¸é™') {
            filteredListings = filteredListings.filter(l => l.location.startsWith(province));
            if (city !== 'ä¸é™') {
                 filteredListings = filteredListings.filter(l => l.location === `${province} ${city}`);
            }
        }
        if (type !== 'ä¸é™') {
            filteredListings = filteredListings.filter(l => l.type === type);
        }
        if (brand !== 'ä¸é™') {
            filteredListings = filteredListings.filter(l => l.brand === brand);
        }
        if (source !== 'ä¸é™') {
            filteredListings = filteredListings.filter(l => l.tags[0] === source);
        }
         if (spec) {
            filteredListings = filteredListings.filter(l => l.tonnage == spec);
        }
        if (emission !== 'ä¸é™') {
            filteredListings = filteredListings.filter(l => l.tags.includes(emission));
        }
        
        renderListings(container.querySelector('.listings-container'), filteredListings);
    });

    resetBtn.addEventListener('click', () => {
        provinceSelect.value = 'ä¸é™';
        citySelect.innerHTML = '<option>ä¸é™</option>';
        citySelect.disabled = true;
        typeSelect.value = 'ä¸é™';
        brandSelect.value = 'ä¸é™';
        sourceSelect.value = 'ä¸é™';
        specInput.value = '';
        emissionSelect.value = 'ä¸é™';
        typeSelect.dispatchEvent(new Event('change'));
        renderListings(container.querySelector('.listings-container'), mockListings.filter(l => l.status === 'selling'));
    });
}
function renderListings(container, list) {
    if (!container) return;
    container.innerHTML = '';
    if (list.length === 0) {
        container.innerHTML = `<p class="text-center text-gray-500 p-8">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è½¦è¾†</p>`;
        return;
    }
    list.forEach(item => {
        const div = document.createElement('div');
        div.className = 'bg-white rounded-lg p-3 shadow-sm relative overflow-hidden cursor-pointer';
        div.dataset.id = item.id;
        div.innerHTML = `
            <div class="absolute top-3 left-3 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded-full">${item.tags[0]}</div>
            <img src="${item.images[0]}" alt="${item.title}" class="w-full h-40 object-cover rounded-md mb-3" onerror="this.onerror=null;this.src='https://placehold.co/800x600/ccc/FFF?text=Image+Not+Found';">
            <div class="space-y-2">
                <h3 class="text-lg font-bold text-gray-800">${item.title}</h3>
                <div class="flex space-x-2">
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">${item.type}</span>
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">${item.tags[2]}</span>
                </div>
                <div class="text-xs text-gray-500 space-y-1">
                    <p>å‡ºå‚æ—¥æœŸ: ${item.manufacture_date}</p><p>å‘å¸ƒæ—¶é—´: ${item.post_date}</p><p>æ‰€åœ¨åœ°åŒº: ${item.location}</p>
                </div>
                <div class="flex justify-between items-center pt-2">
                    <span class="text-xl font-bold text-red-500">${item.price}ä¸‡</span>
                    <button class="call-btn bg-blue-500 text-white text-sm px-4 py-2 rounded-full" data-phone="${item.phone}">æ‹¨æ‰“ç”µè¯</button>
                </div>
            </div>
        `;
        div.addEventListener('click', (e) => {
            if (!e.target.closest('.call-btn')) {
               navigateTo('detail', 'è½¦è¾†è¯¦æƒ…', parseInt(e.currentTarget.dataset.id));
            }
        });
        container.appendChild(div);
    });
}
function renderDetailPage(id) {
    const pageDetail = document.getElementById('page-detail');
    const item = mockListings.find(i => i.id === id);
    if (!item) return;

    const serialNumber = String(item.id).padStart(5, '0');

    let imageSlides = item.images.map(imgUrl => `
        <div class="flex-shrink-0 w-full h-full carousel-slide">
            <img src="${imgUrl}" class="w-full h-full object-cover cursor-pointer" onerror="this.onerror=null;this.src='https://placehold.co/800x600/ccc/FFF?text=Image+Not+Found';">
        </div>
    `).join('');

    const isFavorited = mockFavorites.includes(id);

    pageDetail.innerHTML = `
        <div class="w-full bg-gray-100 pb-20">
            <div class="relative w-full h-64 bg-black overflow-hidden">
                <div class="flex h-full carousel-container">${imageSlides}</div>
            </div>
            <div class="bg-white p-4 -mt-2 rounded-t-lg">
                <div class="flex justify-between items-start">
                    <h2 class="text-xl font-bold text-gray-800">${item.title}</h2>
                    <span class="text-sm text-gray-400 font-mono flex-shrink-0 ml-2 pt-1">ç¼–å·: #${serialNumber}</span>
                </div>
                <p class="text-2xl font-bold text-red-500 my-2">${item.price} ä¸‡</p>
                <div class="flex space-x-2 my-3">
                    <span class="bg-gray-100 text-gray-700 text-xs font-medium px-2.5 py-1 rounded">${item.type}</span>
                    <span class="bg-gray-100 text-gray-700 text-xs font-medium px-2.5 py-1 rounded">${item.tags[2]}</span>
                </div>
            </div>
            <div class="bg-white p-4 mt-2">
                <h3 class="font-semibold text-base mb-3 border-l-4 border-blue-500 pl-2">è¯¦ç»†ä¿¡æ¯</h3>
                <div class="grid grid-cols-2 gap-y-3 text-gray-600 text-sm">
                    <p><strong>è®¾å¤‡å“ç‰Œ:</strong> ${item.brand}</p>
                    <p><strong>è®¾å¤‡å‹å·:</strong> ${item.title.split(' - ')[0]}</p>
                    <p><strong>å·¥ä½œå°æ—¶:</strong> ${item.work_hours} å°æ—¶</p>
                    <p><strong>è¡Œé©¶é‡Œç¨‹:</strong> ${item.mileage > 0 ? `${item.mileage} å…¬é‡Œ` : 'æ— '}</p>
                    <p><strong>å‡ºå‚æ—¥æœŸ:</strong> ${item.manufacture_date}</p>
                    <p><strong>æ’æ”¾æ ‡å‡†:</strong> ${item.tags[2]}</p>
                    <p><strong>æ‰€åœ¨åœ°åŒº:</strong> ${item.location}</p>
                    <p><strong>å‘å¸ƒæ—¶é—´:</strong> ${item.post_date}</p>
                </div>
            </div>
             <div class="bg-white p-4 mt-2">
                <h3 class="font-semibold text-base mb-3 border-l-4 border-blue-500 pl-2">è”ç³»æ–¹å¼</h3>
                <div class="grid grid-cols-2 gap-y-3 text-gray-600 text-sm">
                     <p><strong>è”ç³»äºº:</strong> ${item.contact_person}</p>
                     <p><strong>è”ç³»ç”µè¯:</strong> ${item.phone}</p>
                </div>
            </div>
            <div class="bg-white p-4 mt-2">
                 <h3 class="font-semibold text-base mb-3 border-l-4 border-blue-500 pl-2">è¯¦æƒ…æè¿°</h3>
                 <p class="text-gray-600 text-sm leading-relaxed">è½¦å†µè‰¯å¥½ï¼Œä¿å…»åˆ°ä½ï¼Œæ‰‹ç»­é½å…¨ï¼Œä¸ªäººä¸€æ‰‹è½¦ï¼Œéšæ—¶å¯ä»¥çœ‹è½¦...</p>
            </div>
        </div>
    `;
    
    detailActionBar.innerHTML = `
        <div class="h-full bg-white p-2 flex justify-between items-center text-sm text-gray-600">
             <div class="flex items-center space-x-4 pl-2">
                <span class="fav-btn cursor-pointer flex flex-col items-center" data-id="${id}">
                   <svg class="w-6 h-6 mb-1 ${isFavorited ? 'text-yellow-500' : 'text-gray-500'}" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                   <span>${isFavorited ? 'å·²æ”¶è—' : 'æ”¶è—'}</span>
                </span>
                <span class="share-btn cursor-pointer flex flex-col items-center">
                   <svg class="w-6 h-6 mb-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.368a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path></svg>
                   <span>åˆ†äº«</span>
                </span>
                <span class="report-btn cursor-pointer flex flex-col items-center">
                    <svg class="w-6 h-6 mb-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>ä¸¾æŠ¥</span>
                </span>
             </div>
             <button class="call-btn bg-blue-500 text-white py-3 px-8 rounded-full text-base font-semibold" data-phone="${item.phone}">ä¸€é”®æ‹¨å·</button>
        </div>
    `;

    pageDetail.querySelectorAll('.carousel-slide img').forEach(img => img.addEventListener('click', () => openLightbox(img.src)));
    
    detailActionBar.querySelector('.report-btn').addEventListener('click', () => {
        navigateTo('report', 'ä¿¡æ¯ä¸¾æŠ¥');
    });
    detailActionBar.querySelector('.share-btn').addEventListener('click', () => showNotification('å·²æ¨¡æ‹Ÿåˆ†äº«æ“ä½œ'));
    detailActionBar.querySelector('.fav-btn').addEventListener('click', (e) => {
        const btn = e.currentTarget;
        const carId = parseInt(btn.dataset.id);
        const favIndex = mockFavorites.indexOf(carId);
        const isFavorited = favIndex > -1;

        if (isFavorited) {
            mockFavorites.splice(favIndex, 1);
        } else {
            mockFavorites.push(carId);
        }
        
        btn.innerHTML = `
            <svg class="w-6 h-6 mb-1 ${!isFavorited ? 'text-yellow-500' : 'text-gray-500'}" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
            <span>${!isFavorited ? 'å·²æ”¶è—' : 'æ”¶è—'}</span>
        `;
        showNotification(!isFavorited ? 'æ”¶è—æˆåŠŸ' : 'å·²å–æ¶ˆæ”¶è—');
    });
}
function renderPostPage(container, postToEditId = null) {
    const isEditing = postToEditId !== null;
    const postToEdit = isEditing ? mockListings.find(p => p.id === postToEditId) : null;
    const submitButtonText = isEditing ? 'ä¿å­˜ä¿®æ”¹' : 'æäº¤å®¡æ ¸';
    
    container.innerHTML = `
        <div class="w-full p-4 space-y-4 bg-white min-h-full">
            <div class="p-4 bg-gray-50 rounded-lg">
                <p class="font-medium text-gray-700 mb-2">è½¦è¾†ç…§ç‰‡ (æœ€å¤š9å¼ )</p>
                <div class="previews-container grid grid-cols-4 gap-3">
                    <input type="file" class="image-upload hidden" multiple accept="image/*">
                    <div class="upload-trigger w-full h-20 bg-gray-200 rounded-md flex items-center justify-center cursor-pointer">
                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">å‘å¸ƒè€…èº«ä»½</label><select id="post-identity-select" class="col-span-2 form-select"><option>è½¦ä¸»ç›´å–</option><option>ä¸­ä»‹ä¿¡æ¯</option><option>äºŒæ‰‹è½¦å•†</option></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">è®¾å¤‡ç±»å‹</label><select id="post-type-select" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">å“ç‰Œ</label><select id="post-brand-select" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">å‹å·</label><input id="post-model-input" class="col-span-2 form-input" placeholder="è¯·è¾“å…¥å‹å·"></div>
                <div class="grid grid-cols-3 items-center"><label id="post-spec-label" class="col-span-1">è§„æ ¼</label><input type="number" id="post-spec-input" class="col-span-2 form-input" placeholder="è¯·é€‰æ‹©ç±»å‹"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">ä»·æ ¼(ä¸‡)</label><input type="number" id="post-price-input" class="col-span-2 form-input" placeholder="ç•™ç©ºåˆ™æ˜¾ç¤ºâ€œé¢è®®â€"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">æ‰€åœ¨åœ°</label><div class="col-span-2 grid grid-cols-2 gap-2"><select id="post-province-select" class="form-select"></select><select id="post-city-select" class="form-select"></select></div></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">å‡ºå‚æ—¥æœŸ</label><input id="post-date-input" type="month" class="col-span-2 form-input"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">æ’æ”¾æ ‡å‡†</label><select id="post-emission-select" class="col-span-2 form-select"></select></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">å·¥ä½œå°æ—¶</label><input id="post-work-hours" type="number" class="col-span-2 form-input" placeholder="è¯·è¾“å…¥å·¥ä½œå°æ—¶"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">è¡Œé©¶é‡Œç¨‹</label><input id="post-mileage" type="number" class="col-span-2 form-input" placeholder="è¯·è¾“å…¥è¡Œé©¶é‡Œç¨‹(å…¬é‡Œ)"></div>
                <div><label>è½¦å†µæè¿°</label><textarea class="form-textarea mt-2" rows="4" placeholder="è¯·è¾“å…¥è½¦å†µæè¿°..."></textarea></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">è”ç³»äºº</label><input id="post-contact-person" class="col-span-2 form-input" placeholder="è¯·è¾“å…¥è”ç³»äººå§“å"></div>
                <div class="grid grid-cols-3 items-center"><label class="col-span-1">è”ç³»ç”µè¯</label><input id="post-phone" type="tel" class="col-span-2 form-input" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯"></div>
            </div>
            
            <button id="save-post-btn" class="w-full bg-blue-500 text-white py-3 rounded-lg text-lg font-semibold mt-6">${submitButtonText}</button>
        </div>
    `;
    const uploadTrigger = container.querySelector('.upload-trigger');
    const imageUploadInput = container.querySelector('.image-upload');
    uploadTrigger.addEventListener('click', () => imageUploadInput.click());
    imageUploadInput.addEventListener('change', (e) => handleImageUpload(e, container));
    
    const typeSelect = container.querySelector('#post-type-select');
    const brandSelect = container.querySelector('#post-brand-select');
    const specLabel = container.querySelector('#post-spec-label');
    const specInput = container.querySelector('#post-spec-input');
    const provinceSelect = container.querySelector('#post-province-select');
    const citySelect = container.querySelector('#post-city-select');

    populateSelect(typeSelect, Object.keys(equipmentData));
    typeSelect.addEventListener('change', e => {
        const type = e.target.value;
        const data = equipmentData[type];
        populateSelect(brandSelect, data ? data.brands : []);
        specLabel.textContent = data ? `${data.unit}:` : `è§„æ ¼:`;
        specInput.placeholder = data ? `è¯·è¾“å…¥${data.unit}` : `è¯·é€‰æ‹©ç±»å‹`;
    });
    
    populateSelect(provinceSelect, Object.keys(chinaLocations));
    provinceSelect.addEventListener('change', e => {
        populateSelect(citySelect, chinaLocations[e.target.value] || []);
    });
    
    populateSelect(container.querySelector('#post-emission-select'), emissionOptions.slice(1));
    
    if(isEditing && postToEdit) {
        typeSelect.value = postToEdit.type;
        typeSelect.dispatchEvent(new Event('change'));
        brandSelect.value = postToEdit.brand;
        container.querySelector('#post-model-input').value = postToEdit.title.split(' - ')[0]; 
        specInput.value = postToEdit.tonnage;
        container.querySelector('#post-price-input').value = postToEdit.price;
        container.querySelector('#post-work-hours').value = postToEdit.work_hours;
        container.querySelector('#post-mileage').value = postToEdit.mileage;
        container.querySelector('#post-contact-person').value = postToEdit.contact_person;
        container.querySelector('#post-phone').value = postToEdit.phone;
        const [province, city] = postToEdit.location.split(' ');
        provinceSelect.value = Object.keys(chinaLocations).find(p => p.startsWith(province));
        provinceSelect.dispatchEvent(new Event('change'));
        citySelect.value = city;
        container.querySelector('#post-date-input').value = postToEdit.manufacture_date;
        container.querySelector('#post-emission-select').value = postToEdit.tags[2];
        handleImageUpload({ target: { files: [] }}, container, postToEdit.images);
    } else {
         typeSelect.dispatchEvent(new Event('change'));
         provinceSelect.dispatchEvent(new Event('change'));
    }

    container.querySelector('#save-post-btn').addEventListener('click', () => {
         showNotification(isEditing ? 'ä¿®æ”¹å·²ä¿å­˜' : 'å·²æäº¤å®¡æ ¸');
         navigateBack();
    });
}
function renderProfilePage(container) {
    container.innerHTML = `
         <div class="w-full">
             <div class="p-6 bg-white flex items-center space-x-4">
                 <img src="https://picsum.photos/seed/avatar/80/80" class="w-20 h-20 rounded-full object-cover" alt="avatar" />
                 <div>
                     <p class="text-xl font-bold">åŠè½¦å¤§ç‹</p>
                     <p class="text-sm text-gray-500 mt-1">ID: user_123456</p>
                 </div>
             </div>
             <div class="mt-4 bg-white profile-menu">
                 <div class="p-4 border-b border-gray-200 flex justify-between items-center cursor-pointer" data-page="favorites"><span>æˆ‘çš„æ”¶è—</span><span>&gt;</span></div>
                 <div class="p-4 border-b border-gray-200 flex justify-between items-center cursor-pointer" data-page="posts"><span>æˆ‘çš„å‘å¸ƒ</span><span>&gt;</span></div>
                 <div class="p-4 border-b border-gray-200 flex justify-between items-center cursor-pointer" data-page="intentions"><span>æ„å‘è½¦å‹</span><span>&gt;</span></div>
             </div>
         </div>
    `;
    container.querySelector('.profile-menu').addEventListener('click', (e) => {
        const target = e.target.closest('div[data-page]');
        if (target) {
            const pageId = target.dataset.page;
            const title = target.querySelector('span').textContent;
            navigateTo(pageId, title);
        }
    });
}
function renderReportPage(container) {
    container.innerHTML = `
        <div class="w-full p-4 space-y-5">
            <div class="bg-blue-50 p-3 rounded-lg text-sm text-blue-700"><strong>è¯´æ˜:</strong> åšå†³ç¦æ­¢éæ³•ã€è™šå‡ç­‰ä¿¡æ¯ï¼Œæ‚¨çš„æŠ•è¯‰æˆ‘ä»¬ä¼šè®¤çœŸæŸ¥å®å¹¶æ ¹æ®å¹³å°åè®®è¿›è¡Œè½å®ï¼</div>
            <div class="bg-white p-4 rounded-lg space-y-4"><p class="font-semibold">è½¦è¾†ä¿¡æ¯</p>
                <label class="flex items-center space-x-3"><input type="radio" name="report_reason" class="form-radio h-5 w-5 text-blue-600" checked><span>è™šå‡ä¿¡æ¯</span></label>
                <label class="flex items-center space-x-3"><input type="radio" name="report_reason" class="form-radio h-5 w-5 text-blue-600"><span>è½¦è¾†å·²å”®</span></label>
                <label class="flex items-center space-x-3"><input type="radio" name="report_reason" class="form-radio h-5 w-5 text-blue-600"><span>ä¸­ä»‹è½¦æº/è½¦ä¸»è½¦æº æ ‡è¯†é”™è¯¯</span></label>
            </div>
            <div class="bg-white p-4 rounded-lg"><p class="font-semibold mb-2">æŠ•è¯‰ç†ç”±</p><textarea class="w-full h-32 p-2 bg-gray-50 rounded-md focus:outline-none" placeholder="è¯·è¾“å…¥æ‚¨çš„ä¸¾æŠ¥ç†ç”±..."></textarea></div>
            <button class="w-full bg-blue-500 text-white py-3 rounded-lg text-lg font-semibold">æäº¤</button>
            <p class="text-xs text-gray-500 mt-2">*å…è´£å£°æ˜: å¹³å°ä»…æä¾›ä¿¡æ¯å±•ç¤ºæœåŠ¡, å†…å®¹çœŸå®æ€§ç”±ç”¨æˆ·è‡ªè¡Œå®¡æ ¸, è‡ªè¡Œè´Ÿè´£ã€‚</p>
        </div>
    `;
}
function renderFavoritesPage(page) {
    const favList = mockListings.filter(item => mockFavorites.includes(item.id));
    
    if (favList.length === 0) {
        page.innerHTML = `<div class="text-center p-10 text-gray-500">ä½ è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•è½¦è¾†</div>`;
        return;
    }

    let content = '<div class="p-3 space-y-3">';
    favList.forEach(item => {
        content += `
         <div class="bg-white rounded-lg p-3 shadow-sm flex items-center space-x-4">
             <div class="flex-1 flex items-center space-x-4 cursor-pointer item-link" data-id="${item.id}">
                 <img src="${item.images[0]}" class="w-24 h-24 object-cover rounded-md flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/200/ccc/FFF?text=N/A';">
                 <div class="flex-1">
                     <h4 class="font-bold text-gray-800">${item.title}</h4>
                     <p class="text-sm text-gray-500">${item.location}</p>
                     <p class="text-lg font-bold text-red-500 mt-2">${item.price}ä¸‡</p>
                 </div>
             </div>
             <button class="unfav-btn text-sm bg-gray-200 px-3 py-1 rounded-full flex-shrink-0" data-id="${item.id}">å–æ¶ˆæ”¶è—</button>
        </div>`;
    });
    content += '</div>';
    page.innerHTML = content;
    
    page.querySelectorAll('.item-link').forEach(link => {
        link.addEventListener('click', e => {
            const carId = parseInt(e.currentTarget.dataset.id);
            navigateTo('detail', 'è½¦è¾†è¯¦æƒ…', carId);
        });
    });

    page.querySelectorAll('.unfav-btn').forEach(btn => btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const carId = parseInt(e.target.dataset.id);
        showConfirmModal('ç¡®å®šè¦å–æ¶ˆæ”¶è—å—?', () => {
            const favIndex = mockFavorites.indexOf(carId);
            if (favIndex > -1) {
                mockFavorites.splice(favIndex, 1);
                renderFavoritesPage(page); 
            }
        });
    }));
}
function renderPostsPage(page) {
    let content = '<div class="p-3 space-y-3">';
    const userPostings = mockListings.filter(listing => mockMyPosts.some(p => p.id === listing.id));
    
    userPostings.forEach(item => {
        const statusMap = { selling: 'å·²ä¸Šæ¶', reviewing: 'å®¡æ ¸ä¸­', off: 'å·²ä¸‹æ¶' };
        const statusColor = { selling: 'text-green-600', reviewing: 'text-yellow-600', off: 'text-gray-500' };

        content += `
         <div class="bg-white rounded-lg p-3 shadow-sm">
             <div class="flex space-x-4">
                 <img src="${item.images[0]}" class="w-24 h-24 object-cover rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/200/ccc/FFF?text=N/A';">
                 <div class="flex-1">
                     <h4 class="font-bold text-gray-800">${item.title}</h4>
                     <p class="text-sm font-semibold ${statusColor[item.status]} mt-2">${statusMap[item.status]}</p>
                 </div>
             </div>
             <div class="border-t border-gray-100 mt-3 pt-3 flex justify-end space-x-2">
                 ${item.status === 'off' ? `<button class="post-action-btn" data-action="list" data-id="${item.id}">ä¸Šæ¶</button>` : ''}
                 ${item.status === 'selling' ? `<button class="post-action-btn" data-action="unlist" data-id="${item.id}">ä¸‹æ¶</button>` : ''}
                 <button class="post-action-btn" data-action="edit" data-id="${item.id}">ç¼–è¾‘</button>
                 <button class="post-action-btn text-red-500" data-action="delete" data-id="${item.id}">åˆ é™¤</button>
             </div>
        </div>`;
    });
    content += '</div>';
    page.innerHTML = content;
    
    page.querySelectorAll('.post-action-btn').forEach(btn => btn.addEventListener('click', e => {
        const action = e.target.dataset.action;
        const id = parseInt(e.target.dataset.id);
        const post = mockListings.find(p => p.id === id);

        if (action === 'delete') {
             showConfirmModal('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ', () => {
                 mockListings = mockListings.filter(p => p.id !== id);
                 mockMyPosts = mockMyPosts.filter(p => p.id !== id);
                 renderPostsPage(page);
             });
        } else if (action === 'list') {
             if (post) {
                 post.status = 'selling';
                 renderPostsPage(page);
             }
        } else if (action === 'unlist') {
             if (post) {
                 post.status = 'off';
                 renderPostsPage(page);
             }
        } else if (action === 'edit') {
             navigateTo('post', 'ç¼–è¾‘ä¿¡æ¯', id);
        }
    }));
}
function renderIntentionsPage(page) {
    let content = `<div class="p-3 space-y-3">
        <button id="add-intention-btn-page" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold">æ·»åŠ æ„å‘è½¦å‹</button>
    `;
    mockIntentions.forEach(item => {
        const locationsText = item.locations.map(loc => `${loc.province}-${loc.city}`).join(', ');
        content += `
        <div class="bg-white rounded-lg p-4 shadow-sm">
            <div class="flex justify-between items-start">
                <div>
                    <h4 class="font-bold text-lg">${item.brand} - ${item.type}</h4>
                    <p class="text-sm text-gray-600">è§„æ ¼: ${item.tonnage || 'ä¸é™'} | æ’æ”¾: ${item.emission}</p>
                    <p class="text-sm text-gray-600 mt-1">åœ°åŒº: ${locationsText}</p>
                </div>
                <div class="flex space-x-2 flex-shrink-0 pl-2">
                    <button class="edit-intention-btn text-sm text-blue-500" data-id="${item.id}">ä¿®æ”¹</button>
                    <button class="delete-intention-btn text-sm text-red-500" data-id="${item.id}">åˆ é™¤</button>
                </div>
            </div>
        </div>
        `;
    });
    content += '</div>';
    page.innerHTML = content;
    
    page.querySelector('#add-intention-btn-page').addEventListener('click', () => openIntentionModal());
    page.querySelectorAll('.edit-intention-btn').forEach(btn => btn.addEventListener('click', e => {
        const id = parseInt(e.target.dataset.id);
        openIntentionModal(id);
    }));
    page.querySelectorAll('.delete-intention-btn').forEach(btn => btn.addEventListener('click', e => {
        showConfirmModal('ç¡®å®šè¦åˆ é™¤æ­¤æ„å‘å—?', () => {
            const id = parseInt(e.target.dataset.id);
            mockIntentions = mockIntentions.filter(i => i.id !== id);
            renderIntentionsPage(page);
        });
    }));
}
function openIntentionModal(id = null) {
    editingIntentionId = id;
    const modalTitle = intentionModal.querySelector('#intention-modal-title');
    const typeSelect = intentionModal.querySelector('#intention-type');
    const brandSelect = intentionModal.querySelector('#intention-brand');
    const tonnageInput = intentionModal.querySelector('#intention-tonnage');
    const emissionSelect = intentionModal.querySelector('#intention-emission');
    
    populateSelect(typeSelect, Object.keys(equipmentData));
    populateSelect(emissionSelect, emissionOptions);
    
    typeSelect.onchange = e => {
        const type = e.target.value;
        const brands = equipmentData[type] ? ["ä¸é™", ...equipmentData[type].brands] : ["ä¸é™"];
        populateSelect(brandSelect, brands);
    };

    if (id !== null) {
        modalTitle.textContent = 'ä¿®æ”¹æ„å‘';
        const intention = mockIntentions.find(i => i.id === id);
        typeSelect.value = intention.type;
        tonnageInput.value = intention.tonnage === 'ä¸é™' ? '' : intention.tonnage;
        emissionSelect.value = intention.emission;
        currentIntentionLocations = [...intention.locations];
        typeSelect.dispatchEvent(new Event('change'));
        brandSelect.value = intention.brand;

    } else {
        modalTitle.textContent = 'æ·»åŠ æ„å‘';
        currentIntentionLocations = [];
        typeSelect.value = Object.keys(equipmentData)[0];
        tonnageInput.value = '';
        emissionSelect.value = 'ä¸é™';
        typeSelect.dispatchEvent(new Event('change'));
    }

    setupLocationPicker();
    renderLocationTags();
    intentionModal.classList.remove('hidden');
}
function setupLocationPicker() {
    const provinceSelect = intentionModal.querySelector('#intention-province');
    const citySelect = intentionModal.querySelector('#intention-city');
    populateSelect(provinceSelect, Object.keys(chinaLocations));
    provinceSelect.onchange = e => {
        const cities = chinaLocations[e.target.value] ? ["ä¸é™", ...chinaLocations[e.target.value]] : [];
        populateSelect(citySelect, cities);
    };
    provinceSelect.dispatchEvent(new Event('change'));
}
function renderLocationTags() {
    const displayDiv = intentionModal.querySelector('#intention-locations-display');
    displayDiv.innerHTML = '';
    if (currentIntentionLocations.length === 0) {
        displayDiv.innerHTML = `<span class="text-gray-400">å°šæœªæ·»åŠ åœ°åŒº</span>`;
    }
    currentIntentionLocations.forEach((loc, index) => {
        const tag = document.createElement('span');
        tag.className = 'inline-flex items-center bg-blue-100 text-blue-800 text-sm font-medium mr-2 mb-2 px-2.5 py-1 rounded-full';
        tag.innerHTML = `${loc.province} - ${loc.city} <button class="ml-2 text-blue-600 hover:text-blue-800" data-index="${index}">&times;</button>`;
        tag.querySelector('button').addEventListener('click', e => {
            currentIntentionLocations.splice(parseInt(e.target.dataset.index), 1);
            renderLocationTags();
        });
        displayDiv.appendChild(tag);
    });
}
function openAdminEditModal(listingId, options = {}) {
    const { readOnly = false } = options;
    const item = mockListings.find(l => l.id === listingId);
    if (!item) return;

    const formContainer = document.getElementById('admin-edit-form-container');
    const sourceOptions = ["è½¦ä¸»ç›´å–", "ä¸­ä»‹ä¿¡æ¯", "äºŒæ‰‹è½¦å•†"];
    const statusMap = { selling: 'å·²ä¸Šæ¶', reviewing: 'å¾…å®¡æ ¸', off: 'å·²ä¸‹æ¶' };
    
    formContainer.innerHTML = `
        <div class="space-y-4">
            <div class="grid grid-cols-3 items-center"><label class="col-span-1">æ ‡é¢˜</label><input id="admin-edit-title" class="col-span-2 form-input" value="${item.title}" ${readOnly ? 'disabled' : ''}></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">ä»·æ ¼(ä¸‡)</label><input type="number" id="admin-edit-price" class="col-span-2 form-input" value="${item.price}" ${readOnly ? 'disabled' : ''}></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">æ¥æº</label><select id="admin-edit-source" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">è®¾å¤‡ç±»å‹</label><select id="admin-edit-type" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">å“ç‰Œ</label><select id="admin-edit-brand" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">æ’æ”¾æ ‡å‡†</label><select id="admin-edit-emission" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">å·¥ä½œå°æ—¶</label><input type="number" id="admin-edit-work-hours" class="col-span-2 form-input" value="${item.work_hours}" ${readOnly ? 'disabled' : ''}></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">è¡Œé©¶é‡Œç¨‹(km)</label><input type="number" id="admin-edit-mileage" class="col-span-2 form-input" value="${item.mileage}" ${readOnly ? 'disabled' : ''}></div>
             <div class="grid grid-cols-3 items-center"><label class="col-span-1">çŠ¶æ€</label><select id="admin-edit-status" class="col-span-2 form-select" ${readOnly ? 'disabled' : ''}></select></div>
             <div id="admin-modal-buttons" class="flex justify-end space-x-4 pt-4">
                <button id="cancel-admin-edit" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md">å–æ¶ˆ</button>
                <button id="save-admin-edit" data-id="${listingId}" class="bg-blue-600 text-white px-4 py-2 rounded-md">ä¿å­˜æ›´æ”¹</button>
            </div>
        </div>
    `;
    
    const typeSelect = document.getElementById('admin-edit-type');
    const brandSelect = document.getElementById('admin-edit-brand');
    const statusSelect = document.getElementById('admin-edit-status');
    const modalButtons = document.getElementById('admin-modal-buttons');
    
    populateSelect(document.getElementById('admin-edit-source'), sourceOptions, item.tags[0]);
    populateSelect(typeSelect, Object.keys(equipmentData), item.type);
    populateSelect(brandSelect, equipmentData[item.type].brands, item.brand);
    populateSelect(document.getElementById('admin-edit-emission'), emissionOptions, item.tags[2]);
    
    statusSelect.innerHTML = Object.entries(statusMap).map(([key, value]) => `<option value="${key}">${value}</option>`).join('');
    statusSelect.value = item.status;

    typeSelect.addEventListener('change', e => {
        const selectedType = e.target.value;
        const brands = equipmentData[selectedType] ? equipmentData[selectedType].brands : [];
        populateSelect(brandSelect, brands);
    });

    if (readOnly) {
        document.getElementById('admin-edit-modal-title').textContent = 'æŸ¥çœ‹ä¿¡æ¯';
        modalButtons.innerHTML = `<button id="cancel-admin-edit" class="bg-blue-600 text-white px-4 py-2 rounded-md">å…³é—­</button>`;
    } else {
        document.getElementById('admin-edit-modal-title').textContent = 'ç¼–è¾‘ä¿¡æ¯';
        document.getElementById('save-admin-edit').addEventListener('click', saveAdminEdit);
    }
    
    document.getElementById('cancel-admin-edit').addEventListener('click', closeAdminEditModal);
    adminEditModal.classList.remove('hidden');
}

function saveAdminEdit(e) {
    const listingId = parseInt(e.target.dataset.id);
    const listing = mockListings.find(l => l.id === listingId);
    if (listing) {
        listing.title = document.getElementById('admin-edit-title').value;
        listing.price = document.getElementById('admin-edit-price').value;
        listing.status = document.getElementById('admin-edit-status').value;
        listing.type = document.getElementById('admin-edit-type').value;
        listing.brand = document.getElementById('admin-edit-brand').value;
        listing.work_hours = document.getElementById('admin-edit-work-hours').value;
        listing.mileage = document.getElementById('admin-edit-mileage').value;
        listing.tags[0] = document.getElementById('admin-edit-source').value;
        listing.tags[2] = document.getElementById('admin-edit-emission').value;
        
        showNotification('ä¿¡æ¯å·²æ›´æ–°');
        renderListingsManagement();
        closeAdminEditModal();
    }
}
    function initializeApp() {
        // å…¨å±€äº‹ä»¶ç›‘å¬
        viewToggleBtn.addEventListener('click', toggleView);
        adminSidebarItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                renderAdminContent(item.dataset.page);
            });
        });
        document.getElementById('save-settings-btn').addEventListener('click', () => {
            showNotification('è®¾ç½®å·²ä¿å­˜ï¼');
        });
        document.getElementById('close-admin-edit-modal').addEventListener('click', closeAdminEditModal);

        // ç”¨æˆ·ç«¯äº‹ä»¶ç›‘å¬
        tabItems.forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.page)));
        backButton.addEventListener('click', navigateBack);
        screenElement.addEventListener('click', (e) => {
            const callButton = e.target.closest('.call-btn');
            if (callButton) {
                e.stopPropagation();
                showCallModal(callButton.dataset.phone);
            }
        });
        detailActionBar.addEventListener('click', (e) => {
            const callButton = e.target.closest('.call-btn');
            if(callButton){
                e.stopPropagation();
                showCallModal(callButton.dataset.phone);
            }
        });
        cancelCallBtn.addEventListener('click', hideCallModal);
        confirmCallBtn.addEventListener('click', () => {
            showNotification('æ¨¡æ‹Ÿå‘¼å«ä¸­...');
            hideCallModal();
        });
        cancelConfirmBtn.addEventListener('click', hideConfirmModal);
        closeLightboxBtn.addEventListener('click', closeLightbox);
        intentionModal.querySelector('#close-intention-modal').addEventListener('click', closeIntentionModal);
        intentionModal.querySelector('#add-location-btn').addEventListener('click', () => {
            const province = intentionModal.querySelector('#intention-province').value;
            const city = intentionModal.querySelector('#intention-city').value;
            if(province && city) {
                if (!currentIntentionLocations.some(l => l.province === province && l.city === city)) {
                    currentIntentionLocations.push({ province, city });
                    renderLocationTags();
                } else {
                    showNotification('è¯¥åœ°åŒºå·²æ·»åŠ ');
                }
            }
        });
        intentionModal.querySelector('#save-intention-btn').addEventListener('click', () => {
            const newIntention = {
                id: editingIntentionId !== null ? editingIntentionId : Date.now(),
                userId: 104, // Mock user ID
                type: intentionModal.querySelector('#intention-type').value,
                brand: intentionModal.querySelector('#intention-brand').value,
                tonnage: intentionModal.querySelector('#intention-tonnage').value || 'ä¸é™',
                emission: intentionModal.querySelector('#intention-emission').value,
                locations: [...currentIntentionLocations]
            };
            if(newIntention.locations.length === 0) {
                showNotification('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªåœ°åŒº');
                return;
            }
            if (editingIntentionId !== null) {
                const index = mockIntentions.findIndex(i => i.id === editingIntentionId);
                mockIntentions[index] = newIntention;
            } else {
                newIntention.id = Date.now();
                mockIntentions.push(newIntention);
            }
            renderIntentionsPage(document.getElementById('page-intentions'));
            closeIntentionModal();
        });

        // åˆå§‹åŠ è½½
        updateTime();
        setInterval(updateTime, 1000 * 60);
        renderPage('index');
        showPage('index');
    }

    // --- åº”ç”¨å¯åŠ¨ ---
    initializeApp();
    });
</script>

</body>
</html>
