"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[15],{4967:function(e,a,n){var t=n(2180),s=n(8118),r=n(5308),c=n(298),i=n(2276),l=n(7042),o=n(4460),m=n(597),d=n(1867),p=n(5023),u=n(201),h=n(1515),x=(n(2954),n(302)),v=n(1876),g=n(2269),f=function(e){function a(){var e;(0,l.Z)(this,a);for(var n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];return e=(0,m.Z)(this,a,[].concat(t)),(0,p.Z)(e,"state",{formData:{title:"",type:"",brand:"",tonnage:"",manufacture_date:"",province:"",city:"",price:"",phone:"",contact_person:"",work_hours:"",mileage:"",emission:"",description:""},images:[],provinces:["\u8bf7\u9009\u62e9\u7701\u4efd"],cities:["\u8bf7\u9009\u62e9\u57ce\u5e02"],types:["\u8bf7\u9009\u62e9\u7c7b\u578b"],brands:["\u8bf7\u9009\u62e9\u54c1\u724c"],emissions:x.ES,provinceIndex:0,cityIndex:0,typeIndex:0,brandIndex:0,emissionIndex:0,errors:{},submitting:!1}),(0,p.Z)(e,"initData",function(){var a=["\u8bf7\u9009\u62e9\u7701\u4efd"].concat((0,i.Z)(Object.keys(x.bY))),n=["\u8bf7\u9009\u62e9\u7c7b\u578b"].concat((0,i.Z)(Object.keys(x.mj)));e.setState({provinces:a,types:n})}),(0,p.Z)(e,"validateForm",function(){var a=e.state.formData,n={};return a.title.trim()||(n.title="\u8bf7\u8f93\u5165\u5546\u54c1\u6807\u9898"),a.type&&"\u8bf7\u9009\u62e9\u7c7b\u578b"!==a.type||(n.type="\u8bf7\u9009\u62e9\u8bbe\u5907\u7c7b\u578b"),a.brand&&"\u8bf7\u9009\u62e9\u54c1\u724c"!==a.brand||(n.brand="\u8bf7\u9009\u62e9\u54c1\u724c"),a.tonnage.trim()?isNaN(parseFloat(a.tonnage))&&(n.tonnage="\u89c4\u683c\u5fc5\u987b\u662f\u6570\u5b57"):n.tonnage="\u8bf7\u8f93\u5165\u89c4\u683c",a.price.trim()?isNaN(parseFloat(a.price))&&(n.price="\u4ef7\u683c\u5fc5\u987b\u662f\u6570\u5b57"):n.price="\u8bf7\u8f93\u5165\u4ef7\u683c",a.phone.trim()?/^1[3-9]\d{9}$/.test(a.phone)||(n.phone="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801"):n.phone="\u8bf7\u8f93\u5165\u8054\u7cfb\u7535\u8bdd",a.contact_person.trim()||(n.contact_person="\u8bf7\u8f93\u5165\u8054\u7cfb\u4eba\u59d3\u540d"),a.province&&"\u8bf7\u9009\u62e9\u7701\u4efd"!==a.province||(n.province="\u8bf7\u9009\u62e9\u7701\u4efd"),a.city&&"\u8bf7\u9009\u62e9\u57ce\u5e02"!==a.city||(n.city="\u8bf7\u9009\u62e9\u57ce\u5e02"),e.setState({errors:n}),0===Object.keys(n).length}),(0,p.Z)(e,"handleInputChange",function(a,n){e.setState({formData:(0,c.Z)((0,c.Z)({},e.state.formData),{},(0,p.Z)({},a,n)),errors:(0,c.Z)((0,c.Z)({},e.state.errors),{},(0,p.Z)({},a,""))})}),(0,p.Z)(e,"onProvinceChange",function(a){var n=a.detail.value,t=e.state.provinces[n],s="\u8bf7\u9009\u62e9\u7701\u4efd"===t?["\u8bf7\u9009\u62e9\u57ce\u5e02"]:["\u8bf7\u9009\u62e9\u57ce\u5e02"].concat((0,i.Z)(x.bY[t]));e.setState({provinceIndex:n,cityIndex:0,cities:s,formData:(0,c.Z)((0,c.Z)({},e.state.formData),{},{province:t,city:"\u8bf7\u9009\u62e9\u57ce\u5e02"})})}),(0,p.Z)(e,"onCityChange",function(a){var n=a.detail.value,t=e.state.cities[n];e.setState({cityIndex:n,formData:(0,c.Z)((0,c.Z)({},e.state.formData),{},{city:t})})}),(0,p.Z)(e,"onTypeChange",function(a){var n=a.detail.value,t=e.state.types[n],s=x.mj[t],r=s?["\u8bf7\u9009\u62e9\u54c1\u724c"].concat((0,i.Z)(s.brands)):["\u8bf7\u9009\u62e9\u54c1\u724c"];e.setState({typeIndex:n,brandIndex:0,brands:r,formData:(0,c.Z)((0,c.Z)({},e.state.formData),{},{type:t,brand:"\u8bf7\u9009\u62e9\u54c1\u724c"})})}),(0,p.Z)(e,"onBrandChange",function(a){var n=a.detail.value,t=e.state.brands[n];e.setState({brandIndex:n,formData:(0,c.Z)((0,c.Z)({},e.state.formData),{},{brand:t})})}),(0,p.Z)(e,"onEmissionChange",function(a){var n=a.detail.value,t=e.state.emissions[n];e.setState({emissionIndex:n,formData:(0,c.Z)((0,c.Z)({},e.state.formData),{},{emission:t})})}),(0,p.Z)(e,"handleChooseImage",(0,r.Z)((0,s.Z)().m(function a(){var n,t;return(0,s.Z)().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,(0,v.I9)(9-e.state.images.length);case 1:n=a.v,e.setState({images:[].concat((0,i.Z)(e.state.images),(0,i.Z)(n.tempFilePaths))}),a.n=3;break;case 2:a.p=2,t=a.v,console.error("\u9009\u62e9\u56fe\u7247\u5931\u8d25:",t),(0,v.CF)("\u9009\u62e9\u56fe\u7247\u5931\u8d25","error");case 3:return a.a(2)}},a,null,[[0,2]])}))),(0,p.Z)(e,"handleRemoveImage",function(a){var n=(0,i.Z)(e.state.images);n.splice(a,1),e.setState({images:n})}),(0,p.Z)(e,"handleSubmit",(0,r.Z)((0,s.Z)().m(function a(){var n,t,r,i,l;return(0,s.Z)().w(function(a){while(1)switch(a.n){case 0:if(e.validateForm()){a.n=1;break}return(0,v.CF)("\u8bf7\u5b8c\u5584\u8868\u5355\u4fe1\u606f","error"),a.a(2);case 1:e.setState({submitting:!0}),(0,v.QP)("\u53d1\u5e03\u4e2d...");try{n=e.state,t=n.formData,r=n.images,i=(0,c.Z)((0,c.Z)({},t),{},{images:r}),l=(0,x.B2)(i),console.log("\u65b0\u5546\u54c1\u53d1\u5e03\u6210\u529f:",l),(0,v.CF)("\u53d1\u5e03\u6210\u529f"),setTimeout(function(){(0,v.n)()},1500)}catch(e){console.error("\u53d1\u5e03\u5931\u8d25:",e),(0,v.CF)("\u53d1\u5e03\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5","error")}finally{e.setState({submitting:!1}),(0,v.Zk)()}case 2:return a.a(2)}},a)}))),e}return(0,d.Z)(a,e),(0,o.Z)(a,[{key:"componentDidMount",value:function(){this.initData()}},{key:"render",value:function(){var e=this,a=this.state,n=a.formData,t=a.images,s=a.provinces,r=a.cities,c=a.types,i=a.brands,l=a.emissions,o=a.provinceIndex,m=a.cityIndex,d=a.typeIndex,p=a.brandIndex,u=a.emissionIndex,x=a.errors,v=a.submitting;return(0,g.jsx)(h.G7,{className:"post",children:(0,g.jsxs)(h.G7,{className:"post-form",children:[(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u5546\u54c1\u6807\u9898 *"}),(0,g.jsx)(h.II,{className:"input ".concat(x.title?"error":""),placeholder:"\u8bf7\u8f93\u5165\u5546\u54c1\u6807\u9898",value:n.title,onInput:function(a){return e.handleInputChange("title",a.detail.value)}}),x.title&&(0,g.jsx)(h.xv,{className:"error-text",children:x.title})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u8bbe\u5907\u7c7b\u578b *"}),(0,g.jsx)(h.cW,{mode:"selector",range:c,value:d,onChange:this.onTypeChange,className:"picker ".concat(x.type?"error":""),children:(0,g.jsx)(h.G7,{className:"picker-display",children:c[d]})}),x.type&&(0,g.jsx)(h.xv,{className:"error-text",children:x.type})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u54c1\u724c *"}),(0,g.jsx)(h.cW,{mode:"selector",range:i,value:p,onChange:this.onBrandChange,className:"picker ".concat(x.brand?"error":""),children:(0,g.jsx)(h.G7,{className:"picker-display",children:i[p]})}),x.brand&&(0,g.jsx)(h.xv,{className:"error-text",children:x.brand})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u89c4\u683c *"}),(0,g.jsx)(h.II,{className:"input ".concat(x.tonnage?"error":""),placeholder:"\u8bf7\u8f93\u5165\u89c4\u683c\uff08\u5428\uff09",value:n.tonnage,type:"digit",onInput:function(a){return e.handleInputChange("tonnage",a.detail.value)}}),x.tonnage&&(0,g.jsx)(h.xv,{className:"error-text",children:x.tonnage})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u51fa\u5382\u65e5\u671f"}),(0,g.jsx)(h.II,{className:"input",placeholder:"\u8bf7\u8f93\u5165\u51fa\u5382\u65e5\u671f\uff08\u5982\uff1a2023-06\uff09",value:n.manufacture_date,onInput:function(a){return e.handleInputChange("manufacture_date",a.detail.value)}})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u6240\u5728\u5730\u533a *"}),(0,g.jsxs)(h.G7,{className:"picker-row",children:[(0,g.jsx)(h.cW,{mode:"selector",range:s,value:o,onChange:this.onProvinceChange,className:"picker ".concat(x.province?"error":""),children:(0,g.jsx)(h.G7,{className:"picker-display",children:s[o]})}),(0,g.jsx)(h.cW,{mode:"selector",range:r,value:m,onChange:this.onCityChange,className:"picker ".concat(x.city?"error":""),children:(0,g.jsx)(h.G7,{className:"picker-display",children:r[m]})})]}),(x.province||x.city)&&(0,g.jsx)(h.xv,{className:"error-text",children:x.province||x.city})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u4ef7\u683c *"}),(0,g.jsx)(h.II,{className:"input ".concat(x.price?"error":""),placeholder:"\u8bf7\u8f93\u5165\u4ef7\u683c\uff08\u4e07\u5143\uff09",value:n.price,type:"digit",onInput:function(a){return e.handleInputChange("price",a.detail.value)}}),x.price&&(0,g.jsx)(h.xv,{className:"error-text",children:x.price})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u5de5\u4f5c\u5c0f\u65f6"}),(0,g.jsx)(h.II,{className:"input",placeholder:"\u8bf7\u8f93\u5165\u5de5\u4f5c\u5c0f\u65f6\u6570",value:n.work_hours,type:"number",onInput:function(a){return e.handleInputChange("work_hours",a.detail.value)}})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u884c\u9a76\u91cc\u7a0b"}),(0,g.jsx)(h.II,{className:"input",placeholder:"\u8bf7\u8f93\u5165\u884c\u9a76\u91cc\u7a0b\uff08\u516c\u91cc\uff09",value:n.mileage,type:"number",onInput:function(a){return e.handleInputChange("mileage",a.detail.value)}})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u6392\u653e\u6807\u51c6"}),(0,g.jsx)(h.cW,{mode:"selector",range:l,value:u,onChange:this.onEmissionChange,className:"picker",children:(0,g.jsx)(h.G7,{className:"picker-display",children:l[u]})})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u8054\u7cfb\u4eba *"}),(0,g.jsx)(h.II,{className:"input ".concat(x.contact_person?"error":""),placeholder:"\u8bf7\u8f93\u5165\u8054\u7cfb\u4eba\u59d3\u540d",value:n.contact_person,onInput:function(a){return e.handleInputChange("contact_person",a.detail.value)}}),x.contact_person&&(0,g.jsx)(h.xv,{className:"error-text",children:x.contact_person})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u8054\u7cfb\u7535\u8bdd *"}),(0,g.jsx)(h.II,{className:"input ".concat(x.phone?"error":""),placeholder:"\u8bf7\u8f93\u5165\u8054\u7cfb\u7535\u8bdd",value:n.phone,type:"number",onInput:function(a){return e.handleInputChange("phone",a.detail.value)}}),x.phone&&(0,g.jsx)(h.xv,{className:"error-text",children:x.phone})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u5546\u54c1\u63cf\u8ff0"}),(0,g.jsx)(h.gx,{className:"textarea",placeholder:"\u8bf7\u8f93\u5165\u5546\u54c1\u63cf\u8ff0",value:n.description,onInput:function(a){return e.handleInputChange("description",a.detail.value)}})]}),(0,g.jsxs)(h.G7,{className:"form-group",children:[(0,g.jsx)(h.xv,{className:"label",children:"\u5546\u54c1\u56fe\u7247"}),(0,g.jsxs)(h.G7,{className:"image-upload",children:[t.map(function(a,n){return(0,g.jsxs)(h.G7,{className:"image-item",children:[(0,g.jsx)(h.Ee,{className:"upload-image",src:a,mode:"aspectFill"}),(0,g.jsx)(h.G7,{className:"image-remove",onClick:function(){return e.handleRemoveImage(n)},children:"\xd7"})]},n)}),t.length<9&&(0,g.jsxs)(h.G7,{className:"image-add",onClick:this.handleChooseImage,children:[(0,g.jsx)(h.xv,{className:"add-icon",children:"+"}),(0,g.jsx)(h.xv,{className:"add-text",children:"\u6dfb\u52a0\u56fe\u7247"})]})]})]}),(0,g.jsx)(h.G7,{className:"form-actions",children:(0,g.jsx)(h.zx,{className:"btn btn-primary btn-large",onClick:this.handleSubmit,disabled:v,children:v?"\u53d1\u5e03\u4e2d...":"\u53d1\u5e03\u5546\u54c1"})})]})})}}])}(u.Component),j={navigationBarTitleText:"\u53d1\u5e03\u5546\u54c1"};Page((0,t.createPageConfig)(f,"pages/post/post",{root:{cn:[]}},j||{}))}},function(e){var a=function(a){return e(e.s=a)};e.O(0,[107,216,592],function(){return a(4967)});e.O()}]);