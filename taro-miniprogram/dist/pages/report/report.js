"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[326],{3739:function(e,t,r){var a=r(2180),n=r(8118),s=r(5308),c=r(298),o=r(7042),i=r(4460),l=r(597),m=r(1867),u=r(5023),p=r(201),d=r(1515),h=(r(2954),r(1876)),x=r(2269),f=function(e){function t(){var e;(0,o.Z)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=(0,l.Z)(this,t,[].concat(a)),(0,u.Z)(e,"state",{formData:{type:"",target_id:"",reason:"",description:"",contact:""},reportTypes:["\u8bf7\u9009\u62e9\u4e3e\u62a5\u7c7b\u578b","\u865a\u5047\u4fe1\u606f","\u4ef7\u683c\u6b3a\u8bc8","\u91cd\u590d\u53d1\u5e03","\u8fdd\u6cd5\u8fdd\u89c4","\u5176\u4ed6"],typeIndex:0,errors:{},submitting:!1}),(0,u.Z)(e,"validateForm",function(){var t=e.state,r=t.formData,a=t.reportTypes,n=t.typeIndex,s={};return 0!==n&&a[n]&&"\u8bf7\u9009\u62e9\u4e3e\u62a5\u7c7b\u578b"!==a[n]||(s.type="\u8bf7\u9009\u62e9\u4e3e\u62a5\u7c7b\u578b"),r.reason.trim()||(s.reason="\u8bf7\u8f93\u5165\u4e3e\u62a5\u539f\u56e0"),r.description.trim()?r.description.trim().length<10&&(s.description="\u63cf\u8ff0\u5185\u5bb9\u81f3\u5c11\u9700\u898110\u4e2a\u5b57\u7b26"):s.description="\u8bf7\u8be6\u7ec6\u63cf\u8ff0\u4e3e\u62a5\u5185\u5bb9",r.contact.trim()&&!/^1[3-9]\d{9}$/.test(r.contact)&&(s.contact="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801"),e.setState({errors:s}),0===Object.keys(s).length}),(0,u.Z)(e,"handleInputChange",function(t,r){e.setState({formData:(0,c.Z)((0,c.Z)({},e.state.formData),{},(0,u.Z)({},t,r)),errors:(0,c.Z)((0,c.Z)({},e.state.errors),{},(0,u.Z)({},t,""))})}),(0,u.Z)(e,"onTypeChange",function(t){var r=t.detail.value,a=e.state.reportTypes[r];e.setState({typeIndex:r,formData:(0,c.Z)((0,c.Z)({},e.state.formData),{},{type:a}),errors:(0,c.Z)((0,c.Z)({},e.state.errors),{},{type:""})})}),(0,u.Z)(e,"handleSubmit",(0,s.Z)((0,n.Z)().m(function t(){var r;return(0,n.Z)().w(function(t){while(1)switch(t.p=t.n){case 0:if(e.validateForm()){t.n=1;break}return(0,h.CF)("\u8bf7\u5b8c\u5584\u4e3e\u62a5\u4fe1\u606f","error"),t.a(2);case 1:return e.setState({submitting:!0}),(0,h.QP)("\u63d0\u4ea4\u4e2d..."),t.p=2,t.n=3,new Promise(function(e){return setTimeout(e,2e3)});case 3:(0,h.CF)("\u4e3e\u62a5\u63d0\u4ea4\u6210\u529f\uff0c\u6211\u4eec\u4f1a\u5c3d\u5feb\u5904\u7406"),setTimeout(function(){(0,h.n)()},1500),t.n=5;break;case 4:t.p=4,r=t.v,console.error("\u63d0\u4ea4\u4e3e\u62a5\u5931\u8d25:",r),(0,h.CF)("\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5","error");case 5:return t.p=5,e.setState({submitting:!1}),(0,h.Zk)(),t.f(5);case 6:return t.a(2)}},t,null,[[2,4,5,6]])}))),e}return(0,m.Z)(t,e),(0,i.Z)(t,[{key:"componentDidMount",value:function(){var e=this.$router.params,t=e.type,r=e.id;t&&r&&this.setState({formData:(0,c.Z)((0,c.Z)({},this.state.formData),{},{target_id:r})})}},{key:"render",value:function(){var e=this,t=this.state,r=t.formData,a=t.reportTypes,n=t.typeIndex,s=t.errors,c=t.submitting;return(0,x.jsx)(d.G7,{className:"report",children:(0,x.jsxs)(d.G7,{className:"report-form",children:[(0,x.jsxs)(d.G7,{className:"form-header",children:[(0,x.jsx)(d.xv,{className:"form-title",children:"\u4e3e\u62a5\u6295\u8bc9"}),(0,x.jsx)(d.xv,{className:"form-subtitle",children:"\u8bf7\u8be6\u7ec6\u586b\u5199\u4e3e\u62a5\u4fe1\u606f\uff0c\u6211\u4eec\u4f1a\u8ba4\u771f\u5904\u7406\u6bcf\u4e00\u4e2a\u4e3e\u62a5"})]}),(0,x.jsxs)(d.G7,{className:"form-group",children:[(0,x.jsx)(d.xv,{className:"label",children:"\u4e3e\u62a5\u7c7b\u578b *"}),(0,x.jsx)(d.cW,{mode:"selector",range:a,value:n,onChange:this.onTypeChange,className:"picker ".concat(s.type?"error":""),children:(0,x.jsx)(d.G7,{className:"picker-display",children:a[n]})}),s.type&&(0,x.jsx)(d.xv,{className:"error-text",children:s.type})]}),(0,x.jsxs)(d.G7,{className:"form-group",children:[(0,x.jsx)(d.xv,{className:"label",children:"\u4e3e\u62a5\u539f\u56e0 *"}),(0,x.jsx)(d.II,{className:"input ".concat(s.reason?"error":""),placeholder:"\u8bf7\u7b80\u8981\u8bf4\u660e\u4e3e\u62a5\u539f\u56e0",value:r.reason,onInput:function(t){return e.handleInputChange("reason",t.detail.value)}}),s.reason&&(0,x.jsx)(d.xv,{className:"error-text",children:s.reason})]}),(0,x.jsxs)(d.G7,{className:"form-group",children:[(0,x.jsx)(d.xv,{className:"label",children:"\u8be6\u7ec6\u63cf\u8ff0 *"}),(0,x.jsx)(d.gx,{className:"textarea ".concat(s.description?"error":""),placeholder:"\u8bf7\u8be6\u7ec6\u63cf\u8ff0\u4e3e\u62a5\u5185\u5bb9\uff0c\u5305\u62ec\u5177\u4f53\u7684\u8fdd\u89c4\u884c\u4e3a\u3001\u65f6\u95f4\u3001\u5730\u70b9\u7b49\u4fe1\u606f",value:r.description,onInput:function(t){return e.handleInputChange("description",t.detail.value)},maxlength:500}),(0,x.jsxs)(d.G7,{className:"char-count",children:[r.description.length,"/500"]}),s.description&&(0,x.jsx)(d.xv,{className:"error-text",children:s.description})]}),(0,x.jsxs)(d.G7,{className:"form-group",children:[(0,x.jsx)(d.xv,{className:"label",children:"\u8054\u7cfb\u65b9\u5f0f"}),(0,x.jsx)(d.II,{className:"input ".concat(s.contact?"error":""),placeholder:"\u8bf7\u8f93\u5165\u60a8\u7684\u624b\u673a\u53f7\u7801\uff08\u9009\u586b\uff09",value:r.contact,type:"number",onInput:function(t){return e.handleInputChange("contact",t.detail.value)}}),(0,x.jsx)(d.xv,{className:"input-hint",children:"\u63d0\u4f9b\u8054\u7cfb\u65b9\u5f0f\u6709\u52a9\u4e8e\u6211\u4eec\u66f4\u597d\u5730\u5904\u7406\u60a8\u7684\u4e3e\u62a5"}),s.contact&&(0,x.jsx)(d.xv,{className:"error-text",children:s.contact})]}),(0,x.jsxs)(d.G7,{className:"form-notice",children:[(0,x.jsx)(d.xv,{className:"notice-title",children:"\u4e3e\u62a5\u987b\u77e5:"}),(0,x.jsx)(d.xv,{className:"notice-text",children:"\u2022 \u8bf7\u786e\u4fdd\u4e3e\u62a5\u5185\u5bb9\u771f\u5b9e\u6709\u6548"}),(0,x.jsx)(d.xv,{className:"notice-text",children:"\u2022 \u6076\u610f\u4e3e\u62a5\u5c06\u627f\u62c5\u76f8\u5e94\u8d23\u4efb"}),(0,x.jsx)(d.xv,{className:"notice-text",children:"\u2022 \u6211\u4eec\u4f1a\u57283\u4e2a\u5de5\u4f5c\u65e5\u5185\u5904\u7406\u60a8\u7684\u4e3e\u62a5"})]}),(0,x.jsx)(d.G7,{className:"form-actions",children:(0,x.jsx)(d.zx,{className:"btn btn-primary btn-large",onClick:this.handleSubmit,disabled:c,children:c?"\u63d0\u4ea4\u4e2d...":"\u63d0\u4ea4\u4e3e\u62a5"})})]})})}}])}(p.Component),v={navigationBarTitleText:"\u4e3e\u62a5\u6295\u8bc9"};Page((0,a.createPageConfig)(f,"pages/report/report",{root:{cn:[]}},v||{}))}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[107,216,592],function(){return t(3739)});e.O()}]);